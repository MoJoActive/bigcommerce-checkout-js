"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[964],{44713:(e,t,n)=>{n.r(t),n.d(t,{default:()=>K});var s=n(31635),i=n(69440),a=n(70355),l=n(49655),o=n(17986),d=n(39886),r=n(95108),c=n(45293),u=n(79001),m=n(84559),g=n(87980),p=n(74027),A=n(43586),h=n(69462),b=n(94202),E=n(68512),f=n(38989),y=n(69022),C=n(68801),v=n(87650),k=n(49102),S=n(62562),F=n(12319),_=n(22011),w=n(33515),B=n(10685),I=n(69070),M=n(46487),L=n(4899),N=n(60833),O=n(74302);const U=(0,E.A)((0,h.bk)({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,customerMessage:t,billingAddress:n})=>Object.assign(Object.assign({},(0,_.A)(e(n&&n.countryCode),n)),{orderComment:t}),isInitialValid:({billingAddress:e,getFields:t,language:n})=>!!e&&(0,w.A)({language:n,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:n})=>"amazonpay"===n?(0,b.RZ)((n=>(0,B.A)({translate:(0,w.X)(e),formFields:t(n&&n.countryCode)}))):(0,b.RZ)((n=>(0,w.A)({language:e,formFields:t(n&&n.countryCode)}))),enableReinitialize:!0})((({googleMapsApiKey:e,billingAddress:t,countriesWithAutocomplete:n,customer:{addresses:i,isGuest:d},getFields:r,countries:c,isUpdating:u,setFieldValue:m,shouldShowOrderComments:g,values:p,methodId:A,isFloatingLabelEnabled:h,updateAddress:b,onUnhandledError:E})=>{const[_,w]=(0,a.useState)(!1),B=(0,a.useRef)(null),{isPayPalFastlaneEnabled:U,paypalFastlaneAddresses:z}=(0,f.A)(),{themeV2:V}=(0,y.w)(),j="amazonpay"===A,K=r(p.countryCode),P=K.filter((({custom:e})=>e)),R=P.length>0,x=j&&R?P:K,T=d&&U?z:i,W=(null==T?void 0:T.length)>0,Z=t&&(0,v.A)(t,T,r(t.countryCode)),G=e=>(0,s.__awaiter)(void 0,void 0,void 0,(function*(){w(!0);try{yield b(e)}catch(e){e instanceof Error&&E(e)}finally{w(!1)}}));return a.createElement(L.A,{autoComplete:"on"},j&&t&&a.createElement("div",{className:"form-fieldset"},a.createElement(O.A,{address:t})),a.createElement(N.A,{id:"checkoutBillingAddress",ref:B},W&&!j&&a.createElement(N.A,{id:"billingAddresses"},a.createElement(C.A,{isLoading:_},a.createElement(k.A,{addresses:T,onSelectAddress:G,onUseNewAddress:()=>{G({})},selectedAddress:Z?t:void 0,type:S.A.Billing}))),!Z&&a.createElement(o.A,{isLoading:_},a.createElement(F.A,{countries:c,countriesWithAutocomplete:n,countryCode:p.countryCode,formFields:x,googleMapsApiKey:e,isFloatingLabelEnabled:h,setFieldValue:m,shouldShowSaveAddress:!d}))),g&&a.createElement(I.A,null),a.createElement("div",{className:"form-actions"},a.createElement(M.Ay,{className:V?"body-bold":"",disabled:u||_,id:"checkout-billing-continue",isLoading:u||_,type:"submit",variant:M.Ak.Primary},a.createElement(l.A,{id:"common.continue_action"}))))})));var z=n(21106);function V(e){const t=(0,z.A)(e);return t&&["amazonpay"].includes(t.providerId)?t.providerId:void 0}class j extends a.Component{constructor(){super(...arguments),this.handleSubmit=e=>(0,s.__awaiter)(this,void 0,void 0,(function*(){var{orderComment:t}=e,n=(0,s.__rest)(e,["orderComment"]);const{updateAddress:i,updateCheckout:a,customerMessage:l,billingAddress:o,navigateNextStep:c,onUnhandledError:u}=this.props,m=[],g=(0,d.A)(n);g&&!(0,r.A)(g,o)&&m.push(i(g)),l!==t&&m.push(a({customerMessage:t}));try{yield Promise.all(m),c()}catch(e){e instanceof Error&&u(e)}}))}componentDidMount(){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const{initialize:e,onReady:t=i.noop,onUnhandledError:n}=this.props;try{yield e(),t()}catch(e){e instanceof Error&&n(e)}}))}render(){const e=this.props,{updateAddress:t,isInitializing:n,themeV2:i}=e,d=(0,s.__rest)(e,["updateAddress","isInitializing","themeV2"]);return a.createElement(o.A,{isLoading:n},a.createElement("div",{className:"checkout-form"},a.createElement("div",{className:"form-legend-container"},a.createElement(A.A,{testId:"billing-address-heading",themeV2:i},a.createElement(l.A,{id:"billing.billing_address_heading"}))),a.createElement(U,Object.assign({},d,{onSubmit:this.handleSubmit,updateAddress:t}))))}}const K=(0,c.A)((function({checkoutService:e,checkoutState:t}){const{data:{getCheckout:n,getConfig:s,getCart:i,getCustomer:a,getBillingAddress:l,getBillingAddressFields:o,getBillingCountries:d},statuses:{isLoadingBillingCountries:r,isUpdatingBillingAddress:c,isUpdatingCheckout:A}}=t,h=s(),b=a(),E=n(),f=i();if(!(h&&b&&E&&f))return null;const{enableOrderComments:y,googleMapsApiKey:C}=h.checkoutSettings;return{billingAddress:l(),countries:d()||u.M,countriesWithAutocomplete:["US","CA","AU","NZ","GB"],customer:b,customerMessage:E.customerMessage,getFields:o,googleMapsApiKey:C,initialize:e.loadBillingAddressFields,isInitializing:r(),isUpdating:c()||A(),methodId:V(E),shouldShowOrderComments:y&&(0,p.A)(f)<1,updateAddress:e.updateBillingAddress,updateCheckout:e.updateCheckout,isFloatingLabelEnabled:(0,m.A)(h.checkoutSettings),themeV2:(0,g.A)(h.checkoutSettings,"CHECKOUT-7962.update_font_style_on_checkout_page")}}))(j)},67113:(e,t,n)=>{n.d(t,{A:()=>d});var s=n(70355),i=n(77175),a=n(32657),l=n(75514),o=n(91605);const d=({placement:e="bottom-start",dropdown:t,children:n})=>{const[d,r]=(0,s.useState)(!1),c=(0,s.useCallback)((()=>document.getElementById(o.B)||document.getElementById(o.S)),[]),u=(0,s.useCallback)((()=>{d&&r(!1)}),[d]),m=(0,s.useCallback)((()=>{d||r(!0)}),[d]),g=(0,s.useCallback)((()=>{d?u():m()}),[d,u,m]);return(0,s.useEffect)((()=>{const e=c();return d?null==e||e.addEventListener("click",u):null==e||e.removeEventListener("click",u),()=>{null==e||e.removeEventListener("click",u)}}),[d,u,c]),s.createElement(i.mS,null,s.createElement(a.O,null,(({ref:e})=>s.createElement("div",{className:"dropdownTrigger",onClick:g,ref:e},n))),s.createElement(l.N,{modifiers:[{name:"hide",enabled:!1},{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}],placement:e},(({ref:e,style:n})=>d?s.createElement("div",{className:"dropdownMenu",ref:e,style:Object.assign(Object.assign({},n),{width:"100%",zIndex:1})},t):null)))}},91605:(e,t,n)=>{n.d(t,{B:()=>s,S:()=>i});const s="checkout-app",i="micro-app-ng-checkout"}}]);
//# sourceMappingURL=billing-937307e0.js.map