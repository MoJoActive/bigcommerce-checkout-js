"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[2553],{2224:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(70355);const a=(0,i(2156).A)((()=>n.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}))))},10169:(e,t,i)=>{i.d(t,{A:()=>A});var n=i(31635),a=i(44218),s=i(69440),o=i(70355),l=i(3375),d=i.n(l),r=i(63849),c=i(32312);const m=(0,o.memo)((({bodyClassName:e="accordion-item-body",children:t,className:i="accordion-item",classNameSelected:n="accordion-item--selected",headerClassName:a="accordion-item-header",headerClassNameSelected:s="accordion-item-header--selected",headerContent:l,itemId:m})=>{const{onToggle:p,selectedItemId:g}=(0,o.useContext)(c.A),u=g===m,h=(0,o.useCallback)(((e,t)=>{e.addEventListener("transitionend",(({target:i})=>{i===e&&t()}))}),[]);return o.createElement("li",{className:d()(i,{[n]:u})},o.createElement("div",{className:d()(a,{[s]:u})},l({isSelected:u,onToggle:p})),t?o.createElement(r.A,{addEndListener:h,classNames:e,in:u,mountOnEnter:!0,timeout:{},unmountOnExit:!0},o.createElement("div",{"aria-live":"polite",className:e},t)):null)}));var p=i(29853),g=i(82259),u=i(34953),h=i(28407);const S=e=>{var{id:t,isSelected:i,children:a}=e,s=(0,n.__rest)(e,["id","isSelected","children"]);return o.createElement(o.Fragment,null,o.createElement(u.A,Object.assign({},s,{checked:i,className:"form-checklist-checkbox optimizedCheckout-form-checklist-checkbox",id:t,type:"radio"})),o.createElement(h.A,{htmlFor:t},a))},A=(0,o.memo)((e=>{var{isDisabled:t,value:i,content:l,htmlId:d=(0,s.kebabCase)(i),label:r}=e,c=(0,n.__rest)(e,["isDisabled","value","content","htmlId","label"]);const{name:u=""}=(0,o.useContext)(g.C)||{},h=(0,o.useCallback)((0,a.memoizeOne)((e=>({field:n})=>o.createElement(S,Object.assign({},n,{disabled:t,id:d,isSelected:n.value===i,value:i}),r instanceof Function?r(e):r))),[d,t,r,i]),A=(0,o.useCallback)((0,a.memoizeOne)((e=>t=>{i===t&&e(i)})),[]),E=(0,o.useCallback)((({isSelected:e,onToggle:t})=>o.createElement(p.A,{className:"form-checklist-option",name:u,onChange:A(t),render:h(e)})),[A,u,h]);return o.createElement(m,Object.assign({},c,{bodyClassName:"form-checklist-body",className:"form-checklist-item optimizedCheckout-form-checklist-item",classNameSelected:"form-checklist-item--selected optimizedCheckout-form-checklist-item--selected",headerClassName:"form-checklist-header",headerClassNameSelected:"form-checklist-header--selected",headerContent:E,itemId:i}),l)}))},13400:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(69440),a=i(70355),s=i(49655),o=i(63163),l=i(24391),d=i(76966);const r=({headerId:e,messageId:t,isModalOpen:i,action:r,actionButtonLabel:c,onRequestClose:m=n.noop,shouldShowCloseButton:p=!0})=>a.createElement(l.A,{additionalModalClassName:"modal--confirm",footer:a.createElement(o.Ay,{onClick:r,size:o.Mp.Small,variant:o.Ak.Primary},null!=c?c:a.createElement(s.A,{id:"common.confirm_action"})),header:a.createElement(d.A,null,a.createElement("span",{"aria-live":"assertive",role:"alert"},a.createElement(s.A,{id:e}))),isOpen:i,onRequestClose:m,shouldShowCloseButton:p},a.createElement("p",{"aria-live":"assertive",role:"alert"},a.createElement(s.A,{id:t})))},15e3:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Kt,mapToShippingProps:()=>$t});var n=i(31635),a=i(69440),s=i(70355),o=i(12077),l=i(89443),d=i(77050),r=i(49655),c=i(17986),m=i(13400),p=i(39886),g=i(95108),u=i(45293),h=i(79001),S=i(12402),A=i(98610),E=i(74027),v=i(21106);function C(e,t){var i;const n=[A.A.AmazonPay,A.A.BraintreeAcceleratedCheckout,A.A.PayPalCommerceAcceleratedCheckout],a=(0,S.A)(null===(i=t.checkoutSettings)||void 0===i?void 0:i.providerWithCustomCheckout),s=(0,v.A)(e);return s&&n.includes(s.providerId)?s.providerId:a&&n.includes(a)?a:void 0}function f(e){var t;const{digitalItems:i=[],physicalItems:n}=e.lineItems;return(null===(t=[...i,...n].filter((e=>e.addedByPromotion)))||void 0===t?void 0:t.length)>0}var y=i(68512),b=i(39981),_=i(96097),I=i(3375),N=i.n(I),O=i(69022),M=i(60288),k=i(69462);function w(e){return t=>{const i=e=>{const{resetForm:i,isInitialValueLoaded:n,initialValues:a}=e,o=(0,s.useRef)(n);return(0,s.useEffect)((()=>{!1===o.current&&!0===n&&i({values:null!=a?a:{}}),o.current=n}),[n,a,i]),s.createElement(t,Object.assign({},e))};return i.displayName=`WithFormikExtended(${t.displayName||t.name})`,(0,k.bk)(e)(i)}}var L=i(46487),F=i(72769),B=i(53133),P=i(45080),z=i(33318),R=i(94202),T=i(68801),U=i(4899),x=i(92909),V=i(58330),j=i(38546),H=i(62562),D=i(33515),q=i(22011);const $=(0,y.A)((0,k.bk)({handleSubmit:(e,{props:{onSaveAddress:t}})=>{t(e)},mapPropsToValues:({getFields:e,selectedAddress:t})=>(0,q.A)(e(t&&t.countryCode),t),validationSchema:({language:e,getFields:t})=>(0,R.RZ)((i=>(0,D.A)({language:e,formFields:t(i&&i.countryCode)})))})((({getFields:e,values:t,setFieldValue:i,isLoading:n,onRequestClose:a})=>s.createElement(U.A,{autoComplete:"on"},s.createElement(T.A,{isLoading:n},s.createElement(j.A,{countryCode:t.countryCode,formFields:e(t.countryCode),setFieldValue:i,shouldShowSaveAddress:!1,type:H.A.Shipping}),s.createElement("div",{className:"form-actions"},s.createElement(L.Ay,{onClick:a,variant:L.Ak.Secondary},s.createElement(r.A,{id:"common.cancel_action"})),s.createElement(L.Ay,{disabled:n,id:"checkout-save-address",type:"submit",variant:L.Ak.Primary},s.createElement(r.A,{id:"address.save_address_action"})))))))),K=e=>{var{isOpen:t,onAfterOpen:i,onRequestClose:a}=e,o=(0,n.__rest)(e,["isOpen","onAfterOpen","onRequestClose"]);return s.createElement(x.A,{additionalModalClassName:"modal--medium",header:s.createElement(V.A,null,s.createElement(r.A,{id:"address.add_address_heading"})),isOpen:t,onAfterOpen:i,onRequestClose:a,shouldShowCloseButton:!0},s.createElement($,Object.assign({},o,{onRequestClose:a})))};var G=i(49102),W=i(31689),J=i(84087),Q=i(4853),Y=i(85021);class Z extends Q.A{constructor(e){super({name:"ASSIGN_ITEM_INVALID_ADDRESS",message:(0,J.A)().translate("shipping.assign_item_invalid_address_error"),title:(0,J.A)().translate("shipping.assign_item_invalid_address_error_heading"),data:e}),(0,Y.h)(this,Z.prototype)}}class X extends Q.A{constructor(e){super({name:"ASSIGN_ITEM_FAILED",message:(0,J.A)().translate("shipping.assign_item_error"),data:e}),(0,Y.h)(this,X.prototype)}}const ee=(0,i(2156).A)((()=>s.createElement("svg",{fill:"none",height:"20",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M2.49902 14.5511V17.0844C2.49902 17.3178 2.68236 17.5011 2.91569 17.5011H5.44902C5.55736 17.5011 5.66569 17.4594 5.74069 17.3761L14.8407 8.28444L11.7157 5.15944L2.62402 14.2511C2.54069 14.3344 2.49902 14.4344 2.49902 14.5511ZM17.2574 5.86777C17.5824 5.54277 17.5824 5.01777 17.2574 4.69277L15.3074 2.74277C14.9824 2.41777 14.4574 2.41777 14.1324 2.74277L12.6074 4.26777L15.7324 7.39277L17.2574 5.86777Z"}))));var te=i(63650);const ie=({onUseNewAddress:e,selectedAddress:t})=>{const{themeV2:i}=(0,O.w)();return s.createElement("div",{className:"guest-consignment-line-item-header"},t?s.createElement(s.Fragment,null,s.createElement(te.A,{address:t}),s.createElement("a",{className:i?"body-cta":"","data-test":"edit-shipping-address",href:"#",onClick:(0,F.A)(e)},s.createElement(ee,null))):s.createElement(s.Fragment,null,s.createElement("h3",{className:i?"body-bold":""},s.createElement(r.A,{id:"shipping.guest_multishipping_no_shipping_address_message"})),s.createElement("a",{className:i?"body-cta":"","data-test":"enter-shipping-address",href:"#",onClick:(0,F.A)(e)},s.createElement(r.A,{id:"shipping.guest_multishipping_enter_shipping_address_action"}))))},ne=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;const a=new Map(e.map((e=>{var t;return[e.id,null===(t=e.selectedShippingOption)||void 0===t?void 0:t.id]})));for(const e of t)if(!e.selectedShippingOption){const t=a.get(e.id);if(t){yield i(e.id,t);continue}const s=null===(n=e.availableShippingOptions)||void 0===n?void 0:n.find((e=>e.isRecommended));s&&(yield i(e.id,s.id))}})),ae=({consignment:e,defaultCountryCode:t,isLoading:i,onUnhandledError:a,selectedAddress:o,setConsignmentRequest:l})=>{const[d,c]=(0,s.useState)(!1),[m,g]=(0,s.useState)(),{checkoutState:{data:{getCustomer:u,getConfig:S,getConsignments:A,getShippingAddressFields:E}},checkoutService:{updateConsignment:v,createCustomerAddress:C,selectConsignmentShippingOption:f}}=(0,b.Q)(),y=u();if(!S()||!y)return null;const _=y.addresses||h.M,I=y.isGuest,N=t=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var i;if(!(0,z.A)(t,E(t.countryCode)))return a(new Z);if(e)try{const{data:{getConsignments:n}}=yield v({id:e.id,address:t,shippingAddress:t,lineItems:e.lineItems.map((({id:e,quantity:t})=>({itemId:e,quantity:t})))}),a=n();a&&a.length>0&&(yield ne(null!==(i=A())&&void 0!==i?i:[],a,f))}catch(e){e instanceof Error&&a(new X(e))}else null==l||l({address:t,shippingAddress:t,lineItems:[]})})),O=()=>{c(!0)};return s.createElement(s.Fragment,null,s.createElement(W.A,{error:m,message:s.createElement(s.Fragment,null,s.createElement(r.A,{id:"address.consignment_address_updated_text"})," ",s.createElement(r.A,{id:"customer.create_address_error"})),onClose:()=>{g(void 0)},shouldShowErrorCode:!1}),s.createElement(K,{defaultCountryCode:t,getFields:E,isLoading:i,isOpen:d,onRequestClose:()=>{c(!1)},onSaveAddress:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const t=(0,p.A)(e);if(yield N(t),!I)try{yield C(t)}catch(e){e instanceof Error&&g(e)}c(!1)})),selectedAddress:I?o:void 0}),I?s.createElement(ie,{onUseNewAddress:O,selectedAddress:o}):s.createElement(G.A,{addresses:_,onSelectAddress:N,onUseNewAddress:O,placeholderText:s.createElement(r.A,{id:"shipping.choose_shipping_address"}),selectedAddress:o,showSingleLineAddress:!0,type:H.A.Shipping}))};var se=i(83651),oe=i(38116),le=i(11100),de=i(63163),re=i(81339),ce=i(97429),me=i(2224),pe=i(52523);const ge=()=>s.createElement(ce.A,{placement:"right-start",tooltip:s.createElement(pe.A,null,s.createElement(r.A,{id:"shipping.multishipping_item_split_tooltip_message"}))},s.createElement("span",{className:"item-split-tooltip","data-test":"split-item-tooltip"},s.createElement(me.A,null))),ue=({assignedItems:e,onUnassignItem:t})=>{const{themeV2:i}=(0,O.w)();return s.createElement("div",{className:"allocated-line-items"},s.createElement("h3",{className:i?"body-bold":""},s.createElement(r.A,{data:{count:e.shippableItemsCount},id:"shipping.multishipping_item_allocated_message"}),e.hasSplitItems&&s.createElement(ge,null)),s.createElement("ul",{className:"allocated-line-items-list"},e.lineItems.map((e=>s.createElement("li",{key:e.id},(0,re.h)(e,i),s.createElement("span",{"data-test":`remove-${e.id.toString()}-button`,onClick:()=>t(e)},s.createElement(B.A,null)))))))};var he=i(22375),Se=i(54454);const Ae=({item:e,error:t})=>{var i;const n=(0,le.A)(),{themeV2:a}=(0,O.w)();return s.createElement("tr",null,s.createElement("td",{className:"left-to-allocate-item-name-container"},s.createElement("figure",{className:"left-to-allocate-item-figure"},e.imageUrl&&s.createElement("img",{alt:e.name,src:e.imageUrl})),s.createElement("div",null,s.createElement("p",{className:N()("left-to-allocate-item-name",{"body-regular":a})},e.name),null===(i=e.options)||void 0===i?void 0:i.map((e=>s.createElement("p",{className:N()("left-to-allocate-item-option",{"sub-text-medium":a}),key:e.nameId},e.name,": ",e.value))))),!n&&s.createElement("td",{className:a?"body-regular":""},e.quantity),s.createElement("td",{className:a?"body-regular":""},n&&s.createElement(r.A,{data:{count:e.quantity},id:"shipping.multishipping_left_to_allocate_message"}),s.createElement(he.A,{additionalClassName:t?"form-field--error":"",input:({field:t})=>s.createElement(Se.A,Object.assign({},t,{"aria-label":`Quantity of ${e.name}`,disabled:0===e.quantity,id:t.name,min:0,themeV2:a,type:"number"})),name:e.id.toString()})))},Ee=({items:e,formErrors:t})=>{const i=(0,le.A)(),{themeV2:n}=(0,O.w)();return s.createElement("table",{className:"table left-to-allocate-items-table"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",{className:n?"body-medium":""},s.createElement(r.A,{id:"shipping.multishipping_left_to_allocate_items_table_item"})),!i&&s.createElement("th",{className:n?"body-medium":""},s.createElement(r.A,{id:"shipping.multishipping_left_to_allocate_items_table_left_to_allocate"})),s.createElement("th",{className:n?"body-medium":""},s.createElement(r.A,{id:"shipping.multishipping_left_to_allocate_items_table_quantity"})))),s.createElement("tbody",null,e.map((e=>s.createElement(Ae,{error:t[e.id.toString()],item:e,key:e.id})))))};var ve;!function(e){e[e.Physical=0]="Physical",e[e.Digital=1]="Digital",e[e.GiftCertificate=2]="GiftCertificate",e[e.Custom=3]="Custom"}(ve||(ve={}));const Ce=(0,y.A)(w({handleSubmit:(e,{props:{onAllocateItems:t}})=>{t(Object.keys(e).filter((t=>e[t]>0)).map((t=>({itemId:t,quantity:e[t]}))))},mapPropsToValues:({unassignedItems:e})=>{const t={};return e.lineItems.forEach((e=>{t[e.id.toString()]=0})),t},enableReinitialize:!0,validationSchema:({language:e,unassignedItems:t})=>{const i=t=>{const i=(0,R.ai)().required(e.translate("shipping.quantity_required_error")).integer(e.translate("shipping.quantity_invalid_error")).min(0,e.translate("shipping.quantity_min_error")).max(t.quantity,e.translate("shipping.quantity_max_error"));return t.type===ve.Custom?i.oneOf([0,t.quantity],e.translate("shipping.custom_item_quantity_error")):i},n=Object.fromEntries(t.lineItems.map((e=>[e.id.toString(),i(e)])));return(0,R.Ik)().shape(n)},validateOnBlur:!0,validateOnChange:!1})((({consignmentNumber:e,isOpen:t,onRequestClose:i,address:n,assignedItems:a,unassignedItems:o,setValues:l,values:d,dirty:c,submitForm:m,errors:p,onUnassignItem:g,isLoading:u})=>{const{themeV2:h}=(0,O.w)(),S=(0,s.useMemo)((()=>{const e=o.shippableItemsCount;if(d&&c){const t=Object.keys(d).reduce(((e,t)=>(d[t]>0&&(e+=d[t]),e)),0);return s.createElement(r.A,{data:{count:`${t}/${e}`},id:"shipping.multishipping_items_selected_message"})}return s.createElement(r.A,{data:{count:e},id:"shipping.multishipping_item_to_allocate_message"})}),[d]),A=(0,s.useMemo)((()=>Object.keys(p).reduce(((e,t)=>{const i=p[t];return i&&e.push(i),Array.from(new Set(e))}),[])),[p]),E=!!a&&a.lineItems.length>0&&!!g,v=!!o&&o.lineItems.length>0,C=s.createElement(s.Fragment,null,s.createElement(L.Ay,{className:h?"body-medium":"",disabled:u,onClick:i,variant:de.Ak.Secondary},s.createElement(r.A,{id:"shipping.multishipping_items_allocate_cancel"})),s.createElement(L.Ay,{className:h?"body-medium":"",disabled:!E&&!c,isLoading:u,onClick:m,type:"submit",variant:de.Ak.Primary},E?s.createElement(r.A,{id:"shipping.multishipping_items_allocate_save"}):s.createElement(r.A,{id:"shipping.multishipping_items_allocate_allocate"})));return s.createElement(x.A,{additionalModalClassName:"allocate-items-modal",footer:C,header:s.createElement(s.Fragment,null,s.createElement(V.A,{additionalClassName:h?"header":""},s.createElement(r.A,{data:{consignmentNumber:e},id:"shipping.multishipping_consignment_index_heading"})),s.createElement("h4",{className:h?"body-medium":""},(0,te.k)(n))),isOpen:t,onRequestClose:i},s.createElement(U.A,null,A.length>0&&s.createElement("div",{className:"form-errors"},A.map(((e,t)=>s.createElement(M.A,{key:t,type:M.v.Error},e)))),o.hasDigitalItems&&s.createElement(M.A,{type:M.v.Info},s.createElement(r.A,{id:"shipping.multishipping_digital_item_no_shipping_banner"})),E&&s.createElement(ue,{assignedItems:a,onUnassignItem:g}),v?s.createElement(s.Fragment,null,s.createElement("div",{className:"left-to-allocate-items-table-actions"},s.createElement("p",{className:h?"body-regular":""},S,o.hasSplitItems&&s.createElement(ge,null)),s.createElement("div",{className:"button-group"},s.createElement("a",{className:h?"body-cta":"","data-test":"clear-all-items-button",href:"#",onClick:(0,F.A)((()=>{const e={};o.lineItems.forEach((t=>{e[t.id.toString()]=0})),l(e)}))},s.createElement(r.A,{id:"shipping.multishipping_items_allocate_clear_all"})),s.createElement("a",{className:h?"body-cta":"","data-test":"allocate-all-items-button",href:"#",onClick:(0,F.A)((()=>{const e={};o.lineItems.forEach((t=>{e[t.id.toString()]=t.quantity})),l(e)}))},s.createElement(r.A,{id:"shipping.multishipping_items_allocate_select_all_items_left"})))),s.createElement(Ee,{formErrors:p,items:o.lineItems})):null))})));class fe extends Q.A{constructor(e){super({name:"UNASSIGN_ITEM_FAILED",message:(0,J.A)().translate("shipping.unassign_item_error"),data:e}),(0,Y.h)(this,fe.prototype)}}const ye=e=>btoa(encodeURIComponent(e.join("-")));const be=e=>e.reduce(((e,t)=>e+t.quantity),0),_e=(e,t)=>{const i=new Set;for(const n of e){const e=t.get(n.id.toString());if(e){if(i.has(e))return!0;i.add(e)}}return!1};function Ie(e,t){var i;const n=new Map,a=new Map,s=new Map,o=[];e.physicalItems.forEach((e=>{n.set(e.id.toString(),Object.assign(Object.assign({},e),{type:ve.Physical})),s.set(e.id.toString(),(e=>{return ye([e.productId.toString(),e.variantId.toString(),e.sku,(t=e.options,t?ye(t.map((e=>ye([e.name,e.nameId.toString(),e.value,e.valueId?e.valueId.toString():""])))):"")]);var t})(e))})),null===(i=e.customItems)||void 0===i||i.forEach((e=>n.set(e.id,Object.assign(Object.assign({},e),{type:ve.Custom})))),e.digitalItems.forEach((e=>a.set(e.id.toString(),Object.assign(Object.assign({},e),{type:ve.Digital})))),t.forEach(((e,t)=>{const i=[];e.lineItemIds.forEach((e=>{const t=n.get(e);t&&(i.push(t),n.delete(e))})),o.push(Object.assign(Object.assign({},e),{consignmentNumber:t+1,hasDigitalItems:!1,hasSplitItems:_e(i,s),shippableItemsCount:be(i),lineItems:i}))}));const l=Array.from(n.values()),d={lineItems:l,hasDigitalItems:a.size>0,hasSplitItems:_e(l,s),shippableItemsCount:be(l)};return{consignmentList:o,unassignedItems:d}}const Ne={unassignedItems:{lineItems:[],hasDigitalItems:!1,hasSplitItems:!1,shippableItemsCount:0},consignmentList:[]},Oe=()=>{const{checkoutState:{data:{getCheckout:e}}}=(0,b.Q)(),t=e();if(!t)return Ne;const{cart:{lineItems:i},consignments:n}=t,a=function(e){return Object.assign(Object.assign({},e),{physicalItems:e.physicalItems.filter((e=>"string"!=typeof e.parentId)),digitalItems:e.digitalItems.filter((e=>"string"!=typeof e.parentId))})}(i),{consignmentList:s,unassignedItems:o}=Ie(a,n);return{unassignedItems:o,consignmentList:s}},Me=({consignmentNumber:e,consignment:t,onUnhandledError:i,isLoading:a})=>{const[o,l]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!0),{unassignedItems:m}=Oe(),{checkoutService:{assignItemsToAddress:p}}=(0,b.Q)(),g=(()=>{const{checkoutService:{createConsignments:e,deleteConsignment:t}}=(0,b.Q)();return(i,a,s)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;let o=s.id;if(s.lineItemIds.length>1){const t=(yield e([i])).data.getConsignments();o=null===(n=null==t?void 0:t.find((e=>e.lineItemIds.find((e=>e===a)))))||void 0===n?void 0:n.id}if(!o)throw new Error("Unable to find consignment to delete");t(o)}))})(),{themeV2:u}=(0,O.w)(),h=()=>{l(!o)},S=(0,le.A)(),A=t.shippableItemsCount;return s.createElement("div",null,s.createElement(Ce,{address:t.shippingAddress,assignedItems:t,consignmentNumber:e,isLoading:a,isOpen:o,onAllocateItems:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield p({address:t.address,lineItems:e})}catch(e){e instanceof Error&&i(new X(e))}finally{h()}})),onRequestClose:h,onUnassignItem:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{const i={address:t.address,shippingAddress:t.shippingAddress,lineItems:[{quantity:e.quantity,itemId:e.id}]};yield g(i,e.id.toString(),t)}catch(e){e instanceof Error&&i(new fe(e))}})),unassignedItems:m}),s.createElement("div",{className:"consignment-line-item-header"},s.createElement("div",null,s.createElement("h3",{className:u?"body-bold":""},s.createElement(r.A,{data:{count:A},id:"shipping.multishipping_item_allocated_message"})),t.hasSplitItems&&s.createElement(ge,null),s.createElement("a",{className:N()("expand-items-button",{"body-cta":u}),"data-test":"expand-items-button",href:"#",onClick:(0,F.A)((()=>{c(!d)}))},d?s.createElement(s.Fragment,null,!S&&s.createElement(r.A,{id:"shipping.multishipping_item_hide_items_message"}),s.createElement(se.A,null)):s.createElement(s.Fragment,null,!S&&s.createElement(r.A,{id:"shipping.multishipping_item_show_items_message"}),s.createElement(oe.A,null)))),s.createElement("a",{className:u?"body-cta":"","data-test":"reallocate-items-button",href:"#",onClick:(0,F.A)(h)},s.createElement(r.A,{id:"shipping.multishipping_item_reallocated_message"}))),d?s.createElement(re.A,{lineItems:t.lineItems}):null)};var ke=i(25656),we=i(16919);const Le=({consignmentId:e,selectedShippingOptionId:t,shippingOption:i,handleSelect:n})=>{const{themeV2:a}=(0,O.w)(),o=s.createElement("span",{className:a?"body-regular":""},`${i.description} - `,s.createElement(we.A,{amount:i.cost}));return s.createElement("ul",{className:"shipping-option-item"},s.createElement(ke.A,{checked:t===i.id,id:`shippingOption-${e}-${i.id}`,key:`key-${e}-${i.id}`,label:o,name:`${e}-shippingMethod`,onClick:()=>{n(e,i.id)},readOnly:!0,value:i.id}))},Fe=(0,s.memo)((({consignmentId:e,isLoading:t,shippingOptions:i,selectedShippingOptionId:n,onSelectedOption:a})=>s.createElement(T.A,{isLoading:t},i.map((t=>s.createElement(Le,{consignmentId:e,handleSelect:a,key:t.id,selectedShippingOptionId:n,shippingOption:t}))))));function Be(e,t){return(0,a.reduce)(e&&e.lineItems.physicalItems||[],((e,i,n)=>!i.addedByPromotion&&(0,a.isNil)(i.parentId)?e.concat(...function(e,t,i){let n=[];const s=function(e,t){return(0,a.find)(e,(e=>(0,a.includes)(e.lineItemIds,t)))}(t,e.id);for(let t=0;t<e.quantity;t++)n=n.concat(Object.assign(Object.assign({},e),{key:`${e.variantId}-${e.productId}-${i}-${t}`,consignment:s,quantity:1}));return n}(i,t,n)):e),[])}var Pe=i(39009);function ze(e){if(e)return e.find((({isRecommended:e})=>e))}const Re=({consignments:e})=>{const t={};return(e||[]).forEach((e=>{t[e.id]=e.selectedShippingOption?e.selectedShippingOption.id:""})),{shippingOptionIds:t}};var Te=i(75794),Ue=i(53056);const xe=({cart:e,consignment:t})=>s.createElement("div",{className:"staticConsignment"},s.createElement("strong",null,s.createElement(r.A,{id:"shipping.shipping_address_heading"})),s.createElement(Te.A,{address:t.shippingAddress,type:H.A.Shipping}),s.createElement(Ue.A,{cart:e,consignment:t}));var Ve=i(17080);const je=({message:e,isLoading:t})=>s.createElement(Ve.A,{additionalClassName:"shippingOptions-skeleton",isLoading:t,rows:2},s.createElement("div",{className:"shippingOptions-panel optimizedCheckout-overlay"},s.createElement("p",{"aria-live":"polite",className:"shippingOptions-panel-message optimizedCheckout-primaryContent",role:"alert"},e)));var He=i(91182),De=i(10169),qe=i(82259),$e=i(13061);const Ke=({consignmentId:e,isMultiShippingMode:t,selectedShippingOptionId:i,shippingOption:n})=>{const a=i===n.id,o=(0,s.useCallback)((()=>s.createElement("div",{className:"shippingOptionLabel"},s.createElement($e.A,{displayAdditionalInformation:!0,method:n}),a&&!t&&s.createElement(He.Y,{region:"shipping.selectedShippingMethod"}))),[a,t,n]);return s.createElement(De.A,{htmlId:`shippingOptionRadio-${e}-${n.id}`,label:o,value:n.id})},Ge=(0,s.memo)((({consignmentId:e,inputName:t,isLoading:i,isMultiShippingMode:n,shippingOptions:a=h.M,selectedShippingOptionId:o,onSelectedOption:l})=>{const d=(0,s.useCallback)((t=>{l(e,t)}),[e,l]);return a.length?s.createElement(T.A,{isLoading:i},s.createElement(qe.A,{"aria-live":"polite",defaultSelectedItemId:o,name:t,onSelect:d},a.map((t=>s.createElement(Ke,{consignmentId:e,isMultiShippingMode:n,key:t.id,selectedShippingOptionId:o,shippingOption:t}))))):null})),We=w({handleSubmit:a.noop,mapPropsToValues:Re})((e=>{const{consignments:t,cart:i,isMultiShippingMode:a,selectShippingOption:o,isLoading:l,shouldShowShippingOptions:d,invalidShippingMessage:c,methodId:m,subscribeToConsignments:p,setFieldValue:g,shippingFormRenderTimestamp:u,setValues:h}=e,{analyticsTracker:S}=(0,Pe.A)(),A=e=>(0,n.__awaiter)(void 0,[e],void 0,(function*({data:e}){const t=(e.getConsignments()||[]).find((({selectedShippingOption:e,availableShippingOptions:t})=>!e&&t));if(!t||!t.availableShippingOptions)return;const{availableShippingOptions:i,id:n}=t,a=ze(i),s=1===i.length&&i[0],l=a||s;l&&(yield o(n,l.id),g(`shippingOptionIds.${n}`,l.id))}));return(0,s.useEffect)((()=>{const e=p(A);return()=>{e&&e()}}),[]),(0,s.useEffect)((()=>{(null==t?void 0:t.length)&&d&&S.showShippingMethods()}),[t,d]),(0,s.useEffect)((()=>{u&&h(Re(e))}),[u]),(null==t?void 0:t.length)&&d?s.createElement(s.Fragment,null,t.map((e=>s.createElement("div",{className:"shippingOptions-container form-fieldset",key:e.id},a&&s.createElement(xe,{cart:i,consignment:e}),s.createElement(Ge,{consignmentId:e.id,inputName:`shippingOptionIds.${e.id}`,isLoading:l(e.id),isMultiShippingMode:a,onSelectedOption:o,selectedShippingOptionId:e.selectedShippingOption&&e.selectedShippingOption.id,shippingOptions:e.availableShippingOptions}),(!e.availableShippingOptions||!e.availableShippingOptions.length)&&s.createElement(je,{isLoading:l(e.id),message:c}))))):s.createElement(je,{isLoading:l(),message:s.createElement(r.A,{id:m||a?"shipping.select_shipping_address_text":"shipping.enter_shipping_address_text"})})})),Je=(0,o.createSelector)((({checkoutService:e})=>e.subscribe),(e=>t=>e(t,(({data:e})=>e.getConsignments())))),Qe=(0,o.createSelector)(((e,t)=>t),(({statuses:e})=>e.isLoadingShippingOptions),(({statuses:e})=>e.isSelectingShippingOption),(({statuses:e})=>e.isUpdatingConsignment),(({statuses:e})=>e.isCreatingConsignments),((e,t,i,n,a)=>s=>e||t()||i(s)||n(s)||a()));const Ye=(0,u.A)((function({checkoutService:e,checkoutState:t},i){const{data:{getCart:n,getConsignments:s,getConfig:o,getCustomer:l,getCheckout:d},statuses:{isSelectingShippingOption:r}}=t,c=l(),m=n(),p=o(),g=d();if(!(p&&g&&c&&m))return null;const u=((e,t)=>{if(t.length<2)return t;const i=Be(e,t),n=(0,a.uniq)((0,a.map)(i,"consignment.id"));return(0,a.sortBy)(t,(e=>n.indexOf(e.id)))})(m,s()||[]),h=C(g,p),{shippingQuoteFailedMessage:S}=p.checkoutSettings;return{cart:m,consignments:u,invalidShippingMessage:S,isLoading:Qe(t,i.isUpdatingAddress),isSelectingShippingOption:r,methodId:h,selectShippingOption:e.selectConsignmentShippingOption,subscribeToConsignments:Je({checkoutService:e,checkoutState:t})}}))(We),Ze=({consignment:e,isLoading:t,resetErrorConsignmentNumber:i,shippingQuoteFailedMessage:a})=>{const{checkoutService:o,checkoutState:l}=(0,b.Q)(),{themeV2:d}=(0,O.w)(),c=Qe(l,t)(e.id);return s.createElement("div",null,s.createElement("h3",{className:N()("shipping-option-header",{"body-bold":d})},s.createElement(r.A,{id:"shipping.shipping_method_label"})),(!e.availableShippingOptions||!e.availableShippingOptions.length)&&s.createElement(M.A,{type:M.v.Error},a),Boolean(e.availableShippingOptions)&&e.availableShippingOptions&&s.createElement(Fe,{consignmentId:e.id,isLoading:c,onSelectedOption:(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield o.selectConsignmentShippingOption(e,t),i()})),selectedShippingOptionId:e.selectedShippingOption&&e.selectedShippingOption.id,shippingOptions:e.availableShippingOptions}))},Xe=({consignment:e,consignmentNumber:t,defaultCountryCode:i,isLoading:a,shippingQuoteFailedMessage:o,onUnhandledError:l,resetErrorConsignmentNumber:d})=>{const{checkoutService:{deleteConsignment:c}}=(0,b.Q)(),{themeV2:m}=(0,O.w)();return s.createElement("div",{className:"consignment-container"},s.createElement("div",{className:N()("consignment-header",{"sub-header":m})},s.createElement("h3",null,s.createElement(r.A,{data:{consignmentNumber:t},id:"shipping.multishipping_consignment_index_heading"})),s.createElement("a",{className:"delete-consignment","data-test":"delete-consignment-button",href:"#",onClick:(0,F.A)((()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield c(e.id),d()}))))},s.createElement(B.A,{size:P.l.Small}))),s.createElement(ae,{consignment:e,defaultCountryCode:i,isLoading:a,onUnhandledError:l,selectedAddress:e.shippingAddress}),s.createElement(Me,{consignment:e,consignmentNumber:t,isLoading:a,onUnhandledError:l}),s.createElement(Ze,{consignment:e,isLoading:a,resetErrorConsignmentNumber:d,shippingQuoteFailedMessage:o}))};var et=i(4209);function tt(e){return!!e.length&&(0,a.every)(e,(e=>{var t;return"custom"===(null===(t=e.selectedShippingOption)||void 0===t?void 0:t.type)||e.availableShippingOptions&&e.availableShippingOptions.find((({id:t})=>{var i;return t===(null===(i=e.selectedShippingOption)||void 0===i?void 0:i.id)}))}))}var it=i(69070),nt=i(11889);const at=({shouldShowOrderComments:e,shouldDisableSubmit:t,isLoading:i,cartHasChanged:n})=>{const{themeV2:a}=(0,O.w)();return s.createElement(U.A,null,n&&s.createElement(nt.A,{type:nt.v.Error},s.createElement("strong",null,s.createElement(r.A,{id:"shipping.cart_change_error"}))),e&&s.createElement(it.A,null),s.createElement("div",{className:"form-actions"},s.createElement(L.Ay,{className:a?"body-bold":"",disabled:t,id:"checkout-shipping-continue",isLoading:i,type:"submit",variant:L.Ak.Primary},s.createElement(r.A,{id:"common.continue_action"}))))},st=({consignmentNumber:e,defaultCountryCode:t,isLoading:i,onUnhandledError:o,resetErrorConsignmentNumber:l,setIsAddShippingDestination:d})=>{const[c,m]=(0,s.useState)(),[p,g]=(0,s.useState)(!1),{unassignedItems:u}=Oe(),{themeV2:S}=(0,O.w)(),{checkoutState:{data:{getShippingCountries:A,getConsignments:E}},checkoutService:{assignItemsToAddress:v,selectConsignmentShippingOption:C}}=(0,b.Q)(),f=(0,s.useMemo)((()=>{if(!(null==c?void 0:c.address))return;const e=A()||h.M,t=(0,a.find)(e,{code:c.address.countryCode});return Object.assign(Object.assign({},c.address),{country:t?t.name:c.address.countryCode})}),[c]),y=()=>{g(!p)};return s.createElement("div",{className:"consignment-container"},s.createElement("div",{className:N()("consignment-header",{"sub-header":S})},s.createElement("h3",null,s.createElement(r.A,{data:{consignmentNumber:e},id:"shipping.multishipping_consignment_index_heading"}))),s.createElement(ae,{defaultCountryCode:t,isLoading:i,onUnhandledError:o,selectedAddress:f,setConsignmentRequest:m}),f&&s.createElement(s.Fragment,null,s.createElement(Ce,{address:f,consignmentNumber:e,isLoading:i,isOpen:p,onAllocateItems:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var t;let i;if(f)try{const{data:{getConsignments:t}}=yield v({address:f,lineItems:e});i=t()}catch(e){e instanceof X&&o(e)}finally{y(),d(!1),l(),i&&i.length>0&&(yield ne(null!==(t=E())&&void 0!==t?t:[],i,C))}})),onRequestClose:y,unassignedItems:u}),s.createElement("div",{className:"new-consignment-line-item-header"},s.createElement("h3",{className:S?"body-bold":""},s.createElement(r.A,{id:"shipping.multishipping_no_item_allocated_message"})),s.createElement("a",{className:S?"body-cta":"","data-test":"allocate-items-button",href:"#",onClick:(0,F.A)(y)},s.createElement(r.A,{id:"shipping.multishipping_allocate_items"})))))},ot=(0,y.A)(w({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({customerMessage:e})=>({orderComment:e}),enableReinitialize:!0})((({defaultCountryCode:e,isLoading:t,onUnhandledError:i,cartHasChanged:n})=>{const[a,o]=(0,s.useState)(),{themeV2:l}=(0,O.w)(),{checkoutState:{data:{getConsignments:d,getConfig:c}}}=(0,b.Q)(),{unassignedItems:{lineItems:m,shippableItemsCount:p},consignmentList:g}=Oe(),u=d()||h.M,S=c(),[A,E]=(0,s.useState)(0===u.length),v=(0,et.A)(u),C=(0,s.useMemo)((()=>t||!!m.length||!v||!tt(u)),[t,u]);if(!S)return null;const{checkoutSettings:{enableOrderComments:f,shippingQuoteFailedMessage:y}}=S,_=p>0,I=()=>{o(void 0)};return s.createElement(s.Fragment,null,(e=>e>0?s.createElement(M.A,{additionalClassName:l?"body-regular":"",type:M.v.Info},s.createElement(r.A,{data:{count:e},id:"shipping.multishipping_item_to_allocate_message"})):s.createElement(M.A,{additionalClassName:l?"body-regular":"",type:M.v.Success},s.createElement(r.A,{id:"shipping.multishipping_all_items_allocated_message"})))(p),g.map((n=>s.createElement(Xe,{consignment:n,consignmentNumber:n.consignmentNumber,defaultCountryCode:e,isLoading:t,key:n.id,onUnhandledError:i,resetErrorConsignmentNumber:I,shippingQuoteFailedMessage:y}))),A&&s.createElement(st,{consignmentNumber:0===u.length?1:u.length+1,defaultCountryCode:e,isLoading:t,onUnhandledError:i,resetErrorConsignmentNumber:I,setIsAddShippingDestination:E}),_&&s.createElement(L.Ay,{className:N()({"body-regular":l},"add-consignment-button"),onClick:()=>{if(A||v)A?o(u.length+1):(o(void 0),E(!0));else{const e=u.findIndex((e=>!e.selectedShippingOption));if(-1===e)return void E(!0);o(e+1)}},variant:L.Ak.Secondary},s.createElement(r.A,{id:"shipping.multishipping_add_new_destination"})),Boolean(a)&&s.createElement("div",{className:"form-field--error"},s.createElement("span",{className:"form-inlineMessage"},s.createElement(r.A,{data:{consignmentNumber:a},id:"shipping.multishipping_incomplete_consignment_error"}))),s.createElement(at,{cartHasChanged:n,isLoading:t,shouldDisableSubmit:C,shouldShowOrderComments:f}))})));var lt=i(10685),dt=i(60833),rt=i(37958);const ct=(0,s.memo)((({onChange:e})=>{const{themeV2:t}=(0,O.w)(),i=(0,s.useMemo)((()=>s.createElement(r.A,{id:"billing.use_shipping_address_label"})),[]);return s.createElement(rt.A,{id:"sameAsBilling",labelContent:i,name:"billingSameAsShipping",onChange:e,testId:"billingSameAsShipping",themeV2:t})}));var mt=i(82922),pt=i(9343),gt=i(44218),ut=i(41410);const ht=({address:e,buttonId:t,formFields:i,isLoading:o,methodId:l,deinitialize:d,initialize:c,onFieldChange:m,onUnhandledError:p=a.noop})=>{const g=i.filter((({custom:e})=>e)),u=g.length>0;return(0,s.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield c({methodId:l})}catch(e){p(e)}})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield d({methodId:l})}catch(e){p(e)}}))})),[]),s.createElement(T.A,{isLoading:o},s.createElement("div",{className:"stepHeader",style:{padding:0}},s.createElement("div",{className:"stepHeader-body subheader"},s.createElement(Te.A,{address:e})),s.createElement("div",{className:"stepHeader-actions subheader"},s.createElement(L.Ay,{id:t,onClick:(0,F.A)(),size:L.Mp.Tiny,testId:"step-edit-button",variant:L.Ak.Secondary},s.createElement(r.A,{id:"common.edit_action"})))),u&&s.createElement(dt.A,{id:"customFieldset"},g.map((e=>{return s.createElement(ut.A,{field:e,key:`${e.id}-${e.name}`,onChange:(t=e.name,e=>{m(t,e)}),parentFieldName:"shippingAddress.customFields"});var t}))))},St=e=>{const{methodId:t,formFields:i,onFieldChange:n,initialize:a,deinitialize:o,shippingAddress:l,isShippingStepPending:d}=e,r=(0,s.useCallback)((0,gt.memoizeOne)((e=>t=>a(Object.assign(Object.assign({},e),t)))),[]),c="edit-ship-button",m={amazonpay:{editAddressButtonId:c}};return s.createElement(ht,{address:l,buttonId:c,deinitialize:o,formFields:i,initialize:r(m),isLoading:d,methodId:t,onFieldChange:n})};var At=i(62174),Et=i(87647),vt=i(83030),Ct=i(38989),ft=i(67313),yt=i(24750),bt=i(35172);const _t=(0,s.memo)((e=>{const{address:t,formFields:i,isLoading:a,onAddressSelect:o,onFieldChange:l,countries:d,paypalFastlaneShippingComponentRef:c}=e,m=(0,ft.A)(t,d),p=i.filter((({custom:e})=>e)),g=p.length>0;return s.createElement(T.A,{hideContentWhenLoading:!0,isLoading:a},s.createElement("div",{className:"stepHeader",style:{padding:0}},s.createElement("div",{className:"stepHeader-body subheader"},s.createElement("div",{className:"vcard checkout-address--static"},!(!m.firstName&&!m.lastName)&&s.createElement("p",{className:"fn address-entry"},s.createElement("span",{className:"first-name"},`${m.firstName} `),s.createElement("span",{className:"family-name"},m.lastName)),!(!m.phone&&!m.company)&&s.createElement("p",{className:"address-entry"},s.createElement("span",{className:"company-name"},`${m.company} `),s.createElement("span",{className:"tel"},m.phone)),s.createElement("div",{className:"adr"},s.createElement("p",{className:"street-address address-entry"},s.createElement("span",{className:"address-line-1"},`${m.address1} `),!!m.address2&&s.createElement("span",{className:"address-line-2"},` / ${m.address2}`)),s.createElement("p",{className:"address-entry"},!!m.city&&s.createElement("span",{className:"locality"},`${m.city}, `),!!m.localizedProvince&&s.createElement("span",{className:"region"},`${m.localizedProvince}, `),!!m.postalCode&&s.createElement("span",{className:"postal-code"},`${m.postalCode} / `),!!m.localizedCountry&&s.createElement("span",{className:"country-name"},`${m.localizedCountry} `)))),s.createElement(bt.A,null)),s.createElement("div",{className:"stepHeader-actions subheader"},s.createElement(de.Ay,{onClick:()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof c.current.showAddressSelector){const e=yield c.current.showAddressSelector();if(e){const t=g?m.customFields:{};o(Object.assign(Object.assign({},e),t))}}})),size:de.Mp.Tiny,testId:"step-edit-button",variant:de.Ak.Secondary},s.createElement(r.A,{id:"common.edit_action"})))),g&&s.createElement(yt.A,{id:"customFieldset"},p.map((e=>{return s.createElement(ut.A,{field:e,key:`${e.id}-${e.name}`,onChange:(t=e.name,e=>l(t,e)),parentFieldName:"shippingAddress.customFields"});var t}))))}));var It=i(87650),Nt=i(83742);const Ot="shippingAddress",Mt=(0,Nt.A)((({address:e,onAddressSelect:t,onUseNewAddress:i,formFields:n,isLoading:a,formik:{values:{shippingAddress:o},setFieldValue:l},onFieldChange:d})=>{const{checkoutState:{data:{getCustomer:r}}}=(0,b.Q)(),c=r(),m=(null==c?void 0:c.addresses)||[],p=!(null==c?void 0:c.isGuest),g=m&&m.length>0,u=(0,It.A)(e,m,n);return s.createElement(dt.A,{id:"checkoutShippingAddress"},g&&s.createElement(dt.A,{id:"shippingAddresses"},s.createElement(T.A,{isLoading:a},s.createElement(G.A,{addresses:m,onSelectAddress:t,onUseNewAddress:i,selectedAddress:u?e:void 0,type:H.A.Shipping}))),!u&&s.createElement(T.A,{isLoading:a,unmountContentWhenLoading:!0},s.createElement(j.A,{countryCode:o&&o.countryCode,fieldName:Ot,formFields:n,onAutocompleteToggle:({isOpen:e,inputValue:t})=>{e||d("address1",t)},onChange:(e,t)=>{d(e,t)},setFieldValue:(e,t)=>{const i=n.filter((e=>e.custom)).map((e=>e.name)).includes(e)?`customFields.${e}`:e;l(`${Ot}.${i}`,t)},shouldShowSaveAddress:p,type:H.A.Shipping})))})),kt=e=>{const{methodId:t,formFields:i,countries:a,onAddressSelect:o,onFieldChange:l,onUnhandledError:d,initialize:r,deinitialize:c,shippingAddress:m,handleFieldChange:p,isLoading:g}=e,[u,h]=(0,s.useState)(!0),S=(0,s.useRef)({}),A=e=>({[e]:{onPayPalFastlaneAddressChange:e=>{S.current.showAddressSelector=e}}});(0,s.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield r(Object.assign(Object.assign(Object.assign({methodId:t},(0,At.A)(t)?A("bigcommerce_payments_fastlane"):{}),(0,Et.A)(t)?A("braintreefastlane"):{}),(0,vt.A)(t)?A("paypalcommercefastlane"):{}))}catch(e){"function"==typeof d&&e instanceof Error&&d(e)}h(!1)})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield c({methodId:t})}catch(e){"function"==typeof d&&e instanceof Error&&d(e)}}))})),[]);const{shouldShowPayPalFastlaneShippingForm:E}=(0,Ct.A)();return s.createElement(T.A,{hideContentWhenLoading:!0,isLoading:u||g},t&&(0,mt.A)(t)&&m&&E?s.createElement(_t,{address:m,countries:a,deinitialize:c,formFields:i,initialize:r,isLoading:u,methodId:t,onAddressSelect:o,onFieldChange:l,onUnhandledError:d,paypalFastlaneShippingComponentRef:S}):s.createElement(Mt,{address:m,consignments:e.consignments,formFields:i,isLoading:u,onAddressSelect:o,onFieldChange:p,onUseNewAddress:e.onUseNewAddress}))},wt=(0,s.memo)((e=>{const{methodId:t,formFields:i,consignments:n,onAddressSelect:a,onFieldChange:o,onUseNewAddress:l,isLoading:d,shippingAddress:r,hasRequestedShippingOptions:c}=e,{setSubmitted:m}=(0,s.useContext)(pt.Ay),p=(e,t)=>{c&&m(!0),o(e,t)};return t&&(0,mt.A)(t)&&r?s.createElement(kt,Object.assign({},e,{handleFieldChange:p,methodId:t,shippingAddress:r})):"amazonpay"===t&&r?s.createElement(St,Object.assign({},e,{shippingAddress:r})):s.createElement(Mt,{address:r,consignments:n,formFields:i,isLoading:d,onAddressSelect:a,onFieldChange:p,onUseNewAddress:l})})),Lt=["address1","postalCode","countryCode","city","stateOrProvince","stateOrProvinceCode"];var Ft=i(43586);const Bt=({cartHasChanged:e,isMultiShippingMode:t,shouldShowOrderComments:i,shouldShowShippingOptions:n=!0,shouldDisableSubmit:a,isInitialValueLoaded:o,isLoading:l,shippingFormRenderTimestamp:d})=>{const{themeV2:c}=(0,O.w)();return s.createElement(s.Fragment,null,s.createElement(He.Y,{region:"shipping.shippingAddressForm.after"}),s.createElement(dt.A,{id:"checkout-shipping-options",legend:s.createElement(s.Fragment,null,s.createElement(Ft.A,{themeV2:c},s.createElement(r.A,{id:"shipping.shipping_method_label"})),e&&s.createElement(nt.A,{type:nt.v.Error},s.createElement("strong",null,s.createElement(r.A,{id:"shipping.cart_change_error"}))))},s.createElement(Ye,{isInitialValueLoaded:o,isMultiShippingMode:t,isUpdatingAddress:l,shippingFormRenderTimestamp:d,shouldShowShippingOptions:n})),i&&s.createElement(it.A,null),s.createElement("div",{className:"form-actions"},s.createElement(L.Ay,{className:c?"body-bold":"",disabled:a,id:"checkout-shipping-continue",isLoading:l,type:"submit",variant:L.Ak.Primary},s.createElement(r.A,{id:"common.continue_action"}))))};const Pt=(0,y.A)(w({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,shippingAddress:t,isBillingSameAsShipping:i,customerMessage:n})=>({billingSameAsShipping:i,orderComment:n,shippingAddress:(0,q.A)(e(null==t?void 0:t.countryCode),t)}),isInitialValid:({shippingAddress:e,getFields:t,language:i})=>!!e&&(0,D.A)({language:i,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:i})=>function(e){const t=[A.A.BraintreeAcceleratedCheckout,A.A.PayPalCommerceAcceleratedCheckout];return Boolean(e&&!t.includes(e))}(i)?(0,R.Ik)({shippingAddress:(0,R.RZ)((i=>(0,lt.A)({translate:(0,D.X)(e),formFields:t(null==i?void 0:i.countryCode)})))}):(0,R.Ik)({shippingAddress:(0,R.RZ)((i=>(0,D.A)({language:e,formFields:t(null==i?void 0:i.countryCode)})))}),enableReinitialize:!1})((({cartHasChanged:e,consignments:t,customerMessage:i,deinitialize:o,deleteConsignments:l,getFields:d,initialize:r,isBillingSameAsShipping:c,isInitialValueLoaded:m,isLoading:u,isShippingStepPending:h,isValid:S,validateForm:A,methodId:E,onUnhandledError:v=a.noop,setFieldValue:C,setValues:f,shippingAddress:y,shippingAutosaveDelay:b=1700,shippingFormRenderTimestamp:_,shouldShowOrderComments:I,updateAddress:N,values:O})=>{var M,k,w;const[L,F]=(0,s.useState)(!1),[B,P]=(0,s.useState)(!1),[z,R]=(0,s.useState)(!1),T=(0,s.useMemo)((()=>{var e;return d(null===(e=O.shippingAddress)||void 0===e?void 0:e.countryCode).find((({name:e})=>"stateOrProvinceCode"===e))}),[d,null===(M=O.shippingAddress)||void 0===M?void 0:M.countryCode]),x=(0,s.useRef)();(0,s.useEffect)((()=>(x.current=(0,a.debounce)(((e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield N(e,{params:{include:{"consignments.availableShippingOptions":t}}}),t&&R(!0)}finally{P(!1)}}))),b),()=>{var e;null===(e=x.current)||void 0===e||e.cancel()})),[]),(0,s.useEffect)((()=>{var e;T&&(null==y?void 0:y.stateOrProvinceCode)&&!(null===(e=O.shippingAddress)||void 0===e?void 0:e.stateOrProvinceCode)&&C("shippingAddress.stateOrProvinceCode",y.stateOrProvinceCode)}),[T,null==y?void 0:y.stateOrProvinceCode,null===(k=O.shippingAddress)||void 0===k?void 0:k.stateOrProvinceCode]),(0,s.useEffect)((()=>{_&&f({billingSameAsShipping:c,orderComment:i,shippingAddress:(0,q.A)(d(null==y?void 0:y.countryCode),y)})}),[_]);const V=!["amazonpay"].some((e=>e===E));return s.createElement(U.A,{autoComplete:"on"},s.createElement(dt.A,null,s.createElement(wt,{consignments:t,deinitialize:o,formFields:d(null===(w=O.shippingAddress)||void 0===w?void 0:w.countryCode),hasRequestedShippingOptions:z,initialize:r,isLoading:L,isShippingStepPending:h,methodId:E,onAddressSelect:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){F(!0);try{yield N(e),f(Object.assign(Object.assign({},O),{shippingAddress:(0,q.A)(d(e.countryCode),e)}))}catch(e){v(e)}finally{F(!1)}})),onFieldChange:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){"countryCode"===e&&(C("shippingAddress.stateOrProvince",""),C("shippingAddress.stateOrProvinceCode","")),yield new Promise((e=>setTimeout(e)));const t=(yield A()).shippingAddress;if(t&&Object.keys(t).length>0)return;(e=>{var t;const i=O.shippingAddress&&(0,p.A)(O.shippingAddress);let n=e;Array.isArray(null==y?void 0:y.customFields)&&(n=!(0,a.isEqual)(null==y?void 0:y.customFields,null==i?void 0:i.customFields)||e),i&&!(0,g.A)(i,y)&&(P(!0),null===(t=x.current)||void 0===t||t.call(x,i,n))})(Lt.includes(e)||!z)})),onUnhandledError:v,onUseNewAddress:()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){F(!0);try{const e=yield l();f(Object.assign(Object.assign({},O),{shippingAddress:(0,q.A)(d(null==e?void 0:e.countryCode),e)}))}catch(e){v(e)}finally{F(!1)}})),shippingAddress:y}),V&&s.createElement("div",{className:"form-body"},s.createElement(ct,null))),s.createElement(Bt,{cartHasChanged:e,isInitialValueLoaded:m,isLoading:u||B,isMultiShippingMode:!1,shippingFormRenderTimestamp:_,shouldDisableSubmit:!!S&&(u||B||!(0,et.A)(t)||!tt(t)),shouldShowOrderComments:I,shouldShowShippingOptions:S}))}))),zt=(0,y.A)((({cart:e,cartHasChanged:t,consignments:i,customerMessage:n,deinitialize:a,deleteConsignments:o,getFields:l,initialize:d,isBillingSameAsShipping:r,isLoading:c,isMultiShippingMode:m,methodId:p,onMultiShippingSubmit:g,onSingleShippingSubmit:u,onUnhandledError:h,shippingAddress:S,shouldShowOrderComments:A,updateAddress:E,isShippingStepPending:v,isInitialValueLoaded:C,shippingFormRenderTimestamp:f,setIsMultishippingMode:y})=>{const{checkoutState:{data:{getConfig:I}}}=(0,b.Q)(),N=I();(0,s.useEffect)((()=>{var t,n;if(f){const a=null!==(n=null===(t=null==N?void 0:N.checkoutSettings)||void 0===t?void 0:t.hasMultiShippingEnabled)&&void 0!==n&&n,s=!!e&&!!i&&a&&(0,_.A)(i,e.lineItems);y(s)}}),[f]);return m?s.createElement(ot,{cartHasChanged:t,customerMessage:n,defaultCountryCode:null==S?void 0:S.countryCode,isLoading:c,onSubmit:g,onUnhandledError:h}):s.createElement(Pt,{cartHasChanged:t,consignments:i,customerMessage:n,deinitialize:a,deleteConsignments:o,getFields:l,initialize:d,isBillingSameAsShipping:r,isInitialValueLoaded:C,isLoading:c,isShippingStepPending:v,methodId:p,onSubmit:u,onUnhandledError:h,shippingAddress:S,shippingFormRenderTimestamp:f,shouldShowOrderComments:A,updateAddress:E})})),Rt=(0,s.memo)((({isMultiShippingMode:e,onMultiShippingChange:t,shouldShowMultiShipping:i,cartHasPromotionalItems:n})=>{const[a,o]=(0,s.useState)(!1),[l,d]=(0,s.useState)(!1),{themeV2:c}=(0,O.w)(),p=i&&e,g=i&&!e&&n;return s.createElement(s.Fragment,null,s.createElement(He.Y,{region:"shipping.shippingAddressForm.before"}),s.createElement("div",{className:N()(["form-legend-container","shipping-header"])},s.createElement(Ft.A,{testId:"shipping-address-heading",themeV2:c},s.createElement(r.A,{id:e?"shipping.multishipping_address_heading":"shipping.shipping_address_heading"})),p&&s.createElement(s.Fragment,null,s.createElement(m.A,{action:()=>{o(!1),t()},actionButtonLabel:s.createElement(r.A,{id:"common.proceed_action"}),headerId:"shipping.ship_to_single_action",isModalOpen:a,messageId:"shipping.ship_to_single_message",onRequestClose:()=>o(!1)}),s.createElement("a",{className:c?"body-cta":"","data-test":"shipping-mode-toggle",href:"#",onClick:(0,F.A)((()=>o(!0)))},s.createElement(r.A,{id:"shipping.ship_to_single"}))),g&&s.createElement(s.Fragment,null,s.createElement(m.A,{action:()=>d(!1),actionButtonLabel:s.createElement(r.A,{id:"common.back_action"}),headerId:"shipping.multishipping_unavailable_action",isModalOpen:l,messageId:"shipping.multishipping_unavailable_message",onRequestClose:()=>d(!1)}),s.createElement("a",{className:c?"body-cta":"","data-test":"shipping-mode-toggle",href:"#",onClick:(0,F.A)((()=>d(!0)))},s.createElement(r.A,{id:"shipping.ship_to_multi"}))),!p&&!g&&i&&s.createElement("a",{className:c?"body-cta":"","data-test":"shipping-mode-toggle",href:"#",onClick:(0,F.A)(t)},s.createElement(r.A,{id:e?"shipping.ship_to_single":"shipping.ship_to_multi"}))))}));var Tt=i(59713);const Ut=({methodId:e,initialize:t,deinitialize:i,onUnhandledError:o=a.noop})=>((0,s.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t({methodId:e})}catch(e){o(e)}})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield i({methodId:e})}catch(e){o(e)}}))})),[]),s.createElement(s.Fragment,null,s.createElement("div",{className:"stepHeader",style:{padding:0}},s.createElement("div",{id:"StripeUpeShipping",style:{width:"100%"}})),s.createElement("br",null)));function xt(e,t){var i;const n={MX:{"Ags.":"AGU","B.C.":"BCN","B.C.S.":"BCS","Camp.":"CAM","Coah.":"COA","Col.":"COL","Chis.":"CHP","Chih.":"CHH","Dgo.":"DUR","Gto.":"GUA","Gro.":"GRO","Hgo.":"HID","Jal.":"JAL","Méx.":"MEX",CDMX:"MEX","Mich.":"MIC","Mor.":"MOR","Nay.":"NAY","N.L.":"NLE","Oax.":"OAX","Pue.":"PUE","Qro.":"QUE","Q.R.":"ROO","S.L.P.":"SLP","Sin.":"SIN","Son.":"SON","Tab.":"TAB","Tamps.":"TAM","Tlax.":"TLA","Ver.":"VER","Yuc.":"YUC","Zac.":"ZAC"},AR:{"Ciudad Autónoma de Buenos Aires":"C","Buenos Aires":"B",Catamarca:"K",Chaco:"H",Chubut:"U",Córdoba:"X",Corrientes:"W","Entre Ríos":"E",Formosa:"P",Jujuy:"Y","La Pampa":"L","La Rioja":"F",Mendoza:"M",Misiones:"N",Neuquén:"Q",Salta:"A","San Juan":"J","San Luis":"D","Santa Fe":"S","Santiago del Estero":"G","Tierra del Fuego":"V",Tucumán:"W"},IN:{"Andhra Pradesh":"AP","Arunachal Pradesh":"AR",Assam:"AS",Bihar:"BR",Chhattisgarh:"CG",Goa:"GA",Gujarat:"GJ",Haryana:"HR","Himachal Pradesh":"HP","Jammu and Kashmir":"JK",Jharkhand:"JH",Karnataka:"KA",Kerala:"KL","Madhya Pradesh":"MP",Maharashtra:"MH",Manipur:"MN",Meghalaya:"ML",Mizoram:"MZ",Nagaland:"NL",Odisha:"OR",Punjab:"PB",Rajasthan:"RJ",Sikkim:"SK","Tamil Nadu":"TN",Tripura:"TR",Uttarakhand:"UK","Uttar Pradesh":"UP","West Bengal":"WB","Andaman and Nicobar Islands":"AN",Chandigarh:"CH","Dadra and Nagar Haveli and Daman and Diu":"DN",Lakshadweep:"LD",Delhi:"DL",Puducherry:"PY",Telangana:"TS"},ID:{Bali:"BA",Banten:"BT",Bengkulu:"BE",Aceh:"DA","DKI Jakarta":"JK","Sumatera Utara":"SU","Sumatera Barat":"SB",Riau:"SI",Jambi:"JA","Sumatera Selatan":"SS",Lampung:"LA","Jawa Barat":"JB","Jawa Timur":"JT","Daerah Istimewa Yogyakarta":"DY","Kalimantan Barat":"KB","Kalimantan Tengah":"KT","Kalimantan Timur":"KI","Kalimantan Selatan":"KS","Nusa Tenggara Barat":"NB","Nusa Tenggara Timur":"NT","Sulawesi Selatan":"SN","Sulawesi Tengah":"ST","Sulawesi Utara":"SA","Sulawesi Tenggara":"SG",Maluku:"MA","Maluku Utara":"MU",Gorontalo:"GO"},MY:{Johor:"JHR",Kedah:"KDH",Kelantan:"KTN",Melaka:"MLK","Negeri Sembilan":"NSN",Pahang:"PHG","Pulau Pinang":"PNG",Perak:"PRK",Perlis:"PLS",Selangor:"SGR",Terengganu:"TRG",Sabah:"SBH",Sarawak:"SRW","Kuala Lumpur":"KUL",Labuan:"LBN",Putrajaya:"PJY"},IE:{Carlow:"CW",Cavan:"CN",Clare:"CE",Donegal:"DL",Dublin:"D",Galway:"G",Kildare:"KE",Kilkenny:"KK",Laois:"LS",Leitrim:"LM",Longford:"LD",Louth:"LH",Mayo:"MO",Meath:"MH",Monaghan:"MN",Offaly:"OY",Roscommon:"RN",Sligo:"SO",Tipperary:"TA",Waterford:"WD",Westmeath:"WH",Wexford:"WX",Wicklow:"WW"},JP:{Aichi:"23",Akita:"05",Aomori:"02",Chiba:"12",Ehime:"38",Fukui:"18",Fukuoka:"40",Fukushima:"07",Gifu:"21",Gunma:"10",Hiroshima:"34",Hokkaido:"01",Hyogo:"28",Ibaraki:"08",Ishikawa:"17",Iwate:"03",Kagawa:"37",Kagoshima:"46",Kanagawa:"14",Kochi:"39",Kumamoto:"43",Kyoto:"26",Mie:"24",Miyagi:"04",Miyazaki:"45",Nagano:"20",Nagasaki:"42",Nara:"29",Niigata:"15",Oita:"44",Okayama:"33",Okinawa:"47",Osaka:"27",Saga:"41",Saitama:"11",Shiga:"25",Shimane:"32",Shizuoka:"22",Tochigi:"09",Tokushima:"36",Tokyo:"13",Tottori:"31",Toyama:"16",Wakayama:"30",Yamagata:"06",Yamaguchi:"35",Yamanashi:"19"}};return n[e]?null!==(i=n[e][t])&&void 0!==i?i:function(e,t){return Object.keys(e).find((i=>e[i]===t))||t}(n[e],t):t}const Vt=(0,s.memo)((e=>{const{countries:t,consignments:i,onAddressSelect:a,initialize:o,deinitialize:l,shouldDisableSubmit:d,onSubmit:r,step:c,isStripeLoading:m,isStripeAutoStep:p,isShippingMethodLoading:g,shippingAddress:u}=e,[h,S]=(0,s.useState)(!0),[A,E]=(0,s.useState)(!0),[v,C]=(0,s.useState)({firstName:"",lastName:"",company:"",address1:"",address2:"",city:"",stateOrProvince:"",stateOrProvinceCode:"",shouldSaveAddress:!0,country:"",countryCode:"",postalCode:"",phone:"",customFields:[]}),f=(0,s.useCallback)((()=>{m&&m()}),[m]);(0,s.useEffect)((()=>{if(i[0]){const{availableShippingOptions:e}=i[0];e&&!ze(e)&&f()}}),[i]),(0,s.useEffect)((()=>{v.firstName&&(0,et.A)(i)&&(!A&&!h&&!g)&&(m&&p)&&(m(),p(),r({billingSameAsShipping:!0,shippingAddress:v,orderComment:""}))}),[A,r,v,d,g,h,i]);const y=null==t?void 0:t.map((e=>({code:e.code,name:e.name}))),b=y?y.map((e=>e.code)).join(", "):"",_=(0,s.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var t;const{complete:i,phoneFieldRequired:n,value:{address:s={country:"",state:"",line1:"",line2:"",city:"",postal_code:""},name:o="",firstName:l="",lastName:d="",phone:r=""}}=e;if(i){((e=!0,t,i)=>{const n=c.isComplete,a=(null==u?void 0:u.firstName)&&e;return n||a||t&&!i})(null==e?void 0:e.isNewAddress,n,r)&&f();const i=null==o?void 0:o.split(" "),m=null===(t=null==y?void 0:y.find((e=>e.code===s.country)))||void 0===t?void 0:t.name,p=xt(s.country,s.state),g={firstName:l||i[0],lastName:d||i[1],company:"",address1:s.line1,address2:s.line2||"",city:s.city,stateOrProvince:p,stateOrProvinceCode:p,shouldSaveAddress:!0,country:m||s.country,countryCode:s.country,postalCode:s.postal_code,phone:r||"",customFields:[]};c.isComplete||E((e=>!e)),a(g),C(g),e.isNewAddress!==h&&S((e=>!e))}else f()}))),[y,a]),I=(0,s.useCallback)((0,gt.memoizeOne)((e=>t=>o(Object.assign(Object.assign({},e),t)))),[]),N=(e,t)=>{const i=document.getElementById(e);if(i)return(0,Tt.A)(i,t)},O={stripeupe:{container:"StripeUpeShipping",onChangeShipping:_,availableCountries:b,getStyles:(0,s.useCallback)((()=>{const e="stripe-card-component-field",t=N(`${e}--input`,["color","background-color","border-color","box-shadow"]),i=N(`${e}--label`,["color"]),n=N(`${e}--error`,["color"]);return i&&t&&n?{labelText:i.color,fieldText:t.color,fieldPlaceholderText:t.color,fieldErrorText:n.color,fieldBackground:t["background-color"],fieldInnerShadow:t["box-shadow"],fieldBorder:t["border-color"]}:void 0}),[]),getStripeState:xt,gatewayId:"stripeupe",methodId:"card"}};return s.createElement(s.Fragment,null,s.createElement(Ut,{deinitialize:l,initialize:I(O),methodId:"stripeupe"}),(()=>{const e="stripe-card-component-field";return s.createElement("div",{className:"optimizedCheckout-form-input",id:`${e}--input`},s.createElement("div",{className:"form-field--error"},s.createElement("div",{className:"optimizedCheckout-form-label",id:`${e}--error`})),s.createElement("div",{className:"optimizedCheckout-form-label",id:`${e}--label`}))})())})),jt=(0,y.A)(w({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,shippingAddress:t,isBillingSameAsShipping:i,customerMessage:n})=>({billingSameAsShipping:i,orderComment:n,shippingAddress:(0,q.A)(e(t&&t.countryCode),t)}),isInitialValid:({shippingAddress:e,getFields:t,language:i})=>!!e&&(0,D.A)({language:i,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:i})=>i?(0,R.Ik)({shippingAddress:(0,R.RZ)((i=>(0,lt.A)({translate:(0,D.X)(e),formFields:t(i&&i.countryCode)})))}):(0,R.Ik)({shippingAddress:(0,R.RZ)((i=>(0,D.A)({language:e,formFields:t(i&&i.countryCode)})))}),enableReinitialize:!1})((e=>{const{checkoutService:t,checkoutState:i}=(0,b.Q)(),{data:{getConsignments:o,getShippingCountries:l}}=i,d=o()||[],r=t.initializeShipping,c=t.deinitializeShipping,m=l()||h.M,[p]=(0,s.useState)(!1),{cartHasChanged:g,isInitialValueLoaded:u,isLoading:S,isStripeLoading:A,shippingAddress:E,shouldShowOrderComments:v,isValid:C,onSubmit:f,isStripeAutoStep:y,step:_,isShippingMethodLoading:I,updateAddress:N,onUnhandledError:O=a.noop,values:M,setValues:k,getFields:w}=e,L=()=>!!C&&(S||p||!(0,et.A)(d)),F=(0,s.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield N(e),k(Object.assign(Object.assign({},M),{shippingAddress:(0,q.A)(w(e.countryCode),e)}))}catch(e){O(e)}}))),[M,k,O]);return s.createElement(U.A,{autoComplete:"on"},s.createElement(dt.A,null,s.createElement(Vt,{consignments:d,countries:m,deinitialize:c,initialize:r,isShippingMethodLoading:I,isStripeAutoStep:y,isStripeLoading:A,onAddressSelect:F,onSubmit:f,shippingAddress:E,shouldDisableSubmit:L(),step:_}),s.createElement("div",{className:"form-body"},s.createElement(ct,null))),s.createElement(Bt,{cartHasChanged:g,isInitialValueLoaded:u,isLoading:S||p,isMultiShippingMode:!1,shouldDisableSubmit:L(),shouldShowOrderComments:v,shouldShowShippingOptions:C}))}))),Ht=e=>{var{isBillingSameAsShipping:t,shouldShowMultiShipping:i,updateAddress:a,isMultiShippingMode:o,step:l,onSubmit:d,onMultiShippingChange:r,isLoading:m,isShippingMethodLoading:p}=e,g=(0,n.__rest)(e,["isBillingSameAsShipping","shouldShowMultiShipping","updateAddress","isMultiShippingMode","step","onSubmit","onMultiShippingChange","isLoading","isShippingMethodLoading"]);const{checkoutState:u}=(0,b.Q)(),{data:{getCheckout:h,getShippingAddressFields:S}}=u,A=h(),E=S,[v,C]=(0,s.useState)(!0),[f,y]=(0,s.useState)(!1);if(!A)return null;const _=A.customerMessage;return s.createElement(s.Fragment,null,s.createElement(c.A,{isLoading:f||v}),s.createElement("div",{className:"checkout-form",style:{display:f||v?"none":void 0}},s.createElement(Rt,{isMultiShippingMode:o,onMultiShippingChange:r,shouldShowMultiShipping:i}),s.createElement(jt,Object.assign({customerMessage:_,getFields:E},g,{isBillingSameAsShipping:t,isLoading:m,isMultiShippingMode:o,isShippingMethodLoading:p,isStripeAutoStep:()=>{y(!0)},isStripeLoading:()=>{C(!1)},onSubmit:d,step:l,updateAddress:a}))))};class Dt extends s.Component{constructor(e){super(e),this.handleMultiShippingModeSwitch=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{consignments:e,isMultiShippingMode:t,onToggleMultiShipping:i=a.noop,onUnhandledError:n=a.noop,updateShippingAddress:s,deleteConsignments:o}=this.props;try{this.setState({isInitializing:!0}),t&&e.length?yield s(e[0].shippingAddress):yield o()}catch(e){n(e)}finally{this.setState({isInitializing:!1})}i()})),this.handleSingleShippingSubmit=e=>(0,n.__awaiter)(this,[e],void 0,(function*({billingSameAsShipping:e,shippingAddress:t,orderComment:i}){const{customerMessage:n,updateCheckout:a,updateShippingAddress:s,updateBillingAddress:o,navigateNextStep:l,onUnhandledError:d,shippingAddress:r,billingAddress:c,methodId:m}=this.props,u=t&&(0,p.A)(t),h=[],S=this.hasRemoteBilling(m);(0,g.A)(u,r)&&(null==r?void 0:r.shouldSaveAddress)===(null==u?void 0:u.shouldSaveAddress)||h.push(s(u||{})),e&&u&&!(0,g.A)(u,c)&&!S&&h.push(o(u)),n!==i&&h.push(a({customerMessage:i}));try{yield Promise.all(h),l(e)}catch(e){e instanceof Error&&d(e)}})),this.hasRemoteBilling=e=>["amazonpay"].some((t=>t===e)),this.handleMultiShippingSubmit=e=>(0,n.__awaiter)(this,[e],void 0,(function*({orderComment:e}){const{customerMessage:t,updateCheckout:i,navigateNextStep:n,onUnhandledError:a}=this.props;try{t!==e&&(yield i({customerMessage:e})),n(!1)}catch(e){e instanceof Error&&a(e)}})),this.state={isInitializing:!0,isMultiShippingUnavailableModalOpen:!1}}componentDidMount(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{loadShippingAddressFields:e,loadBillingAddressFields:t,loadShippingOptions:i,onReady:n=a.noop,onUnhandledError:s=a.noop,cartHasPromotionalItems:o,isMultiShippingMode:l}=this.props;try{yield Promise.all([e(),i(),t()]),o&&l&&this.setState({isMultiShippingUnavailableModalOpen:!0}),n()}catch(e){s(e)}finally{this.setState({isInitializing:!1})}}))}render(){const e=this.props,{isBillingSameAsShipping:t,isGuest:i,shouldShowMultiShipping:a,customer:o,updateShippingAddress:l,initializeShippingMethod:d,deinitializeShippingMethod:p,isMultiShippingMode:g,step:u,shouldRenderStripeForm:h,cartHasPromotionalItems:S,extensionState:{shippingFormRenderTimestamp:A}={},setIsMultishippingMode:E}=e,v=(0,n.__rest)(e,["isBillingSameAsShipping","isGuest","shouldShowMultiShipping","customer","updateShippingAddress","initializeShippingMethod","deinitializeShippingMethod","isMultiShippingMode","step","shouldRenderStripeForm","cartHasPromotionalItems","extensionState","setIsMultishippingMode"]),{isInitializing:C,isMultiShippingUnavailableModalOpen:f}=this.state;return h&&!o.email&&this.props.countries.length>0?s.createElement(Ht,Object.assign({},v,{isBillingSameAsShipping:t,isInitialValueLoaded:!C,isLoading:C,isMultiShippingMode:g,isShippingMethodLoading:this.props.isLoading,onMultiShippingChange:this.handleMultiShippingModeSwitch,onSubmit:this.handleSingleShippingSubmit,shouldShowMultiShipping:a,step:u,updateAddress:l})):s.createElement(c.A,{isLoading:C,renderWhileLoading:!0},s.createElement("div",{className:"checkout-form"},s.createElement(m.A,{action:()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){this.setState({isMultiShippingUnavailableModalOpen:!1}),yield this.handleMultiShippingModeSwitch()})),actionButtonLabel:s.createElement(r.A,{id:"common.ok_action"}),headerId:"shipping.multishipping_unavailable_action",isModalOpen:f,messageId:"shipping.checkout_switched_to_single_shipping",shouldShowCloseButton:!1}),s.createElement(Rt,{cartHasPromotionalItems:S,isMultiShippingMode:g,onMultiShippingChange:this.handleMultiShippingModeSwitch,shouldShowMultiShipping:a}),s.createElement(zt,Object.assign({},v,{deinitialize:p,initialize:d,isBillingSameAsShipping:t,isGuest:i,isInitialValueLoaded:!C,isMultiShippingMode:g,onMultiShippingSubmit:this.handleMultiShippingSubmit,onSingleShippingSubmit:this.handleSingleShippingSubmit,setIsMultishippingMode:E,shippingFormRenderTimestamp:A,updateAddress:l}))))}}const qt=(0,o.createSelector)((({checkoutService:{deleteConsignment:e}})=>e),(({checkoutState:{data:e}})=>e.getConsignments()),((e,t)=>()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(!t||!t.length)return;const[{data:i}]=yield Promise.all(t.map((({id:t})=>e(t))));return i.getShippingAddress()}))));function $t({checkoutService:e,checkoutState:t}){const{data:{getCart:i,getCheckout:n,getConfig:a,getCustomer:s,getConsignments:o,getShippingAddress:l,getBillingAddress:r,getShippingAddressFields:c,getShippingCountries:m},statuses:{isShippingStepPending:p,isSelectingShippingOption:g,isLoadingShippingOptions:u,isUpdatingConsignment:v,isCreatingConsignments:y,isCreatingCustomerAddress:b,isLoadingShippingCountries:_,isUpdatingBillingAddress:I,isUpdatingCheckout:N,isDeletingConsignment:O,isLoadingCheckout:M}}=t,k=n(),w=a(),L=o()||[],F=s(),B=i();if(!(k&&w&&F&&B))return null;const{checkoutSettings:{enableOrderComments:P,hasMultiShippingEnabled:z}}=w,R=C(k,w),T=u()||g()||v()||y()||I()||N()||b()||O()||M(),U=(0,E.A)(B),x=z&&!R&&U>1,V=!x&&L.length>1?void 0:l(),j=(0,S.A)(w.checkoutSettings.providerWithCustomCheckout);return{assignItem:e.assignItemsToAddress,billingAddress:r(),cart:B,cartHasPromotionalItems:f(B),consignments:L,countries:m()||h.M,customer:F,customerMessage:k.customerMessage,createCustomerAddress:e.createCustomerAddress,deinitializeShippingMethod:e.deinitializeShipping,deleteConsignments:qt({checkoutService:e,checkoutState:t}),getFields:c,initializeShippingMethod:e.initializeShipping,isGuest:F.isGuest,isInitializing:_()||u(),isLoading:T,isShippingStepPending:p(),loadShippingAddressFields:e.loadShippingAddressFields,loadBillingAddressFields:e.loadBillingAddressFields,loadShippingOptions:e.loadShippingOptions,methodId:R,providerWithCustomCheckout:j,shippingAddress:V,shouldShowMultiShipping:x,shouldShowOrderComments:P,signOut:e.signOutCustomer,unassignItem:e.unassignItemsToAddress,updateBillingAddress:e.updateBillingAddress,updateCheckout:e.updateCheckout,updateShippingAddress:e.updateShippingAddress,shouldRenderStripeForm:j===A.A.StripeUPE&&(0,d.A)(B)}}const Kt=(0,l.c)((0,u.A)($t)(Dt))},24391:(e,t,i)=>{i.d(t,{A:()=>p});var n=i(31635),a=i(3375),s=i.n(a),o=i(69440),l=i(70355),d=i(38003),r=i.n(d),c=i(72769);const m=(0,i(2156).A)((()=>l.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})))),p=e=>{var{children:t,closeButtonLabel:i="Close",footer:a,header:d,additionalHeaderClassName:p,additionalBodyClassName:g,additionalModalClassName:u,onRequestClose:h=o.noop,shouldShowCloseButton:S=!1}=e,A=(0,n.__rest)(e,["children","closeButtonLabel","footer","header","additionalHeaderClassName","additionalBodyClassName","additionalModalClassName","onRequestClose","shouldShowCloseButton"]);const E=(0,l.useCallback)((e=>{h(e)}),[h]);return l.createElement(r(),Object.assign({},A,{ariaHideApp:!0,bodyOpenClassName:"has-activeModal",className:{base:s()("modal optimizedCheckout-contentPrimary",u),afterOpen:"modal--afterOpen",beforeClose:"modal--beforeClose"},closeTimeoutMS:200,onRequestClose:h,overlayClassName:{base:"modalOverlay",afterOpen:"modalOverlay--afterOpen",beforeClose:"modalOverlay--beforeClose"},shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!1}),l.createElement("div",{className:s()("modal-header",p)},d,S&&l.createElement("a",{className:"modal-close","data-test":"modal-close-button",href:"#",onClick:(0,c.A)(E)},Boolean(i)&&l.createElement("span",{className:"is-srOnly"},i),l.createElement(m,null))),l.createElement("div",{className:s()("modal-body",g),"data-test":"modal-body"},t),Boolean(a)&&l.createElement("div",{className:"modal-footer","data-test":"modal-footer"},a))}},24750:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(31635),a=i(3375),s=i.n(a),o=i(70355);const l=(0,o.forwardRef)(((e,t)=>{var{additionalClassName:i,children:a,className:l,legend:d,testId:r}=e,c=(0,n.__rest)(e,["additionalClassName","children","className","legend","testId"]);return o.createElement("fieldset",Object.assign({},c,{className:l||s()("form-fieldset",i),"data-test":r,ref:t}),d,o.createElement("div",{className:"form-body"},a))}))},32312:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(69440);const a=(0,i(70355).createContext)({onToggle:n.noop})},38116:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(70355);const a=(0,i(45080).A)((()=>n.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}))))},52523:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(70355);const a=({children:e,testId:t})=>n.createElement("span",{className:"tooltip tooltip--basic","data-test":t},e)},60288:(e,t,i)=>{i.d(t,{v:()=>c,A:()=>m});var n=i(3375),a=i.n(n),s=i(70355),o=i(2156);const l=(0,o.A)((()=>s.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})))),d=(0,o.A)((()=>s.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})))),r=(0,o.A)((()=>s.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}))));var c;!function(e){e.Error="error",e.Info="info",e.Success="success",e.Warning="warning"}(c||(c={}));const m=({additionalClassName:e,children:t,icon:i,testId:n,type:o})=>{const m=(0,s.useId)();return s.createElement("div",{"aria-describedby":m,className:a()("alertBox",e,{"alertBox--info":o===c.Info||!o},{"alertBox--error":o===c.Error},{"alertBox--success":o===c.Success},{"alertBox--warning":o===c.Warning}),"data-test":n},s.createElement("div",{className:"alertBox-column alertBox-icon"},i||function(e){switch(e){case c.Error:case c.Warning:return s.createElement(l,null);case c.Success:return s.createElement(d,null);case c.Info:default:return s.createElement(r,null)}}(o)),s.createElement("div",{"aria-live":o===c.Error?"assertive":"polite",className:"alertBox-column alertBox-message",id:m,role:o===c.Error?"alert":"status"},t))}},76966:(e,t,i)=>{i.d(t,{A:()=>o});var n=i(3375),a=i.n(n),s=i(70355);const o=({children:e,additionalClassName:t})=>s.createElement("h2",{className:a()("modal-header-title optimizedCheckout-headingSecondary",t),"data-test":"modal-heading"},e)},82259:(e,t,i)=>{i.d(t,{C:()=>c,A:()=>m});var n=i(31635),a=i(69440),s=i(70355),o=i(44218),l=i(32312);const d=({children:e,className:t="accordion",defaultSelectedItemId:i,isDisabled:n,onSelect:d=a.noop})=>{const[r,c]=(0,s.useState)(i),m=e=>{n||(c(e),d(e))},p=(0,o.memoizeOne)((e=>({onToggle:m,selectedItemId:e})));return s.createElement(l.A.Provider,{value:p(r)},s.createElement("ul",{className:t},e))};var r=i(83742);const c=(0,s.createContext)(void 0),m=(0,r.A)((0,s.memo)((e=>{var{formik:{setFieldValue:t},name:i,onSelect:o=a.noop}=e,l=(0,n.__rest)(e,["formik","name","onSelect"]);(0,s.useEffect)((()=>()=>{t(i,"")}),[]);const r=(0,s.useCallback)((e=>{t(i,e),o(e)}),[i,o,t]),m=(0,s.useMemo)((()=>({name:i})),[i]);return s.createElement(c.Provider,{value:m},s.createElement(d,Object.assign({},l,{className:"form-checklist optimizedCheckout-form-checklist",onSelect:r})))})))},83651:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(70355);const a=(0,i(45080).A)((()=>n.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}))))},83742:(e,t,i)=>{i.d(t,{A:()=>d});var n=i(31635),a=i(69462),s=i(70355),o=i(30540),l=i.n(o);function d(e){const t=(0,s.memo)((t=>s.createElement(e,Object.assign({},t))),((e,t)=>{var{formik:i}=e,a=(0,n.__rest)(e,["formik"]),s=t.formik,o=(0,n.__rest)(t,["formik"]);return l()(i,s)&&l()(a,o)})),i=(0,a.Ng)(t);return i.displayName=`ConnectFormik(${e.displayName||e.name})`,i}},97429:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(70355),a=i(77175),s=i(32657),o=i(75514);const l=({children:e,placement:t="bottom",tooltip:i})=>{const[l,d]=(0,n.useState)(!1),r=()=>{d(!0)},c=()=>{d(!1)};return n.createElement(a.mS,null,n.createElement(s.O,null,(({ref:t})=>n.createElement("span",{onBlur:c,onFocus:r,onMouseEnter:r,onMouseLeave:c,ref:t},e))),n.createElement(o.N,{modifiers:[{name:"hide",enabled:!1},{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}],placement:t},(({ref:e,style:t})=>l&&n.createElement("div",{ref:e,style:t},i))))}}}]);
//# sourceMappingURL=shipping-2e7de415.js.map