{"version":3,"file":"billing-ac840dfa.js","mappings":"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","sources":["webpack://checkout/./packages/core/src/app/billing/BillingForm.tsx","webpack://checkout/./packages/core/src/app/billing/Billing.tsx","webpack://checkout/./packages/core/src/app/billing/getBillingMethodId.ts"],"sourcesContent":["import {\n    type Address,\n    type FormField,\n} from '@bigcommerce/checkout-sdk';\nimport { type FormikProps, withFormik } from 'formik';\nimport React, { type RefObject, useRef, useState } from 'react';\nimport { lazy } from 'yup';\n\nimport { TranslatedString, withLanguage, type WithLanguageProps } from '@bigcommerce/checkout/locale';\nimport { useCheckout } from '@bigcommerce/checkout/payment-integration-api';\nimport { usePayPalFastlaneAddress } from '@bigcommerce/checkout/paypal-fastlane-integration';\nimport { AddressFormSkeleton, LoadingOverlay, useThemeContext } from '@bigcommerce/checkout/ui';\n\nimport {\n  AddressForm,\n  type AddressFormValues,\n  AddressSelect,\n  AddressType,\n  getAddressFormFieldsValidationSchema,\n  getTranslateAddressError,\n  isValidCustomerAddress,\n  mapAddressToFormValues,\n} from '../address';\nimport { EMPTY_ARRAY, isFloatingLabelEnabled as getIsFloatingLabelEnabled } from '../common/utility';\nimport { getCustomFormFieldsValidationSchema } from '../formFields';\nimport { OrderComments } from '../orderComments';\nimport { getShippableItemsCount } from '../shipping';\nimport { Button, ButtonVariant } from '../ui/button';\nimport { Fieldset, Form } from '../ui/form';\n\nimport StaticBillingAddress from './StaticBillingAddress';\n\nexport type BillingFormValues = AddressFormValues & { orderComment: string };\n\nexport interface BillingFormProps {\n    methodId?: string;\n    billingAddress?: Address;\n    customerMessage: string;\n    navigateNextStep(): void;\n    onSubmit(values: BillingFormValues): void;\n    onUnhandledError(error: Error): void;\n    getFields(countryCode?: string): FormField[];\n}\n\nconst BillingForm = ({\n    methodId,\n    getFields,\n    billingAddress,\n    setFieldValue,\n    values,\n    onUnhandledError,\n}: BillingFormProps & WithLanguageProps & FormikProps<BillingFormValues>) => {\n    const [isResettingAddress, setIsResettingAddress] = useState(false);\n    const addressFormRef: RefObject<HTMLFieldSetElement> = useRef(null);\n    const { isPayPalFastlaneEnabled, paypalFastlaneAddresses } = usePayPalFastlaneAddress();\n\n    const { themeV2 } = useThemeContext();\n    const { checkoutService, checkoutState } = useCheckout();\n\n    const {\n        data: { getCustomer, getConfig, getBillingCountries, getCart },\n        statuses: { isUpdatingBillingAddress, isUpdatingCheckout },\n    } = checkoutState;\n    const customer = getCustomer();\n    const config = getConfig();\n    const cart = getCart();\n\n    if (!config || !customer || !cart) {\n        throw new Error('checkout data is not available');\n    }\n\n    const isGuest = customer.isGuest;\n    const addresses = customer.addresses;\n    const shouldRenderStaticAddress = methodId === 'amazonpay';\n    const allFormFields = getFields(values.countryCode);\n    const customFormFields = allFormFields.filter(({ custom }) => custom);\n    const hasCustomFormFields = customFormFields.length > 0;\n    const editableFormFields =\n        shouldRenderStaticAddress && hasCustomFormFields ? customFormFields : allFormFields;\n    const billingAddresses = isGuest && isPayPalFastlaneEnabled ? paypalFastlaneAddresses : addresses;\n    const hasAddresses = billingAddresses?.length > 0;\n    const hasValidCustomerAddress =\n        billingAddress &&\n        isValidCustomerAddress(\n            billingAddress,\n            billingAddresses,\n            getFields(billingAddress.countryCode),\n        );\n    const isUpdating  = isUpdatingBillingAddress() || isUpdatingCheckout();\n    const { enableOrderComments } = config.checkoutSettings;\n    const shouldShowOrderComments  = enableOrderComments && getShippableItemsCount(cart) < 1;\n\n    const handleSelectAddress = async (address: Partial<Address>) => {\n        setIsResettingAddress(true);\n\n        try {\n            await checkoutService.updateBillingAddress(address);\n        } catch (error) {\n            if (error instanceof Error) {\n                onUnhandledError(error);\n            }\n        } finally {\n            setIsResettingAddress(false);\n        }\n    };\n\n    const handleUseNewAddress = () => {\n        void handleSelectAddress({});\n    };\n\n    // Below should be removed once <AddressForm /> is able to reduce prop drilling\n    const countries = getBillingCountries() || EMPTY_ARRAY;\n    const countriesWithAutocomplete = ['US', 'CA', 'AU', 'NZ', 'GB'];\n    const { googleMapsApiKey } = config.checkoutSettings;\n    const isFloatingLabelEnabled = getIsFloatingLabelEnabled(config.checkoutSettings)\n\n    return (\n        <Form autoComplete=\"on\">\n            {shouldRenderStaticAddress && billingAddress && (\n                <div className=\"form-fieldset\">\n                    <StaticBillingAddress address={billingAddress} />\n                </div>\n            )}\n\n            <Fieldset id=\"checkoutBillingAddress\" ref={addressFormRef}>\n                {hasAddresses && !shouldRenderStaticAddress && (\n                    <Fieldset id=\"billingAddresses\">\n                        <LoadingOverlay isLoading={isResettingAddress}>\n                            <AddressSelect\n                                addresses={billingAddresses}\n                                onSelectAddress={handleSelectAddress}\n                                onUseNewAddress={handleUseNewAddress}\n                                selectedAddress={\n                                    hasValidCustomerAddress ? billingAddress : undefined\n                                }\n                                type={AddressType.Billing}\n                            />\n                        </LoadingOverlay>\n                    </Fieldset>\n                )}\n\n                {!hasValidCustomerAddress && (\n                    <AddressFormSkeleton isLoading={isResettingAddress}>\n                        <AddressForm\n                            countries={countries}\n                            countriesWithAutocomplete={countriesWithAutocomplete}\n                            countryCode={values.countryCode}\n                            formFields={editableFormFields}\n                            googleMapsApiKey={googleMapsApiKey}\n                            isFloatingLabelEnabled={isFloatingLabelEnabled}\n                            setFieldValue={setFieldValue}\n                            shouldShowSaveAddress={!isGuest}\n                        />\n                    </AddressFormSkeleton>\n                )}\n            </Fieldset>\n\n            {shouldShowOrderComments && <OrderComments />}\n\n            <div className=\"form-actions\">\n                <Button\n                    className={themeV2 ? 'body-bold' : ''}\n                    disabled={isUpdating || isResettingAddress}\n                    id=\"checkout-billing-continue\"\n                    isLoading={isUpdating || isResettingAddress}\n                    type=\"submit\"\n                    variant={ButtonVariant.Primary}\n                >\n                    <TranslatedString id=\"common.continue_action\" />\n                </Button>\n            </div>\n        </Form>\n    );\n};\n\nexport default withLanguage(\n    withFormik<BillingFormProps & WithLanguageProps, BillingFormValues>({\n        handleSubmit: (values, { props: { onSubmit } }) => {\n            onSubmit(values);\n        },\n        mapPropsToValues: ({ getFields, customerMessage, billingAddress }) => ({\n            ...mapAddressToFormValues(\n                getFields(billingAddress && billingAddress.countryCode),\n                billingAddress,\n            ),\n            orderComment: customerMessage,\n        }),\n        isInitialValid: ({ billingAddress, getFields, language }) =>\n            !!billingAddress &&\n            getAddressFormFieldsValidationSchema({\n                language,\n                formFields: getFields(billingAddress.countryCode),\n            }).isValidSync(billingAddress),\n        validationSchema: ({\n            language,\n            getFields,\n            methodId,\n        }: BillingFormProps & WithLanguageProps) =>\n            methodId === 'amazonpay'\n                ? lazy<Partial<AddressFormValues>>((values) =>\n                      getCustomFormFieldsValidationSchema({\n                          translate: getTranslateAddressError(language),\n                          formFields: getFields(values && values.countryCode),\n                      }),\n                  )\n                : lazy<Partial<AddressFormValues>>((values) =>\n                      getAddressFormFieldsValidationSchema({\n                          language,\n                          formFields: getFields(values && values.countryCode),\n                      }),\n                  ),\n        enableReinitialize: true,\n    })(BillingForm),\n);\n","import type { CheckoutSelectors } from '@bigcommerce/checkout-sdk';\nimport React, { type ReactElement, useEffect } from 'react';\n\nimport { TranslatedString } from '@bigcommerce/checkout/locale';\nimport {\n    useCheckout,\n} from '@bigcommerce/checkout/payment-integration-api';\nimport { AddressFormSkeleton, useThemeContext } from '@bigcommerce/checkout/ui';\n\nimport { isEqualAddress, mapAddressFromFormValues } from '../address';\nimport { Legend } from '../ui/form';\n\nimport BillingForm, { type BillingFormValues } from './BillingForm';\nimport getBillingMethodId from './getBillingMethodId';\n\ninterface BillingProps {\n    navigateNextStep(): void;\n    onReady(): void;\n    onUnhandledError(error: Error): void;\n}\n\nconst Billing = ({navigateNextStep, onReady, onUnhandledError}:BillingProps): ReactElement => {\n    const { checkoutService, checkoutState } = useCheckout();\n    const { themeV2 }  = useThemeContext();\n\n    const {\n        data: {\n            getCheckout,\n            getConfig,\n            getCart,\n            getCustomer,\n            getBillingAddress,\n            getBillingAddressFields,\n        },\n        statuses: { isLoadingBillingCountries },\n    } = checkoutState;\n    const config = getConfig();\n    const customer = getCustomer();\n    const checkout = getCheckout();\n    const cart = getCart();\n\n    if (!config || !customer || !checkout || !cart) {\n        throw new Error('Unable to access checkout data')\n    }\n\n    const isInitializing  = isLoadingBillingCountries();\n\n    // Below constants are for <BillingForm />'s HOC props\n    const customerMessage  = checkout.customerMessage;\n    const methodId  = getBillingMethodId(checkout);\n    const billingAddress  = getBillingAddress();\n    const getFields  = getBillingAddressFields;\n    const handleSubmit = async ({\n                                    orderComment,\n                                    ...addressValues\n                                }: BillingFormValues):Promise<void> => {\n        const updateAddress  = checkoutService.updateBillingAddress;\n        const updateCheckout  = checkoutService.updateCheckout;\n        const billingAddress  = getBillingAddress();\n        const promises: Array<Promise<CheckoutSelectors>> = [];\n        const address = mapAddressFromFormValues(addressValues);\n\n        if (address && !isEqualAddress(address, billingAddress)) {\n            promises.push(updateAddress(address));\n        }\n\n        if (customerMessage !== orderComment) {\n            promises.push(updateCheckout({ customerMessage: orderComment }));\n        }\n\n        try {\n            await Promise.all(promises);\n\n            navigateNextStep();\n        } catch (error) {\n            if (error instanceof Error) {\n                onUnhandledError(error);\n            }\n        }\n    };\n\n    useEffect(() => {\n        const init = async () => {\n            try {\n                await checkoutService.loadBillingAddressFields();\n                onReady();\n            } catch (error) {\n                if (error instanceof Error) {\n                    onUnhandledError(error);\n                }\n            }\n        }\n\n        void init();\n    }, []);\n\n    return (\n        <AddressFormSkeleton isLoading={isInitializing}>\n            <div className=\"checkout-form\">\n                <div className=\"form-legend-container\">\n                    <Legend testId=\"billing-address-heading\" themeV2={themeV2}>\n                        <TranslatedString id=\"billing.billing_address_heading\" />\n                    </Legend>\n                </div>\n                <BillingForm\n                    billingAddress={billingAddress}\n                    customerMessage={customerMessage}\n                    getFields={getFields}\n                    methodId={methodId}\n                    navigateNextStep={navigateNextStep}\n                    onSubmit={handleSubmit}\n                    onUnhandledError={onUnhandledError}\n                />\n            </div>\n        </AddressFormSkeleton>\n    );\n}\n\nexport default Billing;\n","import { type Checkout } from '@bigcommerce/checkout-sdk';\n\nimport { getPreselectedPayment } from '../payment';\n\nexport default function getBillingMethodId(checkout: Checkout): string | undefined {\n    const BILLING_METHOD_IDS = ['amazonpay'];\n    const preselectedPayment = getPreselectedPayment(checkout);\n\n    return preselectedPayment && BILLING_METHOD_IDS.includes(preselectedPayment.providerId)\n        ? preselectedPayment.providerId\n        : undefined;\n}\n"],"names":["withLanguage","handleSubmit","values","props","onSubmit","mapPropsToValues","getFields","customerMessage","billingAddress","mapAddressToFormValues","countryCode","orderComment","isInitialValid","language","getAddressFormFieldsValidationSchema","formFields","isValidSync","validationSchema","methodId","getCustomFormFieldsValidationSchema","translate","enableReinitialize","setFieldValue","onUnhandledError","isResettingAddress","setIsResettingAddress","useState","addressFormRef","useRef","isPayPalFastlaneEnabled","paypalFastlaneAddresses","usePayPalFastlaneAddress","themeV2","checkoutService","checkoutState","data","getCustomer","getConfig","getBillingCountries","getCart","statuses","isUpdatingBillingAddress","isUpdatingCheckout","customer","config","cart","Error","isGuest","addresses","shouldRenderStaticAddress","allFormFields","customFormFields","filter","custom","hasCustomFormFields","length","editableFormFields","billingAddresses","hasAddresses","hasValidCustomerAddress","isValidCustomerAddress","isUpdating","enableOrderComments","checkoutSettings","shouldShowOrderComments","getShippableItemsCount","handleSelectAddress","address","updateBillingAddress","error","countries","googleMapsApiKey","isFloatingLabelEnabled","Form","autoComplete","className","StaticBillingAddress","Fieldset","id","ref","LoadingOverlay","isLoading","AddressSelect","A","onSelectAddress","onUseNewAddress","selectedAddress","undefined","type","AddressType","Billing","AddressFormSkeleton","AddressForm","countriesWithAutocomplete","shouldShowSaveAddress","OrderComments","Button","disabled","variant","Primary","TranslatedString","navigateNextStep","onReady","getCheckout","getBillingAddress","getBillingAddressFields","isLoadingBillingCountries","checkout","isInitializing","preselectedPayment","getPreselectedPayment","includes","providerId","getBillingMethodId","useEffect","loadBillingAddressFields","Legend","testId","addressValues","updateAddress","updateCheckout","promises","mapAddressFromFormValues","isEqualAddress","push","Promise","all"],"sourceRoot":""}