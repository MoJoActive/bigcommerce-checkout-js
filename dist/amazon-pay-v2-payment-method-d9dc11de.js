"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[3380],{29905:(e,t,n)=>{function i(e){switch(e){case"amex":case"american_express":return"american-express";case"diners":case"diners_club":return"diners-club";default:return e}}n.d(t,{A:()=>i})},31448:(e,t,n)=>{n.d(t,{A:()=>i});const i=(0,n(84494).Mz)((({data:e})=>{const t=e.getCart();return t&&t.lineItems}),(e=>(t,n)=>!!e&&function({lineItems:e,instrument:t,paymentMethod:n}){const{isVaultingCardNumberValidationAvailable:i=!0}=(null==n?void 0:n.initializationData)||{};return!(0===e.physicalItems.length||!i||t.trustedShippingAddress)}({lineItems:e,instrument:t,paymentMethod:n})))},48407:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(84494);const a=["bluesnapdirect"];const s=(0,i.Mz)((({data:e})=>{const t=e.getCart();return t&&t.lineItems}),(e=>(t,n)=>!!e&&function({instrument:e,lineItems:t,paymentMethod:n}){const{config:{isVaultingCvvEnabled:i,cardCode:s},initializationData:r}=n,{isVaultingCardCodeValidationAvailable:d=!0}=r||{};return!(a.includes(e.provider)||!d||!(t.digitalItems.length>0||t.giftCertificates.length>0)&&(e.trustedShippingAddress?!i:!i&&!s))}({instrument:t,lineItems:e,paymentMethod:n})))},62677:(e,t,n)=>{n.d(t,{A:()=>k});var i=n(70355),a=n(49655),s=n(24750),r=n(40052),d=n(35393),o=n(97834),l=n(22437),u=n(3375),m=n.n(u),c=n(52921),p=n.n(c),y=n(69440),h=n(86516),I=n(47237),g=n(29905);const E=({className:e,instrument:t,testId:n,shouldHideExpiryDate:s=!1,onClick:r})=>{var d;const o=(0,g.A)(t.brand),u=p().getTypeInfo(o),c=!(0,l.expirationDate)({month:t.expiryMonth,year:t.expiryYear}).isValid;return i.createElement("button",{className:e,"data-test":n,onClick:r,type:"button"},i.createElement("div",{className:m()("instrumentSelect-details",{"instrumentSelect-details--expired":c})},i.createElement(h.A,{cardType:o}),i.createElement("div",{className:"instrumentSelect-card","data-test":`${null!=n?n:""}-last4`},u?i.createElement(a.A,{data:{cardTitle:null!==(d=u.niceType)&&void 0!==d?d:"",endingIn:t.last4},id:"payment.instrument_ending_in_text"}):i.createElement(a.A,{data:{endingIn:t.last4},id:"payment.instrument_default_ending_in_text"})),!s&&i.createElement("div",{className:m()("instrumentSelect-expiry",{"instrumentSelect-expiry--expired":c}),"data-test":`${n||""}-expiry`},c?i.createElement(a.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expired_text"}):i.createElement(a.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expires_text"}))))},v=({instrument:e,shouldHideExpiryDate:t=!1,onClick:n=y.noop})=>{const a=(0,i.useCallback)((()=>{n(e.bigpayToken)}),[n,e]);return i.createElement(E,{instrument:e,onClick:a,shouldHideExpiryDate:t,testId:"instrument-select-option"})},f=({className:e,testId:t,onClick:n=y.noop})=>i.createElement("button",{className:e,"data-test":t,onClick:n,type:"button"},i.createElement("div",{className:"instrumentSelect-details instrumentSelect-details--addNew"},i.createElement(h.A,null),i.createElement("div",{className:"instrumentSelect-card"},i.createElement(a.A,{id:"payment.instrument_add_card_action"})))),C=({instruments:e,selectedInstrumentId:t,shouldHideExpiryDate:n=!1,onSelectInstrument:a,onUseNewInstrument:s})=>i.createElement("ul",{className:"instrumentSelect-dropdownMenu instrumentSelect-dropdownMenuNext dropdown-menu","data-test":"instrument-select-menu"},e.map((e=>i.createElement("li",{className:m()("instrumentSelect-option dropdown-menu-item",{"instrumentSelect-option--selected":e.bigpayToken===t}),key:e.bigpayToken},i.createElement(v,{instrument:e,onClick:a,shouldHideExpiryDate:n,testId:"instrument-select-option"})))),i.createElement("li",{className:"instrumentSelect-option instrumentSelect-option--addNew dropdown-menu-item"},i.createElement(f,{onClick:s,testId:"instrument-select-option-use-new"}))),b=({instrument:e,shouldHideExpiryDate:t=!1,testId:n,onClick:a})=>e?i.createElement(E,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",instrument:e,onClick:a,shouldHideExpiryDate:t,testId:n}):i.createElement(f,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",testId:n}),S=({field:e,form:t,instruments:n,onSelectInstrument:a,onUseNewInstrument:s,selectedInstrumentId:r,shouldHideExpiryDate:d=!1})=>{const o=(0,i.useRef)(r),l=(0,i.useCallback)(((n="")=>{t.setFieldValue(e.name,n)}),[t,e.name]);(0,i.useEffect)((()=>(setTimeout((()=>l(r))),()=>{""===e.value&&void 0!==r&&l()})),[]),(0,i.useEffect)((()=>{o.current!==r&&l(r),o.current=r}),[r,l]);const u=(0,y.find)(n,{bigpayToken:r});return i.createElement("div",{className:"instrumentSelect"},i.createElement(I.A,{dropdown:i.createElement(C,{instruments:n,onSelectInstrument:a,onUseNewInstrument:s,selectedInstrumentId:r,shouldHideExpiryDate:d})},i.createElement(b,{instrument:u,shouldHideExpiryDate:d,testId:"instrument-select"}),i.createElement("input",Object.assign({type:"hidden"},e))))};var w=n(3701);const k=(0,i.memo)((({instruments:e,onDeleteInstrument:t,onSelectInstrument:n,onUseNewInstrument:l,selectedInstrumentId:u,shouldHideExpiryDate:m=!1,validateInstrument:c=null})=>{const p=(0,i.useCallback)((t=>i.createElement(S,Object.assign({},t,{instruments:e,onSelectInstrument:n,onUseNewInstrument:l,selectedInstrumentId:u,shouldHideExpiryDate:m}))),[e,n,l,u,m]),y=(0,i.useCallback)((n=>i.createElement(w.A,Object.assign({instruments:e,onDeleteInstrument:t},n))),[e,t]);return i.createElement(s.A,{additionalClassName:"instrumentFieldset",legend:i.createElement(r.A,{hidden:!0},i.createElement(a.A,{id:"payment.instrument_text"}))},i.createElement(d.A,{modal:y},(({onClick:e})=>i.createElement("button",{className:"instrumentModal-trigger",onClick:e,type:"button"},i.createElement(a.A,{id:"payment.instrument_manage_button"})))),i.createElement(o.A,{name:"instrumentId",render:p}),i.createElement("div",{style:{display:u?void 0:"none"}},c))}))},63582:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(31635),a=n(70355);const s=(0,n(19285).A)((({checkoutService:{deinitializeCustomer:e,initializeCustomer:t},checkoutButtonContainerClass:n,containerId:s,methodId:r,onUnhandledError:d,onWalletButtonClick:o,additionalInitializationOptions:l})=>((0,a.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t({methodId:r,[r]:Object.assign({container:s,onUnhandledError:d,onClick:()=>o(r)},l)})}catch(e){"function"==typeof d&&e instanceof Error&&d(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield e({methodId:r})}catch(e){"function"==typeof d&&e instanceof Error&&d(e)}}))})),[]),a.createElement("div",{className:n,"data-test":s,id:s}))),[])},88727:(e,t,n)=>{n.r(t),n.d(t,{AmazonPayV2Button:()=>p,AmazonPayV2PaymentMethod:()=>u});var i=n(31635),a=n(69440),s=n(70355),r=n(89799),d=n(48407),o=n(31448),l=n(19285);const u=(0,l.A)((e=>{var{checkoutService:t,checkoutState:n,paymentForm:l,method:u,method:{initializationData:{paymentDescriptor:m,paymentToken:c}}}=e,p=(0,i.__rest)(e,["checkoutService","checkoutState","paymentForm","method","method"]);const y=(0,s.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{amazonpay:{editButtonId:"editButtonId"}}))),[t]),h=(0,s.useCallback)((()=>window.location.reload()),[]),{hidePaymentSubmitButton:I,disableSubmit:g,setFieldValue:E,setSubmit:v,setValidationSchema:f}=l,{data:{getCheckout:C,isPaymentDataRequired:b},statuses:{isLoadingInstruments:S}}=n,w=C(),k=n.data.getCustomer(),A=!(null==k?void 0:k.isGuest)&&Boolean(u.config.isVaultingEnabled),x=n.data.getInstruments(u)||[];return s.createElement(r.A,Object.assign({},p,{buttonId:"editButtonId",containerId:"paymentWidget",deinitializePayment:t.deinitializePayment,disableSubmit:g,hidePaymentSubmitButton:I,hideWidget:!0,initializePayment:y,instruments:x,isInstrumentCardCodeRequired:(0,d.A)(n),isInstrumentCardNumberRequired:(0,o.A)(n),isInstrumentFeatureAvailable:A,isLoadingInstruments:S(),isPaymentDataRequired:b(),isSignInRequired:!1,isSignedIn:(0,a.some)(null==w?void 0:w.payments,{providerId:u.id}),loadInstruments:t.loadInstruments,method:u,onSignOut:h,paymentDescriptor:m,setFieldValue:E,setSubmit:v,setValidationSchema:f,shouldShow:!!c,shouldShowDescriptor:!!c,shouldShowEditButton:!!c,signOut:t.signOutCustomer}))}),[{id:"amazonpay"}]);var m=n(63582);const c=()=>{var e;if(!document.querySelector(".checkout-button-container"))return;const t=document.querySelector("#amazonpayCheckoutButton > div");if(t){const n=null===(e=t.shadowRoot)||void 0===e?void 0:e.querySelector(".amazonpay-button-view1");if(n instanceof HTMLElement)return void(n.style.height="36px")}setTimeout(c,10)},p=(0,l.A)((e=>((0,s.useEffect)((()=>{c()}),[]),s.createElement("div",{className:"AmazonPayContainer"},s.createElement(m.A,Object.assign({},e))))),[{id:"amazonpay"}])},89799:(e,t,n)=>{n.d(t,{A:()=>v});var i=n(31635),a=n(69440),s=n(70355),r=n(52137),d=n(43125),o=n(11474),l=n(62677),u=n(40646),m=n(68801),c=n(3375),p=n.n(c),y=n(72769),h=n(49655);const I=({buttonId:e,shouldShowEditButton:t})=>{if(t){const t=s.createElement(h.A,{id:"remote.select_different_card_action"});return s.createElement("p",null,s.createElement("button",{className:p()("stepHeader","widget-link-amazonpay"),id:e,onClick:(0,y.A)(),type:"button"},t))}return null},g=({shouldShowDescriptor:e,paymentDescriptor:t})=>e&&t?s.createElement("div",{className:"payment-descriptor"},t):null,E=({additionalContainerClassName:e,containerId:t,hideContentWhenSignedOut:n,hideWidget:i,isSignInRequired:a,isSignedIn:r,method:d,renderCustomPaymentForm:o,shouldRenderCustomInstrument:l,shouldShowCreditCardFieldset:u})=>s.createElement("div",{className:p()("widget",`widget--${d.id}`,"payment-widget",l?"":e),id:t,style:{display:n&&a&&!r||!u||i?"none":void 0},tabIndex:-1},l&&o&&o()),v=({instruments:e,hideWidget:t=!1,isInitializing:n=!1,isAccountInstrument:c,isInstrumentFeatureAvailable:p,isLoadingInstruments:y,shouldHideInstrumentExpiryDate:h=!1,shouldShow:v=!0,hideVerificationFields:f,method:C,storedCardValidationSchema:b,isPaymentDataRequired:S,setValidationSchema:w,loadInstruments:k,onUnhandledError:A=a.noop,deinitializeCustomer:x,deinitializePayment:N,setSubmit:_,initializeCustomer:D,initializePayment:z,signInCustomer:T,isSignedIn:R,isSignInRequired:P,isInstrumentCardNumberRequired:V,validateInstrument:H,containerId:B,hideContentWhenSignedOut:F=!1,renderCustomPaymentForm:M,additionalContainerClassName:O,shouldRenderCustomInstrument:q=!1,paymentDescriptor:U,shouldShowDescriptor:W,shouldShowEditButton:j,buttonId:$,setFieldValue:L})=>{const[Y,J]=(0,s.useState)(!1),[G,K]=(0,s.useState)(void 0),Q=(0,s.useCallback)((()=>{if(Y)return;const t=e.find((e=>e.defaultInstrument))||e[0];return t?t.bigpayToken:void 0}),[Y,e]),X=(0,s.useCallback)((()=>{const t=G||Q();return(0,a.find)(e,{bigpayToken:t})}),[e,G,Q]),Z=(0,s.useCallback)((()=>{if(!S)return null;const e=X();return p&&e&&b||null}),[X,p,S,b]),ee=(0,s.useCallback)(((e,t)=>!e&&(0,r.T)(t)?t:void 0),[]),te=(0,s.useCallback)((t=>{if(0===e.length)return J(!0),K(void 0),void L("instrumentId","");if(G===t){const e=Q();K(e),L("instrumentId",e)}}),[e,G,Q]),ne=(0,s.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){J(!0),K(void 0),N&&(yield N({gatewayId:C.gateway,methodId:C.id})),z&&(yield z({gatewayId:C.gateway,methodId:C.id}))}))),[C,N,z]),ie=(0,s.useCallback)((e=>{J(!1),K(e)}),[]),ae=(0,s.useCallback)((()=>{const t=G||Q(),n=(0,a.find)(e,{bigpayToken:t});if(n){(0,d.A)(n);const e=V(n,C);if(f)return;if(H)return H(e,n)}}),[G,Q,e,C,f,H]),se=()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){if(!S)return void _(C,null);if(P&&!R)return _(C,T||null),D?D({methodId:C.id}):void 0;let t;if(_(C,null),!Y){const n=G||Q(),i=e.find((e=>e.bigpayToken===n))||e[0];i&&(0,d.a)(i)&&(t=i)}return z?z({gatewayId:C.gateway,methodId:C.id},t):void 0})),re=G||Q(),de=re&&e.find((e=>e.bigpayToken===re))||e[0],oe=e.filter((e=>!(0,r.T)(e))),le=e.filter((e=>(0,r.T)(e))),ue=p&&e.length>0,me=!ue||Y,ce=(n||y)&&!t,pe=de?ee(Y,de):void 0,ye=e[0]&&(0,r.T)(e[0]);(0,s.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){w(C,Z());try{p&&(yield null==k?void 0:k()),yield se()}catch(e){e instanceof Error&&A(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){w(C,null),_(C,null);try{N&&(yield N({gatewayId:C.gateway,methodId:C.id})),x&&(yield x({methodId:C.id}))}catch(e){e instanceof Error&&A(e)}}))})),[]);const he=(0,s.useRef)(!0),Ie=(0,s.useRef)(e.length),ge=(0,s.useRef)(S),Ee=(0,s.useRef)(G);return(0,s.useEffect)((()=>{if(he.current)return void(he.current=!1);w(C,Z());(Ee.current!==G||Number(Ie.current)>0&&0===e.length||ge.current!==S)&&(Ee.current=G,Ie.current=e.length,ge.current=S,(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{N&&(yield N({gatewayId:C.gateway,methodId:C.id})),yield se()}catch(e){e instanceof Error&&A(e)}})))}),[G,e,S]),v?s.createElement(m.A,{hideContentWhenLoading:!0,isLoading:ce},s.createElement("div",{className:"paymentMethod--hosted"},ye&&ue&&s.createElement(o.A,{instruments:le,onSelectInstrument:ie,onUseNewInstrument:ne,selectedInstrument:pe}),!ye&&ue&&s.createElement(l.A,{instruments:oe,onDeleteInstrument:te,onSelectInstrument:ie,onUseNewInstrument:ne,selectedInstrumentId:re,shouldHideExpiryDate:h,validateInstrument:ae()}),s.createElement(g,{paymentDescriptor:U,shouldShowDescriptor:W}),s.createElement(E,{additionalContainerClassName:O,containerId:B,hideContentWhenSignedOut:F,hideWidget:t,isSignInRequired:P,isSignedIn:R,method:C,renderCustomPaymentForm:M,shouldRenderCustomInstrument:q,shouldShowCreditCardFieldset:me}),p&&s.createElement(u.A,{instrumentId:re,instruments:e,isAccountInstrument:Boolean(c||ye)}),s.createElement(I,{buttonId:$,shouldShowEditButton:j}))):s.createElement("div",{style:{display:"none"}})}}}]);
//# sourceMappingURL=amazon-pay-v2-payment-method-d9dc11de.js.map