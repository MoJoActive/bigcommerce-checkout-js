"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[553],{13400:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(69440),s=i(70355),a=i(49655),o=i(63163),d=i(24391),l=i(76966);const r=({headerId:e,messageId:t,isModalOpen:i,action:r,actionButtonLabel:p,onRequestClose:c=n.noop,shouldShowCloseButton:m=!0})=>s.createElement(d.A,{additionalModalClassName:"modal--confirm",footer:s.createElement(o.Ay,{onClick:r,size:o.Mp.Small,variant:o.Ak.Primary},null!=p?p:s.createElement(a.A,{id:"common.confirm_action"})),header:s.createElement(l.A,null,s.createElement("span",{"aria-live":"assertive",role:"alert"},s.createElement(a.A,{id:e}))),isOpen:i,onRequestClose:c,shouldShowCloseButton:m},s.createElement("p",{"aria-live":"assertive",role:"alert"},s.createElement(a.A,{id:t})))},83651:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(70355);const s=(0,i(45080).A)((()=>n.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}))))},86015:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ii,mapToShippingProps:()=>ti});var n=i(31635),s=i(69440),a=i(70355),o=i(12077),d=i(89443),l=i(77050),r=i(49655),p=i(17986),c=i(13400),m=i(39886),g=i(95108),h=i(45293),u=i(87980),S=i(79001),A=i(84559),E=i(12402),C=i(98610),v=i(74027),b=i(21106);function y(e,t){var i;const n=[C.A.AmazonPay,C.A.BraintreeAcceleratedCheckout,C.A.PayPalCommerceAcceleratedCheckout],s=(0,E.A)(null===(i=t.checkoutSettings)||void 0===i?void 0:i.providerWithCustomCheckout),a=(0,b.A)(e);return a&&n.includes(a.providerId)?a.providerId:s&&n.includes(s)?s:void 0}function f(e){var t;const{digitalItems:i=[],physicalItems:n}=e.lineItems;return(null===(t=[...i,...n].filter((e=>e.addedByPromotion)))||void 0===t?void 0:t.length)>0}var _=i(68512),I=i(39981),M=i(96097),O=i(3375),N=i.n(O),k=i(69022),L=i(60288),F=i(69462);function w(e){return t=>{const i=e=>{const{resetForm:i,isInitialValueLoaded:n,initialValues:s}=e,o=(0,a.useRef)(n);return(0,a.useEffect)((()=>{!1===o.current&&!0===n&&i({values:null!=s?s:{}}),o.current=n}),[n,s,i]),a.createElement(t,Object.assign({},e))};return i.displayName=`WithFormikExtended(${t.displayName||t.name})`,(0,F.bk)(e)(i)}}var U=i(46487),P=i(72769),R=i(53133),z=i(45080),T=i(33318),B=i(94202),D=i(68801),V=i(4899),K=i(92909),W=i(58330),H=i(12319),j=i(33515),q=i(22011);const x=(0,_.A)((0,F.bk)({handleSubmit:(e,{props:{onSaveAddress:t}})=>{t(e)},mapPropsToValues:({getFields:e,selectedAddress:t})=>(0,q.A)(e(t&&t.countryCode),t),validationSchema:({language:e,getFields:t})=>(0,B.RZ)((i=>(0,j.A)({language:e,formFields:t(i&&i.countryCode)})))})((({googleMapsApiKey:e,getFields:t,countriesWithAutocomplete:i,countries:n,values:s,setFieldValue:o,isLoading:d,onRequestClose:l,isFloatingLabelEnabled:p})=>a.createElement(V.A,{autoComplete:"on"},a.createElement(D.A,{isLoading:d},a.createElement(H.A,{countries:n,countriesWithAutocomplete:i,countryCode:s.countryCode,formFields:t(s.countryCode),googleMapsApiKey:e,isFloatingLabelEnabled:p,setFieldValue:o,shouldShowSaveAddress:!1}),a.createElement("div",{className:"form-actions"},a.createElement(U.Ay,{onClick:l,variant:U.Ak.Secondary},a.createElement(r.A,{id:"common.cancel_action"})),a.createElement(U.Ay,{disabled:d,id:"checkout-save-address",type:"submit",variant:U.Ak.Primary},a.createElement(r.A,{id:"address.save_address_action"})))))))),G=e=>{var{isOpen:t,onAfterOpen:i,onRequestClose:s}=e,o=(0,n.__rest)(e,["isOpen","onAfterOpen","onRequestClose"]);return a.createElement(K.A,{additionalModalClassName:"modal--medium",header:a.createElement(W.A,null,a.createElement(r.A,{id:"address.add_address_heading"})),isOpen:t,onAfterOpen:i,onRequestClose:s,shouldShowCloseButton:!0},a.createElement(x,Object.assign({},o,{onRequestClose:s})))};var $=i(49102),J=i(62562),Q=i(31689),Y=i(84087),Z=i(4853),X=i(85021);class ee extends Z.A{constructor(e){super({name:"ASSIGN_ITEM_INVALID_ADDRESS",message:(0,Y.A)().translate("shipping.assign_item_invalid_address_error"),title:(0,Y.A)().translate("shipping.assign_item_invalid_address_error_heading"),data:e}),(0,X.h)(this,ee.prototype)}}class te extends Z.A{constructor(e){super({name:"ASSIGN_ITEM_FAILED",message:(0,Y.A)().translate("shipping.assign_item_error"),data:e}),(0,X.h)(this,te.prototype)}}const ie=(0,i(2156).A)((()=>a.createElement("svg",{fill:"none",height:"20",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg"},a.createElement("path",{d:"M2.49902 14.5511V17.0844C2.49902 17.3178 2.68236 17.5011 2.91569 17.5011H5.44902C5.55736 17.5011 5.66569 17.4594 5.74069 17.3761L14.8407 8.28444L11.7157 5.15944L2.62402 14.2511C2.54069 14.3344 2.49902 14.4344 2.49902 14.5511ZM17.2574 5.86777C17.5824 5.54277 17.5824 5.01777 17.2574 4.69277L15.3074 2.74277C14.9824 2.41777 14.4574 2.41777 14.1324 2.74277L12.6074 4.26777L15.7324 7.39277L17.2574 5.86777Z"}))));var ne=i(63650);const se=({onUseNewAddress:e,selectedAddress:t})=>{const{themeV2:i}=(0,k.w)();return a.createElement("div",{className:"guest-consignment-line-item-header"},t?a.createElement(a.Fragment,null,a.createElement(ne.A,{address:t}),a.createElement("a",{className:i?"body-cta":"","data-test":"edit-shipping-address",href:"#",onClick:(0,P.A)(e)},a.createElement(ie,null))):a.createElement(a.Fragment,null,a.createElement("h3",{className:i?"body-bold":""},a.createElement(r.A,{id:"shipping.guest_multishipping_no_shipping_address_message"})),a.createElement("a",{className:i?"body-cta":"","data-test":"enter-shipping-address",href:"#",onClick:(0,P.A)(e)},a.createElement(r.A,{id:"shipping.guest_multishipping_enter_shipping_address_action"}))))},ae=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;const s=new Map(e.map((e=>{var t;return[e.id,null===(t=e.selectedShippingOption)||void 0===t?void 0:t.id]})));for(const e of t)if(!e.selectedShippingOption){const t=s.get(e.id);if(t){yield i(e.id,t);continue}const a=null===(n=e.availableShippingOptions)||void 0===n?void 0:n.find((e=>e.isRecommended));a&&(yield i(e.id,a.id))}})),oe=({consignment:e,countriesWithAutocomplete:t,defaultCountryCode:i,isLoading:s,onUnhandledError:o,selectedAddress:d,setConsignmentRequest:l})=>{const[p,c]=(0,a.useState)(!1),[g,h]=(0,a.useState)(),{checkoutState:{data:{getShippingCountries:u,getCustomer:E,getConfig:C,getConsignments:v,getShippingAddressFields:b}},checkoutService:{updateConsignment:y,createCustomerAddress:f,selectConsignmentShippingOption:_}}=(0,I.Q)(),M=u()||S.M,O=E(),N=C();if(!N||!O)return null;const k=(0,A.A)(N.checkoutSettings),L=O.addresses||S.M,{checkoutSettings:{googleMapsApiKey:F}}=N,w=O.isGuest,U=t=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var i;if(!(0,T.A)(t,b(t.countryCode)))return o(new ee);if(e)try{const{data:{getConsignments:n}}=yield y({id:e.id,address:t,shippingAddress:t,lineItems:e.lineItems.map((({id:e,quantity:t})=>({itemId:e,quantity:t})))}),s=n();s&&s.length>0&&(yield ae(null!==(i=v())&&void 0!==i?i:[],s,_))}catch(e){e instanceof Error&&o(new te(e))}else null==l||l({address:t,shippingAddress:t,lineItems:[]})})),P=()=>{c(!0)};return a.createElement(a.Fragment,null,a.createElement(Q.A,{error:g,message:a.createElement(a.Fragment,null,a.createElement(r.A,{id:"address.consignment_address_updated_text"})," ",a.createElement(r.A,{id:"customer.create_address_error"})),onClose:()=>{h(void 0)},shouldShowErrorCode:!1}),a.createElement(G,{countries:M,countriesWithAutocomplete:t,defaultCountryCode:i,getFields:b,googleMapsApiKey:F,isFloatingLabelEnabled:k,isLoading:s,isOpen:p,onRequestClose:()=>{c(!1)},onSaveAddress:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const t=(0,m.A)(e);if(yield U(t),!w)try{yield f(t)}catch(e){e instanceof Error&&h(e)}c(!1)})),selectedAddress:w?d:void 0}),w?a.createElement(se,{onUseNewAddress:P,selectedAddress:d}):a.createElement($.A,{addresses:L,onSelectAddress:U,onUseNewAddress:P,placeholderText:a.createElement(r.A,{id:"shipping.choose_shipping_address"}),selectedAddress:d,showSingleLineAddress:!0,type:J.A.Shipping}))};var de=i(83651),le=i(38116),re=i(11100),pe=i(63163),ce=i(81339),me=i(97429),ge=i(2224),he=i(52523);const ue=()=>a.createElement(me.A,{placement:"right-start",tooltip:a.createElement(he.A,null,a.createElement(r.A,{id:"shipping.multishipping_item_split_tooltip_message"}))},a.createElement("span",{className:"item-split-tooltip","data-test":"split-item-tooltip"},a.createElement(ge.A,null))),Se=({assignedItems:e,onUnassignItem:t})=>{const{themeV2:i}=(0,k.w)();return a.createElement("div",{className:"allocated-line-items"},a.createElement("h3",{className:i?"body-bold":""},a.createElement(r.A,{data:{count:e.shippableItemsCount},id:"shipping.multishipping_item_allocated_message"}),e.hasSplitItems&&a.createElement(ue,null)),a.createElement("ul",{className:"allocated-line-items-list"},e.lineItems.map((e=>a.createElement("li",{key:e.id},(0,ce.h)(e,i),a.createElement("span",{"data-test":`remove-${e.id.toString()}-button`,onClick:()=>t(e)},a.createElement(R.A,null)))))))};var Ae=i(22375),Ee=i(54454);const Ce=({item:e,error:t})=>{var i;const n=(0,re.A)(),{themeV2:s}=(0,k.w)();return a.createElement("tr",null,a.createElement("td",{className:"left-to-allocate-item-name-container"},a.createElement("figure",{className:"left-to-allocate-item-figure"},e.imageUrl&&a.createElement("img",{alt:e.name,src:e.imageUrl})),a.createElement("div",null,a.createElement("p",{className:N()("left-to-allocate-item-name",{"body-regular":s})},e.name),null===(i=e.options)||void 0===i?void 0:i.map((e=>a.createElement("p",{className:N()("left-to-allocate-item-option",{"sub-text-medium":s}),key:e.nameId},e.name,": ",e.value))))),!n&&a.createElement("td",{className:s?"body-regular":""},e.quantity),a.createElement("td",{className:s?"body-regular":""},n&&a.createElement(r.A,{data:{count:e.quantity},id:"shipping.multishipping_left_to_allocate_message"}),a.createElement(Ae.A,{additionalClassName:t?"form-field--error":"",input:({field:t})=>a.createElement(Ee.A,Object.assign({},t,{"aria-label":`Quantity of ${e.name}`,disabled:0===e.quantity,id:t.name,min:0,themeV2:s,type:"number"})),name:e.id.toString()})))},ve=({items:e,formErrors:t})=>{const i=(0,re.A)(),{themeV2:n}=(0,k.w)();return a.createElement("table",{className:"table left-to-allocate-items-table"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",{className:n?"body-medium":""},a.createElement(r.A,{id:"shipping.multishipping_left_to_allocate_items_table_item"})),!i&&a.createElement("th",{className:n?"body-medium":""},a.createElement(r.A,{id:"shipping.multishipping_left_to_allocate_items_table_left_to_allocate"})),a.createElement("th",{className:n?"body-medium":""},a.createElement(r.A,{id:"shipping.multishipping_left_to_allocate_items_table_quantity"})))),a.createElement("tbody",null,e.map((e=>a.createElement(Ce,{error:t[e.id.toString()],item:e,key:e.id})))))};var be;!function(e){e[e.Physical=0]="Physical",e[e.Digital=1]="Digital",e[e.GiftCertificate=2]="GiftCertificate",e[e.Custom=3]="Custom"}(be||(be={}));const ye=(0,_.A)(w({handleSubmit:(e,{props:{onAllocateItems:t}})=>{t(Object.keys(e).filter((t=>e[t]>0)).map((t=>({itemId:t,quantity:e[t]}))))},mapPropsToValues:({unassignedItems:e})=>{const t={};return e.lineItems.forEach((e=>{t[e.id.toString()]=0})),t},enableReinitialize:!0,validationSchema:({language:e,unassignedItems:t})=>{const i=t=>{const i=(0,B.ai)().required(e.translate("shipping.quantity_required_error")).integer(e.translate("shipping.quantity_invalid_error")).min(0,e.translate("shipping.quantity_min_error")).max(t.quantity,e.translate("shipping.quantity_max_error"));return t.type===be.Custom?i.oneOf([0,t.quantity],e.translate("shipping.custom_item_quantity_error")):i},n=Object.fromEntries(t.lineItems.map((e=>[e.id.toString(),i(e)])));return(0,B.Ik)().shape(n)},validateOnBlur:!0,validateOnChange:!1})((({consignmentNumber:e,isOpen:t,onRequestClose:i,address:n,assignedItems:s,unassignedItems:o,setValues:d,values:l,dirty:p,submitForm:c,errors:m,onUnassignItem:g,isLoading:h})=>{const{themeV2:u}=(0,k.w)(),S=(0,a.useMemo)((()=>{const e=o.shippableItemsCount;if(l&&p){const t=Object.keys(l).reduce(((e,t)=>(l[t]>0&&(e+=l[t]),e)),0);return a.createElement(r.A,{data:{count:`${t}/${e}`},id:"shipping.multishipping_items_selected_message"})}return a.createElement(r.A,{data:{count:e},id:"shipping.multishipping_item_to_allocate_message"})}),[l]),A=(0,a.useMemo)((()=>Object.keys(m).reduce(((e,t)=>{const i=m[t];return i&&e.push(i),Array.from(new Set(e))}),[])),[m]),E=!!s&&s.lineItems.length>0&&!!g,C=!!o&&o.lineItems.length>0,v=a.createElement(a.Fragment,null,a.createElement(U.Ay,{className:u?"body-medium":"",disabled:h,onClick:i,variant:pe.Ak.Secondary},a.createElement(r.A,{id:"shipping.multishipping_items_allocate_cancel"})),a.createElement(U.Ay,{className:u?"body-medium":"",disabled:!E&&!p,isLoading:h,onClick:c,type:"submit",variant:pe.Ak.Primary},E?a.createElement(r.A,{id:"shipping.multishipping_items_allocate_save"}):a.createElement(r.A,{id:"shipping.multishipping_items_allocate_allocate"})));return a.createElement(K.A,{additionalModalClassName:"allocate-items-modal",footer:v,header:a.createElement(a.Fragment,null,a.createElement(W.A,{additionalClassName:u?"header":""},a.createElement(r.A,{data:{consignmentNumber:e},id:"shipping.multishipping_consignment_index_heading"})),a.createElement("h4",{className:u?"body-medium":""},(0,ne.k)(n))),isOpen:t,onRequestClose:i},a.createElement(V.A,null,A.length>0&&a.createElement("div",{className:"form-errors"},A.map(((e,t)=>a.createElement(L.A,{key:t,type:L.v.Error},e)))),o.hasDigitalItems&&a.createElement(L.A,{type:L.v.Info},a.createElement(r.A,{id:"shipping.multishipping_digital_item_no_shipping_banner"})),E&&a.createElement(Se,{assignedItems:s,onUnassignItem:g}),C?a.createElement(a.Fragment,null,a.createElement("div",{className:"left-to-allocate-items-table-actions"},a.createElement("p",{className:u?"body-regular":""},S,o.hasSplitItems&&a.createElement(ue,null)),a.createElement("div",{className:"button-group"},a.createElement("a",{className:u?"body-cta":"","data-test":"clear-all-items-button",href:"#",onClick:(0,P.A)((()=>{const e={};o.lineItems.forEach((t=>{e[t.id.toString()]=0})),d(e)}))},a.createElement(r.A,{id:"shipping.multishipping_items_allocate_clear_all"})),a.createElement("a",{className:u?"body-cta":"","data-test":"allocate-all-items-button",href:"#",onClick:(0,P.A)((()=>{const e={};o.lineItems.forEach((t=>{e[t.id.toString()]=t.quantity})),d(e)}))},a.createElement(r.A,{id:"shipping.multishipping_items_allocate_select_all_items_left"})))),a.createElement(ve,{formErrors:m,items:o.lineItems})):null))})));class fe extends Z.A{constructor(e){super({name:"UNASSIGN_ITEM_FAILED",message:(0,Y.A)().translate("shipping.unassign_item_error"),data:e}),(0,X.h)(this,fe.prototype)}}const _e=e=>btoa(encodeURIComponent(e.join("-")));const Ie=e=>e.reduce(((e,t)=>e+t.quantity),0),Me=(e,t)=>{const i=new Set;for(const n of e){const e=t.get(n.id.toString());if(e){if(i.has(e))return!0;i.add(e)}}return!1};function Oe(e,t){var i;const n=new Map,s=new Map,a=new Map,o=[];e.physicalItems.forEach((e=>{n.set(e.id.toString(),Object.assign(Object.assign({},e),{type:be.Physical})),a.set(e.id.toString(),(e=>{return _e([e.productId.toString(),e.variantId.toString(),e.sku,(t=e.options,t?_e(t.map((e=>_e([e.name,e.nameId.toString(),e.value,e.valueId?e.valueId.toString():""])))):"")]);var t})(e))})),null===(i=e.customItems)||void 0===i||i.forEach((e=>n.set(e.id,Object.assign(Object.assign({},e),{type:be.Custom})))),e.digitalItems.forEach((e=>s.set(e.id.toString(),Object.assign(Object.assign({},e),{type:be.Digital})))),t.forEach(((e,t)=>{const i=[];e.lineItemIds.forEach((e=>{const t=n.get(e);t&&(i.push(t),n.delete(e))})),o.push(Object.assign(Object.assign({},e),{consignmentNumber:t+1,hasDigitalItems:!1,hasSplitItems:Me(i,a),shippableItemsCount:Ie(i),lineItems:i}))}));const d=Array.from(n.values()),l={lineItems:d,hasDigitalItems:s.size>0,hasSplitItems:Me(d,a),shippableItemsCount:Ie(d)};return{consignmentList:o,unassignedItems:l}}const Ne={unassignedItems:{lineItems:[],hasDigitalItems:!1,hasSplitItems:!1,shippableItemsCount:0},consignmentList:[]},ke=()=>{const{checkoutState:{data:{getCheckout:e}}}=(0,I.Q)(),t=e();if(!t)return Ne;const{cart:{lineItems:i},consignments:n}=t,s=function(e){return Object.assign(Object.assign({},e),{physicalItems:e.physicalItems.filter((e=>"string"!=typeof e.parentId)),digitalItems:e.digitalItems.filter((e=>"string"!=typeof e.parentId))})}(i),{consignmentList:a,unassignedItems:o}=Oe(s,n);return{unassignedItems:o,consignmentList:a}},Le=({consignmentNumber:e,consignment:t,onUnhandledError:i,isLoading:s})=>{const[o,d]=(0,a.useState)(!1),[l,p]=(0,a.useState)(!0),{unassignedItems:c}=ke(),{checkoutService:{assignItemsToAddress:m}}=(0,I.Q)(),g=(()=>{const{checkoutService:{createConsignments:e,deleteConsignment:t}}=(0,I.Q)();return(i,s,a)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;let o=a.id;if(a.lineItemIds.length>1){const t=(yield e([i])).data.getConsignments();o=null===(n=null==t?void 0:t.find((e=>e.lineItemIds.find((e=>e===s)))))||void 0===n?void 0:n.id}if(!o)throw new Error("Unable to find consignment to delete");t(o)}))})(),{themeV2:h}=(0,k.w)(),u=()=>{d(!o)},S=(0,re.A)(),A=t.shippableItemsCount;return a.createElement("div",null,a.createElement(ye,{address:t.shippingAddress,assignedItems:t,consignmentNumber:e,isLoading:s,isOpen:o,onAllocateItems:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield m({address:t.address,lineItems:e})}catch(e){e instanceof Error&&i(new te(e))}finally{u()}})),onRequestClose:u,onUnassignItem:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{const i={address:t.address,shippingAddress:t.shippingAddress,lineItems:[{quantity:e.quantity,itemId:e.id}]};yield g(i,e.id.toString(),t)}catch(e){e instanceof Error&&i(new fe(e))}})),unassignedItems:c}),a.createElement("div",{className:"consignment-line-item-header"},a.createElement("div",null,a.createElement("h3",{className:h?"body-bold":""},a.createElement(r.A,{data:{count:A},id:"shipping.multishipping_item_allocated_message"})),t.hasSplitItems&&a.createElement(ue,null),a.createElement("a",{className:N()("expand-items-button",{"body-cta":h}),"data-test":"expand-items-button",href:"#",onClick:(0,P.A)((()=>{p(!l)}))},l?a.createElement(a.Fragment,null,!S&&a.createElement(r.A,{id:"shipping.multishipping_item_hide_items_message"}),a.createElement(de.A,null)):a.createElement(a.Fragment,null,!S&&a.createElement(r.A,{id:"shipping.multishipping_item_show_items_message"}),a.createElement(le.A,null)))),a.createElement("a",{className:h?"body-cta":"","data-test":"reallocate-items-button",href:"#",onClick:(0,P.A)(u)},a.createElement(r.A,{id:"shipping.multishipping_item_reallocated_message"}))),l?a.createElement(ce.A,{lineItems:t.lineItems}):null)};var Fe=i(25656),we=i(16919);const Ue=({consignmentId:e,selectedShippingOptionId:t,shippingOption:i,handleSelect:n})=>{const{themeV2:s}=(0,k.w)(),o=a.createElement("span",{className:s?"body-regular":""},`${i.description} - `,a.createElement(we.A,{amount:i.cost}));return a.createElement("ul",{className:"shipping-option-item"},a.createElement(Fe.A,{checked:t===i.id,id:`shippingOption-${e}-${i.id}`,key:`key-${e}-${i.id}`,label:o,name:`${e}-shippingMethod`,onClick:()=>{n(e,i.id)},readOnly:!0,value:i.id}))},Pe=(0,a.memo)((({consignmentId:e,isLoading:t,shippingOptions:i,selectedShippingOptionId:n,onSelectedOption:s})=>a.createElement(D.A,{isLoading:t},i.map((t=>a.createElement(Ue,{consignmentId:e,handleSelect:s,key:t.id,selectedShippingOptionId:n,shippingOption:t}))))));function Re(e,t){return(0,s.reduce)(e&&e.lineItems.physicalItems||[],((e,i,n)=>!i.addedByPromotion&&(0,s.isNil)(i.parentId)?e.concat(...function(e,t,i){let n=[];const a=function(e,t){return(0,s.find)(e,(e=>(0,s.includes)(e.lineItemIds,t)))}(t,e.id);for(let t=0;t<e.quantity;t++)n=n.concat(Object.assign(Object.assign({},e),{key:`${e.variantId}-${e.productId}-${i}-${t}`,consignment:a,quantity:1}));return n}(i,t,n)):e),[])}var ze=i(17080),Te=i(75794),Be=i(2398);function De(e){if(e)return e.find((({isRecommended:e})=>e))}var Ve=i(53056),Ke=i(91182),We=i(10169),He=i(82259),je=i(13061);const qe=({consignmentId:e,isMultiShippingMode:t,selectedShippingOptionId:i,shippingOption:n})=>{const s=i===n.id,o=(0,a.useCallback)((()=>a.createElement("div",{className:"shippingOptionLabel"},a.createElement(je.A,{displayAdditionalInformation:!0,method:n}),s&&!t&&a.createElement(Ke.Y,{region:"shipping.selectedShippingMethod"}))),[s,t,n]);return a.createElement(We.A,{htmlId:`shippingOptionRadio-${e}-${n.id}`,label:o,value:n.id})},xe=(0,a.memo)((({consignmentId:e,inputName:t,isLoading:i,isMultiShippingMode:n,shippingOptions:s=S.M,selectedShippingOptionId:o,onSelectedOption:d})=>{const l=(0,a.useCallback)((t=>{d(e,t)}),[e,d]);return s.length?a.createElement(D.A,{isLoading:i},a.createElement(He.A,{"aria-live":"polite",defaultSelectedItemId:o,name:t,onSelect:l},s.map((t=>a.createElement(qe,{consignmentId:e,isMultiShippingMode:n,key:t.id,selectedShippingOptionId:o,shippingOption:t}))))):null})),Ge=({consignments:e})=>{const t={};return(e||[]).forEach((e=>{t[e.id]=e.selectedShippingOption?e.selectedShippingOption.id:""})),{shippingOptionIds:t}};class $e extends a.PureComponent{constructor(){super(...arguments),this.selectDefaultShippingOptions=e=>(0,n.__awaiter)(this,[e],void 0,(function*({data:e}){const{selectShippingOption:t,setFieldValue:i}=this.props,n=(e.getConsignments()||[]).find((({selectedShippingOption:e,availableShippingOptions:t})=>!e&&t));if(!n||!n.availableShippingOptions)return;const{availableShippingOptions:s,id:a}=n,o=De(s),d=1===s.length&&s[0],l=o||d;l&&(yield t(a,l.id),i(`shippingOptionIds.${a}`,l.id))}))}componentDidMount(){const{subscribeToConsignments:e}=this.props;this.unsubscribe=e(this.selectDefaultShippingOptions)}componentDidUpdate({shippingFormRenderTimestamp:e}){const{analyticsTracker:t,consignments:i,shouldShowShippingOptions:n,shippingFormRenderTimestamp:s,setValues:a}=this.props;(null==i?void 0:i.length)&&n&&t.showShippingMethods(),s!==e&&a(Ge(this.props))}componentWillUnmount(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}render(){const{consignments:e,isMultiShippingMode:t,selectShippingOption:i,isLoading:n,shouldShowShippingOptions:s,invalidShippingMessage:o,methodId:d}=this.props;return(null==e?void 0:e.length)&&s?a.createElement(a.Fragment,null,e.map((e=>{return a.createElement("div",{className:"shippingOptions-container form-fieldset",key:e.id},t&&this.renderConsignment(e),a.createElement(xe,{consignmentId:e.id,inputName:(s=e.id,`shippingOptionIds.${s}`),isLoading:n(e.id),isMultiShippingMode:t,onSelectedOption:i,selectedShippingOptionId:e.selectedShippingOption&&e.selectedShippingOption.id,shippingOptions:e.availableShippingOptions}),(!e.availableShippingOptions||!e.availableShippingOptions.length)&&a.createElement(ze.A,{additionalClassName:"shippingOptions-skeleton",isLoading:n(e.id),rows:2},this.renderNoShippingOptions(o)));var s}))):a.createElement(ze.A,{additionalClassName:"shippingOptions-skeleton",isLoading:n(),rows:2},this.renderNoShippingOptions(a.createElement(r.A,{id:d||t?"shipping.select_shipping_address_text":"shipping.enter_shipping_address_text"})))}renderNoShippingOptions(e){return a.createElement("div",{className:"shippingOptions-panel optimizedCheckout-overlay"},a.createElement("p",{"aria-live":"polite",className:"shippingOptions-panel-message optimizedCheckout-primaryContent",role:"alert"},e))}renderConsignment(e){const{cart:t}=this.props;return a.createElement("div",{className:"staticConsignment"},a.createElement("strong",null,a.createElement(r.A,{id:"shipping.shipping_address_heading"})),a.createElement(Te.A,{address:e.shippingAddress,type:J.A.Shipping}),a.createElement(Ve.A,{cart:t,consignment:e}))}}const Je=(0,Be.A)(w({handleSubmit:s.noop,mapPropsToValues:Ge})($e)),Qe=(0,o.createSelector)((({checkoutService:e})=>e.subscribe),(e=>t=>e(t,(({data:e})=>e.getConsignments())))),Ye=(0,o.createSelector)(((e,t)=>t),(({statuses:e})=>e.isLoadingShippingOptions),(({statuses:e})=>e.isSelectingShippingOption),(({statuses:e})=>e.isUpdatingConsignment),(({statuses:e})=>e.isCreatingConsignments),((e,t,i,n,s)=>a=>e||t()||i(a)||n(a)||s()));const Ze=(0,h.A)((function({checkoutService:e,checkoutState:t},i){const{data:{getCart:n,getConsignments:a,getConfig:o,getCustomer:d,getCheckout:l},statuses:{isSelectingShippingOption:r}}=t,p=d(),c=n(),m=o(),g=l();if(!(m&&g&&p&&c))return null;const h=((e,t)=>{if(t.length<2)return t;const i=Re(e,t),n=(0,s.uniq)((0,s.map)(i,"consignment.id"));return(0,s.sortBy)(t,(e=>n.indexOf(e.id)))})(c,a()||[]),u=y(g,m),{shippingQuoteFailedMessage:S}=m.checkoutSettings;return{cart:c,consignments:h,invalidShippingMessage:S,isLoading:Ye(t,i.isUpdatingAddress),isSelectingShippingOption:r,methodId:u,selectShippingOption:e.selectConsignmentShippingOption,subscribeToConsignments:Qe({checkoutService:e,checkoutState:t})}}))(Je),Xe=({consignment:e,isLoading:t,resetErrorConsignmentNumber:i,shippingQuoteFailedMessage:s})=>{const{checkoutService:o,checkoutState:d}=(0,I.Q)(),{themeV2:l}=(0,k.w)(),p=Ye(d,t)(e.id);return a.createElement("div",null,a.createElement("h3",{className:N()("shipping-option-header",{"body-bold":l})},a.createElement(r.A,{id:"shipping.shipping_method_label"})),(!e.availableShippingOptions||!e.availableShippingOptions.length)&&a.createElement(L.A,{type:L.v.Error},s),Boolean(e.availableShippingOptions)&&e.availableShippingOptions&&a.createElement(Pe,{consignmentId:e.id,isLoading:p,onSelectedOption:(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield o.selectConsignmentShippingOption(e,t),i()})),selectedShippingOptionId:e.selectedShippingOption&&e.selectedShippingOption.id,shippingOptions:e.availableShippingOptions}))},et=({consignment:e,consignmentNumber:t,countriesWithAutocomplete:i,defaultCountryCode:s,isLoading:o,shippingQuoteFailedMessage:d,onUnhandledError:l,resetErrorConsignmentNumber:p})=>{const{checkoutService:{deleteConsignment:c}}=(0,I.Q)(),{themeV2:m}=(0,k.w)();return a.createElement("div",{className:"consignment-container"},a.createElement("div",{className:N()("consignment-header",{"sub-header":m})},a.createElement("h3",null,a.createElement(r.A,{data:{consignmentNumber:t},id:"shipping.multishipping_consignment_index_heading"})),a.createElement("a",{className:"delete-consignment","data-test":"delete-consignment-button",href:"#",onClick:(0,P.A)((()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield c(e.id),p()}))))},a.createElement(R.A,{size:z.l.Small}))),a.createElement(oe,{consignment:e,countriesWithAutocomplete:i,defaultCountryCode:s,isLoading:o,onUnhandledError:l,selectedAddress:e.shippingAddress}),a.createElement(Le,{consignment:e,consignmentNumber:t,isLoading:o,onUnhandledError:l}),a.createElement(Xe,{consignment:e,isLoading:o,resetErrorConsignmentNumber:p,shippingQuoteFailedMessage:d}))};var tt=i(4209);function it(e){return!!e.length&&(0,s.every)(e,(e=>{var t;return"custom"===(null===(t=e.selectedShippingOption)||void 0===t?void 0:t.type)||e.availableShippingOptions&&e.availableShippingOptions.find((({id:t})=>{var i;return t===(null===(i=e.selectedShippingOption)||void 0===i?void 0:i.id)}))}))}var nt=i(69070),st=i(11889);const at=({shouldShowOrderComments:e,shouldDisableSubmit:t,isLoading:i,cartHasChanged:n})=>{const{themeV2:s}=(0,k.w)();return a.createElement(V.A,null,n&&a.createElement(st.A,{type:st.v.Error},a.createElement("strong",null,a.createElement(r.A,{id:"shipping.cart_change_error"}))),e&&a.createElement(nt.A,null),a.createElement("div",{className:"form-actions"},a.createElement(U.Ay,{className:s?"body-bold":"",disabled:t,id:"checkout-shipping-continue",isLoading:i,type:"submit",variant:U.Ak.Primary},a.createElement(r.A,{id:"common.continue_action"}))))},ot=({consignmentNumber:e,countriesWithAutocomplete:t,defaultCountryCode:i,isLoading:o,onUnhandledError:d,resetErrorConsignmentNumber:l,setIsAddShippingDestination:p})=>{const[c,m]=(0,a.useState)(),[g,h]=(0,a.useState)(!1),{unassignedItems:u}=ke(),{themeV2:A}=(0,k.w)(),{checkoutState:{data:{getShippingCountries:E,getConsignments:C}},checkoutService:{assignItemsToAddress:v,selectConsignmentShippingOption:b}}=(0,I.Q)(),y=(0,a.useMemo)((()=>{if(!(null==c?void 0:c.address))return;const e=E()||S.M,t=(0,s.find)(e,{code:c.address.countryCode});return Object.assign(Object.assign({},c.address),{country:t?t.name:c.address.countryCode})}),[c]),f=()=>{h(!g)};return a.createElement("div",{className:"consignment-container"},a.createElement("div",{className:N()("consignment-header",{"sub-header":A})},a.createElement("h3",null,a.createElement(r.A,{data:{consignmentNumber:e},id:"shipping.multishipping_consignment_index_heading"}))),a.createElement(oe,{countriesWithAutocomplete:t,defaultCountryCode:i,isLoading:o,onUnhandledError:d,selectedAddress:y,setConsignmentRequest:m}),y&&a.createElement(a.Fragment,null,a.createElement(ye,{address:y,consignmentNumber:e,isLoading:o,isOpen:g,onAllocateItems:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var t;let i;if(y)try{const{data:{getConsignments:t}}=yield v({address:y,lineItems:e});i=t()}catch(e){e instanceof te&&d(e)}finally{f(),p(!1),l(),i&&i.length>0&&(yield ae(null!==(t=C())&&void 0!==t?t:[],i,b))}})),onRequestClose:f,unassignedItems:u}),a.createElement("div",{className:"new-consignment-line-item-header"},a.createElement("h3",{className:A?"body-bold":""},a.createElement(r.A,{id:"shipping.multishipping_no_item_allocated_message"})),a.createElement("a",{className:A?"body-cta":"","data-test":"allocate-items-button",href:"#",onClick:(0,P.A)(f)},a.createElement(r.A,{id:"shipping.multishipping_allocate_items"})))))},dt=(0,_.A)(w({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({customerMessage:e})=>({orderComment:e}),enableReinitialize:!0})((({countriesWithAutocomplete:e,defaultCountryCode:t,isLoading:i,onUnhandledError:n,cartHasChanged:s})=>{const[o,d]=(0,a.useState)(),{themeV2:l}=(0,k.w)(),{checkoutState:{data:{getConsignments:p,getConfig:c}}}=(0,I.Q)(),{unassignedItems:{lineItems:m,shippableItemsCount:g},consignmentList:h}=ke(),u=p()||S.M,A=c(),[E,C]=(0,a.useState)(0===u.length),v=(0,tt.A)(u),b=(0,a.useMemo)((()=>i||!!m.length||!v||!it(u)),[i,u]);if(!A)return null;const{checkoutSettings:{enableOrderComments:y,shippingQuoteFailedMessage:f}}=A,_=g>0,M=()=>{d(void 0)};return a.createElement(a.Fragment,null,(e=>e>0?a.createElement(L.A,{additionalClassName:l?"body-regular":"",type:L.v.Info},a.createElement(r.A,{data:{count:e},id:"shipping.multishipping_item_to_allocate_message"})):a.createElement(L.A,{additionalClassName:l?"body-regular":"",type:L.v.Success},a.createElement(r.A,{id:"shipping.multishipping_all_items_allocated_message"})))(g),h.map((s=>a.createElement(et,{consignment:s,consignmentNumber:s.consignmentNumber,countriesWithAutocomplete:e,defaultCountryCode:t,isLoading:i,key:s.id,onUnhandledError:n,resetErrorConsignmentNumber:M,shippingQuoteFailedMessage:f}))),E&&a.createElement(ot,{consignmentNumber:0===u.length?1:u.length+1,countriesWithAutocomplete:e,defaultCountryCode:t,isLoading:i,onUnhandledError:n,resetErrorConsignmentNumber:M,setIsAddShippingDestination:C}),_&&a.createElement(U.Ay,{className:N()({"body-regular":l},"add-consignment-button"),onClick:()=>{if(E||v)E?d(u.length+1):(d(void 0),C(!0));else{const e=u.findIndex((e=>!e.selectedShippingOption));if(-1===e)return void C(!0);d(e+1)}},variant:U.Ak.Secondary},a.createElement(r.A,{id:"shipping.multishipping_add_new_destination"})),Boolean(o)&&a.createElement("div",{className:"form-field--error"},a.createElement("span",{className:"form-inlineMessage"},a.createElement(r.A,{data:{consignmentNumber:o},id:"shipping.multishipping_incomplete_consignment_error"}))),a.createElement(at,{cartHasChanged:s,isLoading:i,shouldDisableSubmit:b,shouldShowOrderComments:y}))})));var lt=i(50708);const rt=({onSignIn:e,onCreateAccount:t})=>a.createElement("div",{className:"checkout-step-info"},a.createElement(r.A,{id:"shipping.multishipping_guest_intro"})," ",a.createElement("a",{"data-test":"shipping-sign-in-link",href:"#",onClick:(0,P.A)(e)},a.createElement(r.A,{id:"shipping.multishipping_guest_sign_in"}))," ",a.createElement(lt.A,{id:"shipping.multishipping_guest_create",onClick:t}));var pt=i(9343),ct=i(10685),mt=i(60833),gt=i(37958);const ht=(0,a.memo)((({onChange:e})=>{const{themeV2:t}=(0,k.w)(),i=(0,a.useMemo)((()=>a.createElement(r.A,{id:"billing.use_shipping_address_label"})),[]);return a.createElement(gt.A,{id:"sameAsBilling",labelContent:i,name:"billingSameAsShipping",onChange:e,testId:"billingSameAsShipping",themeV2:t})}));var ut=i(82922),St=i(44218),At=i(99488);class Et extends a.PureComponent{constructor(){super(...arguments),this.handleFieldValueChange=e=>t=>{const{onFieldChange:i}=this.props;i(e,t)}}componentDidMount(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{initialize:e,methodId:t,onUnhandledError:i=s.noop}=this.props;try{yield e({methodId:t})}catch(e){i(e)}}))}componentWillUnmount(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{deinitialize:e,methodId:t,onUnhandledError:i=s.noop}=this.props;try{yield e({methodId:t})}catch(e){i(e)}}))}render(){const{address:e,buttonId:t,formFields:i,isLoading:n}=this.props,s=i.filter((({custom:e})=>e)),o=s.length>0;return a.createElement(D.A,{isLoading:n},a.createElement("div",{className:"stepHeader",style:{padding:0}},a.createElement("div",{className:"stepHeader-body subheader"},a.createElement(Te.A,{address:e})),a.createElement("div",{className:"stepHeader-actions subheader"},a.createElement(U.Ay,{id:t,onClick:(0,P.A)(),size:U.Mp.Tiny,testId:"step-edit-button",variant:U.Ak.Secondary},a.createElement(r.A,{id:"common.edit_action"})))),o&&a.createElement(mt.A,{id:"customFieldset"},s.map((e=>a.createElement(At.A,{field:e,key:`${e.id}-${e.name}`,onChange:this.handleFieldValueChange(e.name),parentFieldName:"shippingAddress.customFields"})))))}}const Ct=Et,vt=e=>{const{methodId:t,formFields:i,onFieldChange:n,initialize:s,deinitialize:o,shippingAddress:d,isShippingStepPending:l}=e,r=(0,a.useCallback)((0,St.memoizeOne)((e=>t=>s(Object.assign(Object.assign({},e),t)))),[]),p="edit-ship-button",c={amazonpay:{editAddressButtonId:p}};return a.createElement(Ct,{address:d,buttonId:p,deinitialize:o,formFields:i,initialize:r(c),isLoading:l,methodId:t,onFieldChange:n})};var bt=i(62174),yt=i(87647),ft=i(83030),_t=i(38989),It=i(67313),Mt=i(24750),Ot=i(41410),Nt=i(35172);const kt=(0,a.memo)((e=>{const{address:t,formFields:i,isLoading:s,onAddressSelect:o,onFieldChange:d,countries:l,paypalFastlaneShippingComponentRef:p}=e,c=(0,It.A)(t,l),m=i.filter((({custom:e})=>e)),g=m.length>0;return a.createElement(D.A,{hideContentWhenLoading:!0,isLoading:s},a.createElement("div",{className:"stepHeader",style:{padding:0}},a.createElement("div",{className:"stepHeader-body subheader"},a.createElement("div",{className:"vcard checkout-address--static"},!(!c.firstName&&!c.lastName)&&a.createElement("p",{className:"fn address-entry"},a.createElement("span",{className:"first-name"},`${c.firstName} `),a.createElement("span",{className:"family-name"},c.lastName)),!(!c.phone&&!c.company)&&a.createElement("p",{className:"address-entry"},a.createElement("span",{className:"company-name"},`${c.company} `),a.createElement("span",{className:"tel"},c.phone)),a.createElement("div",{className:"adr"},a.createElement("p",{className:"street-address address-entry"},a.createElement("span",{className:"address-line-1"},`${c.address1} `),!!c.address2&&a.createElement("span",{className:"address-line-2"},` / ${c.address2}`)),a.createElement("p",{className:"address-entry"},!!c.city&&a.createElement("span",{className:"locality"},`${c.city}, `),!!c.localizedProvince&&a.createElement("span",{className:"region"},`${c.localizedProvince}, `),!!c.postalCode&&a.createElement("span",{className:"postal-code"},`${c.postalCode} / `),!!c.localizedCountry&&a.createElement("span",{className:"country-name"},`${c.localizedCountry} `)))),a.createElement(Nt.A,null)),a.createElement("div",{className:"stepHeader-actions subheader"},a.createElement(pe.Ay,{onClick:()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof p.current.showAddressSelector){const e=yield p.current.showAddressSelector();if(e){const t=g?c.customFields:{};o(Object.assign(Object.assign({},e),t))}}})),size:pe.Mp.Tiny,testId:"step-edit-button",variant:pe.Ak.Secondary},a.createElement(r.A,{id:"common.edit_action"})))),g&&a.createElement(Mt.A,{id:"customFieldset"},m.map((e=>{return a.createElement(Ot.A,{field:e,key:`${e.id}-${e.name}`,onChange:(t=e.name,e=>d(t,e)),parentFieldName:"shippingAddress.customFields"});var t}))))}));var Lt=i(87650),Ft=i(83742);const wt="shippingAddress";class Ut extends a.Component{constructor(){super(...arguments),this.setFieldValue=(e,t)=>{const{formik:{setFieldValue:i},formFields:n}=this.props,s=n.filter((e=>e.custom)).map((e=>e.name)).includes(e)?`customFields.${e}`:e;i(`${wt}.${s}`,t)},this.handleChange=(e,t)=>{const{onFieldChange:i}=this.props;i(e,t)},this.handleAutocompleteToggle=({isOpen:e,inputValue:t})=>{const{onFieldChange:i}=this.props;e||i("address1",t)}}render(){const{addresses:e,address:t,onAddressSelect:i,onUseNewAddress:n,shouldShowSaveAddress:s,countries:o,countriesWithAutocomplete:d,formFields:l,isLoading:r,googleMapsApiKey:p,isFloatingLabelEnabled:c,formik:{values:{shippingAddress:m}}}=this.props,g=e&&e.length>0,h=(0,Lt.A)(t,e,l);return a.createElement(mt.A,{id:"checkoutShippingAddress"},g&&a.createElement(mt.A,{id:"shippingAddresses"},a.createElement(D.A,{isLoading:r},a.createElement($.A,{addresses:e,onSelectAddress:i,onUseNewAddress:n,selectedAddress:h?t:void 0,type:J.A.Shipping}))),!h&&a.createElement(D.A,{isLoading:r,unmountContentWhenLoading:!0},a.createElement(H.A,{countries:o,countriesWithAutocomplete:d,countryCode:m&&m.countryCode,fieldName:wt,formFields:l,googleMapsApiKey:p,isFloatingLabelEnabled:c,onAutocompleteToggle:this.handleAutocompleteToggle,onChange:this.handleChange,setFieldValue:this.setFieldValue,shouldShowSaveAddress:s})))}}const Pt=(0,Ft.A)(Ut),Rt=e=>{const{methodId:t,formFields:i,countries:s,onAddressSelect:o,onFieldChange:d,onUnhandledError:l,initialize:r,deinitialize:p,shippingAddress:c,addresses:m,handleFieldChange:g,isLoading:h}=e,[u,S]=(0,a.useState)(!0),A=(0,a.useRef)({}),E=e=>({[e]:{onPayPalFastlaneAddressChange:e=>{A.current.showAddressSelector=e}}});(0,a.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield r(Object.assign(Object.assign(Object.assign({methodId:t},(0,bt.A)(t)?E("bigcommerce_payments_fastlane"):{}),(0,yt.A)(t)?E("braintreefastlane"):{}),(0,ft.A)(t)?E("paypalcommercefastlane"):{}))}catch(e){"function"==typeof l&&e instanceof Error&&l(e)}S(!1)})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield p({methodId:t})}catch(e){"function"==typeof l&&e instanceof Error&&l(e)}}))})),[]);const{shouldShowPayPalFastlaneShippingForm:C}=(0,_t.A)();return a.createElement(D.A,{hideContentWhenLoading:!0,isLoading:u||h},t&&(0,ut.A)(t)&&c&&C?a.createElement(kt,{address:c,countries:s,deinitialize:p,formFields:i,initialize:r,isLoading:u,methodId:t,onAddressSelect:o,onFieldChange:d,onUnhandledError:l,paypalFastlaneShippingComponentRef:A}):a.createElement(Pt,{address:c,addresses:m,consignments:e.consignments,countries:s,countriesWithAutocomplete:e.countriesWithAutocomplete,formFields:i,googleMapsApiKey:e.googleMapsApiKey,isFloatingLabelEnabled:e.isFloatingLabelEnabled,isLoading:u,onAddressSelect:o,onFieldChange:g,onUseNewAddress:e.onUseNewAddress,shouldShowSaveAddress:e.shouldShowSaveAddress}))},zt=(0,a.memo)((e=>{const{methodId:t,formFields:i,countries:n,countriesWithAutocomplete:s,consignments:o,googleMapsApiKey:d,onAddressSelect:l,onFieldChange:r,onUseNewAddress:p,isLoading:c,shippingAddress:m,hasRequestedShippingOptions:g,addresses:h,shouldShowSaveAddress:u,isFloatingLabelEnabled:S}=e,{setSubmitted:A}=(0,a.useContext)(pt.Ay),E=(e,t)=>{g&&A(!0),r(e,t)};return t&&(0,ut.A)(t)&&m?a.createElement(Rt,Object.assign({},e,{handleFieldChange:E,methodId:t,shippingAddress:m})):"amazonpay"===t&&m?a.createElement(vt,Object.assign({},e,{shippingAddress:m})):a.createElement(Pt,{address:m,addresses:h,consignments:o,countries:n,countriesWithAutocomplete:s,formFields:i,googleMapsApiKey:d,isFloatingLabelEnabled:S,isLoading:c,onAddressSelect:l,onFieldChange:E,onUseNewAddress:p,shouldShowSaveAddress:u})})),Tt=["address1","postalCode","countryCode","city","stateOrProvince","stateOrProvinceCode"];var Bt=i(43586);const Dt=({cartHasChanged:e,isMultiShippingMode:t,shouldShowOrderComments:i,shouldShowShippingOptions:n=!0,shouldDisableSubmit:s,isInitialValueLoaded:o,isLoading:d,shippingFormRenderTimestamp:l})=>{const{themeV2:p}=(0,k.w)();return a.createElement(a.Fragment,null,a.createElement(Ke.Y,{region:"shipping.shippingAddressForm.after"}),a.createElement(mt.A,{id:"checkout-shipping-options",legend:a.createElement(a.Fragment,null,a.createElement(Bt.A,{themeV2:p},a.createElement(r.A,{id:"shipping.shipping_method_label"})),e&&a.createElement(st.A,{type:st.v.Error},a.createElement("strong",null,a.createElement(r.A,{id:"shipping.cart_change_error"}))))},a.createElement(Ze,{isInitialValueLoaded:o,isMultiShippingMode:t,isUpdatingAddress:d,shippingFormRenderTimestamp:l,shouldShowShippingOptions:n})),i&&a.createElement(nt.A,null),a.createElement("div",{className:"form-actions"},a.createElement(U.Ay,{className:p?"body-bold":"",disabled:s,id:"checkout-shipping-continue",isLoading:d,type:"submit",variant:U.Ak.Primary},a.createElement(r.A,{id:"common.continue_action"}))))};class Vt extends a.PureComponent{constructor(e){var t;super(e),this.state={isResettingAddress:!1,isUpdatingShippingData:!1,hasRequestedShippingOptions:!1},this.shouldDisableSubmit=()=>{const{isLoading:e,consignments:t,isValid:i}=this.props,{isUpdatingShippingData:n}=this.state;return!!i&&(e||n||!(0,tt.A)(t)||!it(t))},this.handleFieldChange=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{setFieldValue:t}=this.props;"countryCode"===e&&(t("shippingAddress.stateOrProvince",""),t("shippingAddress.stateOrProvinceCode","")),yield new Promise((e=>setTimeout(e)));const i=Tt.includes(e),{hasRequestedShippingOptions:n}=this.state,{isValid:s}=this.props;s&&this.updateAddressWithFormData(i||!n)})),this.handleAddressSelect=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{updateAddress:t,onUnhandledError:i=s.noop,values:n,setValues:a}=this.props;this.setState({isResettingAddress:!0});try{yield t(e),a(Object.assign(Object.assign({},n),{shippingAddress:(0,q.A)(this.getFields(e.countryCode),e)}))}catch(e){i(e)}finally{this.setState({isResettingAddress:!1})}})),this.onUseNewAddress=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{deleteConsignments:e,onUnhandledError:t=s.noop,setValues:i,values:n}=this.props;this.setState({isResettingAddress:!0});try{const t=yield e();i(Object.assign(Object.assign({},n),{shippingAddress:(0,q.A)(this.getFields(t&&t.countryCode),t)}))}catch(e){t(e)}finally{this.setState({isResettingAddress:!1})}}));const{updateAddress:i}=this.props;this.debouncedUpdateAddress=(0,s.debounce)(((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){try{yield i(e,{params:{include:{"consignments.availableShippingOptions":t}}}),t&&this.setState({hasRequestedShippingOptions:!0})}finally{this.setState({isUpdatingShippingData:!1})}}))),null!==(t=e.shippingAutosaveDelay)&&void 0!==t?t:1700)}componentDidUpdate({shippingFormRenderTimestamp:e}){var t,i;const{shippingFormRenderTimestamp:n,setValues:s,getFields:a,shippingAddress:o,isBillingSameAsShipping:d,customerMessage:l,values:r,setFieldValue:p}=this.props;a(r&&(null===(t=r.shippingAddress)||void 0===t?void 0:t.countryCode)).find((({name:e})=>"stateOrProvinceCode"===e))&&(null==o?void 0:o.stateOrProvinceCode)&&!(null===(i=r.shippingAddress)||void 0===i?void 0:i.stateOrProvinceCode)&&p("shippingAddress.stateOrProvinceCode",o.stateOrProvinceCode),n!==e&&s({billingSameAsShipping:d,orderComment:l,shippingAddress:(0,q.A)(a(o&&o.countryCode),o)})}render(){const{addresses:e,cartHasChanged:t,isInitialValueLoaded:i,isLoading:n,onUnhandledError:s,methodId:o,shouldShowSaveAddress:d,countries:l,countriesWithAutocomplete:r,googleMapsApiKey:p,shippingAddress:c,consignments:m,shouldShowOrderComments:g,initialize:h,isValid:u,deinitialize:S,values:{shippingAddress:A},isShippingStepPending:E,isFloatingLabelEnabled:C,shippingFormRenderTimestamp:v}=this.props,{isResettingAddress:b,isUpdatingShippingData:y,hasRequestedShippingOptions:f}=this.state,_=!["amazonpay"].some((e=>e===o));return a.createElement(V.A,{autoComplete:"on"},a.createElement(mt.A,null,a.createElement(zt,{addresses:e,consignments:m,countries:l,countriesWithAutocomplete:r,deinitialize:S,formFields:this.getFields(A&&A.countryCode),googleMapsApiKey:p,hasRequestedShippingOptions:f,initialize:h,isFloatingLabelEnabled:C,isLoading:b,isShippingStepPending:E,methodId:o,onAddressSelect:this.handleAddressSelect,onFieldChange:this.handleFieldChange,onUnhandledError:s,onUseNewAddress:this.onUseNewAddress,shippingAddress:c,shouldShowSaveAddress:d}),_&&a.createElement("div",{className:"form-body"},a.createElement(ht,null))),a.createElement(Dt,{cartHasChanged:t,isInitialValueLoaded:i,isLoading:n||y,isMultiShippingMode:!1,shippingFormRenderTimestamp:v,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:g,shouldShowShippingOptions:u}))}updateAddressWithFormData(e){const{shippingAddress:t,values:{shippingAddress:i}}=this.props,n=i&&(0,m.A)(i);Array.isArray(null==t?void 0:t.customFields)&&(e=!(0,s.isEqual)(null==t?void 0:t.customFields,null==n?void 0:n.customFields)||e),n&&!(0,g.A)(n,t)&&(this.setState({isUpdatingShippingData:!0}),this.debouncedUpdateAddress(n,e))}getFields(e){const{getFields:t}=this.props;return t(e)}}Vt.contextType=pt.Ay;const Kt=(0,_.A)(w({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,shippingAddress:t,isBillingSameAsShipping:i,customerMessage:n})=>({billingSameAsShipping:i,orderComment:n,shippingAddress:(0,q.A)(e(t&&t.countryCode),t)}),isInitialValid:({shippingAddress:e,getFields:t,language:i})=>!!e&&(0,j.A)({language:i,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:i})=>function(e){const t=[C.A.BraintreeAcceleratedCheckout,C.A.PayPalCommerceAcceleratedCheckout];return Boolean(e&&!t.includes(e))}(i)?(0,B.Ik)({shippingAddress:(0,B.RZ)((i=>(0,ct.A)({translate:(0,j.X)(e),formFields:t(i&&i.countryCode)})))}):(0,B.Ik)({shippingAddress:(0,B.RZ)((i=>(0,j.A)({language:e,formFields:t(i&&i.countryCode)})))}),enableReinitialize:!1})(Vt)),Wt=(0,_.A)((({addresses:e,cart:t,cartHasChanged:i,consignments:n,countries:s,countriesWithAutocomplete:o,onCreateAccount:d,customerMessage:l,deinitialize:r,deleteConsignments:p,getFields:c,googleMapsApiKey:m,initialize:g,isBillingSameAsShipping:h,isGuest:u,isLoading:S,isMultiShippingMode:A,isGuestMultiShippingEnabled:E,methodId:C,onMultiShippingSubmit:v,onSignIn:b,onSingleShippingSubmit:y,onUnhandledError:f,shippingAddress:_,shouldShowOrderComments:O,shouldShowSaveAddress:N,signOut:k,updateAddress:L,isShippingStepPending:F,isFloatingLabelEnabled:w,isInitialValueLoaded:U,shippingFormRenderTimestamp:P,setIsMultishippingMode:R})=>{const{checkoutState:{data:{getConfig:z}}}=(0,I.Q)(),T=z();(0,a.useEffect)((()=>{var e,i;if(P){const s=null!==(i=null===(e=null==T?void 0:T.checkoutSettings)||void 0===e?void 0:e.hasMultiShippingEnabled)&&void 0!==i&&i,a=!!t&&!!n&&s&&(0,M.A)(n,t.lineItems);R(a)}}),[P]);return A?u&&!E?a.createElement(rt,{onCreateAccount:d,onSignIn:b}):a.createElement(dt,{cartHasChanged:i,countriesWithAutocomplete:o,customerMessage:l,defaultCountryCode:null==_?void 0:_.countryCode,isLoading:S,onSubmit:v,onUnhandledError:f}):a.createElement(Kt,{addresses:e,cartHasChanged:i,consignments:n,countries:s,countriesWithAutocomplete:o,customerMessage:l,deinitialize:r,deleteConsignments:p,getFields:c,googleMapsApiKey:m,initialize:g,isBillingSameAsShipping:h,isFloatingLabelEnabled:w,isInitialValueLoaded:U,isLoading:S,isMultiShippingMode:A,isShippingStepPending:F,methodId:C,onSubmit:y,onUnhandledError:f,shippingAddress:_,shippingFormRenderTimestamp:P,shouldShowOrderComments:O,shouldShowSaveAddress:N,signOut:k,updateAddress:L})})),Ht=(0,a.memo)((({isMultiShippingMode:e,isGuest:t,onMultiShippingChange:i,shouldShowMultiShipping:n,cartHasPromotionalItems:s})=>{const[o,d]=(0,a.useState)(!1),[l,p]=(0,a.useState)(!1),{themeV2:m}=(0,k.w)(),g=n&&e,h=n&&!e&&s;return a.createElement(a.Fragment,null,a.createElement(Ke.Y,{region:"shipping.shippingAddressForm.before"}),a.createElement("div",{className:N()(["form-legend-container","shipping-header"])},a.createElement(Bt.A,{testId:"shipping-address-heading",themeV2:m},a.createElement(r.A,{id:e?t?"shipping.multishipping_address_heading_guest":"shipping.multishipping_address_heading":"shipping.shipping_address_heading"})),g&&a.createElement(a.Fragment,null,a.createElement(c.A,{action:()=>{d(!1),i()},actionButtonLabel:a.createElement(r.A,{id:"common.proceed_action"}),headerId:"shipping.ship_to_single_action",isModalOpen:o,messageId:"shipping.ship_to_single_message",onRequestClose:()=>d(!1)}),a.createElement("a",{className:m?"body-cta":"","data-test":"shipping-mode-toggle",href:"#",onClick:(0,P.A)((()=>d(!0)))},a.createElement(r.A,{id:"shipping.ship_to_single"}))),h&&a.createElement(a.Fragment,null,a.createElement(c.A,{action:()=>p(!1),actionButtonLabel:a.createElement(r.A,{id:"common.back_action"}),headerId:"shipping.multishipping_unavailable_action",isModalOpen:l,messageId:"shipping.multishipping_unavailable_message",onRequestClose:()=>p(!1)}),a.createElement("a",{className:m?"body-cta":"","data-test":"shipping-mode-toggle",href:"#",onClick:(0,P.A)((()=>p(!0)))},a.createElement(r.A,{id:"shipping.ship_to_multi"}))),!g&&!h&&n&&a.createElement("a",{className:m?"body-cta":"","data-test":"shipping-mode-toggle",href:"#",onClick:(0,P.A)(i)},a.createElement(r.A,{id:e?"shipping.ship_to_single":"shipping.ship_to_multi"}))))}));var jt=i(59713);class qt extends a.PureComponent{componentDidMount(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{initialize:e,methodId:t,onUnhandledError:i=s.noop}=this.props;try{yield e({methodId:t})}catch(e){i(e)}}))}componentWillUnmount(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{deinitialize:e,methodId:t,onUnhandledError:i=s.noop}=this.props;try{yield e({methodId:t})}catch(e){i(e)}}))}render(){return a.createElement(a.Fragment,null,a.createElement("div",{className:"stepHeader",style:{padding:0}},a.createElement("div",{id:"StripeUpeShipping",style:{width:"100%"}})),a.createElement("br",null))}}const xt=qt;function Gt(e,t){var i;const n={MX:{"Ags.":"AGU","B.C.":"BCN","B.C.S.":"BCS","Camp.":"CAM","Coah.":"COA","Col.":"COL","Chis.":"CHP","Chih.":"CHH","Dgo.":"DUR","Gto.":"GUA","Gro.":"GRO","Hgo.":"HID","Jal.":"JAL","Méx.":"MEX",CDMX:"MEX","Mich.":"MIC","Mor.":"MOR","Nay.":"NAY","N.L.":"NLE","Oax.":"OAX","Pue.":"PUE","Qro.":"QUE","Q.R.":"ROO","S.L.P.":"SLP","Sin.":"SIN","Son.":"SON","Tab.":"TAB","Tamps.":"TAM","Tlax.":"TLA","Ver.":"VER","Yuc.":"YUC","Zac.":"ZAC"},AR:{"Ciudad Autónoma de Buenos Aires":"C","Buenos Aires":"B",Catamarca:"K",Chaco:"H",Chubut:"U",Córdoba:"X",Corrientes:"W","Entre Ríos":"E",Formosa:"P",Jujuy:"Y","La Pampa":"L","La Rioja":"F",Mendoza:"M",Misiones:"N",Neuquén:"Q",Salta:"A","San Juan":"J","San Luis":"D","Santa Fe":"S","Santiago del Estero":"G","Tierra del Fuego":"V",Tucumán:"W"},IN:{"Andhra Pradesh":"AP","Arunachal Pradesh":"AR",Assam:"AS",Bihar:"BR",Chhattisgarh:"CG",Goa:"GA",Gujarat:"GJ",Haryana:"HR","Himachal Pradesh":"HP","Jammu and Kashmir":"JK",Jharkhand:"JH",Karnataka:"KA",Kerala:"KL","Madhya Pradesh":"MP",Maharashtra:"MH",Manipur:"MN",Meghalaya:"ML",Mizoram:"MZ",Nagaland:"NL",Odisha:"OR",Punjab:"PB",Rajasthan:"RJ",Sikkim:"SK","Tamil Nadu":"TN",Tripura:"TR",Uttarakhand:"UK","Uttar Pradesh":"UP","West Bengal":"WB","Andaman and Nicobar Islands":"AN",Chandigarh:"CH","Dadra and Nagar Haveli and Daman and Diu":"DN",Lakshadweep:"LD",Delhi:"DL",Puducherry:"PY",Telangana:"TS"},ID:{Bali:"BA",Banten:"BT",Bengkulu:"BE",Aceh:"DA","DKI Jakarta":"JK","Sumatera Utara":"SU","Sumatera Barat":"SB",Riau:"SI",Jambi:"JA","Sumatera Selatan":"SS",Lampung:"LA","Jawa Barat":"JB","Jawa Timur":"JT","Daerah Istimewa Yogyakarta":"DY","Kalimantan Barat":"KB","Kalimantan Tengah":"KT","Kalimantan Timur":"KI","Kalimantan Selatan":"KS","Nusa Tenggara Barat":"NB","Nusa Tenggara Timur":"NT","Sulawesi Selatan":"SN","Sulawesi Tengah":"ST","Sulawesi Utara":"SA","Sulawesi Tenggara":"SG",Maluku:"MA","Maluku Utara":"MU",Gorontalo:"GO"},MY:{Johor:"JHR",Kedah:"KDH",Kelantan:"KTN",Melaka:"MLK","Negeri Sembilan":"NSN",Pahang:"PHG","Pulau Pinang":"PNG",Perak:"PRK",Perlis:"PLS",Selangor:"SGR",Terengganu:"TRG",Sabah:"SBH",Sarawak:"SRW","Kuala Lumpur":"KUL",Labuan:"LBN",Putrajaya:"PJY"},IE:{Carlow:"CW",Cavan:"CN",Clare:"CE",Donegal:"DL",Dublin:"D",Galway:"G",Kildare:"KE",Kilkenny:"KK",Laois:"LS",Leitrim:"LM",Longford:"LD",Louth:"LH",Mayo:"MO",Meath:"MH",Monaghan:"MN",Offaly:"OY",Roscommon:"RN",Sligo:"SO",Tipperary:"TA",Waterford:"WD",Westmeath:"WH",Wexford:"WX",Wicklow:"WW"},JP:{Aichi:"23",Akita:"05",Aomori:"02",Chiba:"12",Ehime:"38",Fukui:"18",Fukuoka:"40",Fukushima:"07",Gifu:"21",Gunma:"10",Hiroshima:"34",Hokkaido:"01",Hyogo:"28",Ibaraki:"08",Ishikawa:"17",Iwate:"03",Kagawa:"37",Kagoshima:"46",Kanagawa:"14",Kochi:"39",Kumamoto:"43",Kyoto:"26",Mie:"24",Miyagi:"04",Miyazaki:"45",Nagano:"20",Nagasaki:"42",Nara:"29",Niigata:"15",Oita:"44",Okayama:"33",Okinawa:"47",Osaka:"27",Saga:"41",Saitama:"11",Shiga:"25",Shimane:"32",Shizuoka:"22",Tochigi:"09",Tokushima:"36",Tokyo:"13",Tottori:"31",Toyama:"16",Wakayama:"30",Yamagata:"06",Yamaguchi:"35",Yamanashi:"19"}};return n[e]?null!==(i=n[e][t])&&void 0!==i?i:function(e,t){return Object.keys(e).find((i=>e[i]===t))||t}(n[e],t):t}const $t=(0,a.memo)((e=>{const{countries:t,consignments:i,onAddressSelect:s,initialize:o,deinitialize:d,shouldDisableSubmit:l,onSubmit:r,step:p,isStripeLoading:c,isStripeAutoStep:m,isShippingMethodLoading:g,shippingAddress:h}=e,[u,S]=(0,a.useState)(!0),[A,E]=(0,a.useState)(!0),[C,v]=(0,a.useState)({firstName:"",lastName:"",company:"",address1:"",address2:"",city:"",stateOrProvince:"",stateOrProvinceCode:"",shouldSaveAddress:!0,country:"",countryCode:"",postalCode:"",phone:"",customFields:[]}),b=(0,a.useCallback)((()=>{c&&c()}),[c]);(0,a.useEffect)((()=>{if(i[0]){const{availableShippingOptions:e}=i[0];e&&!De(e)&&b()}}),[i]),(0,a.useEffect)((()=>{C.firstName&&(0,tt.A)(i)&&(!A&&!u&&!g)&&(c&&m)&&(c(),m(),r({billingSameAsShipping:!0,shippingAddress:C,orderComment:""}))}),[A,r,C,l,g,u,i]);const y=null==t?void 0:t.map((e=>({code:e.code,name:e.name}))),f=y?y.map((e=>e.code)).join(", "):"",_=(0,a.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var t;const{complete:i,phoneFieldRequired:n,value:{address:a={country:"",state:"",line1:"",line2:"",city:"",postal_code:""},name:o="",firstName:d="",lastName:l="",phone:r=""}}=e;if(i){((e=!0,t,i)=>{const n=p.isComplete,s=(null==h?void 0:h.firstName)&&e;return n||s||t&&!i})(null==e?void 0:e.isNewAddress,n,r)&&b();const i=null==o?void 0:o.split(" "),c=null===(t=null==y?void 0:y.find((e=>e.code===a.country)))||void 0===t?void 0:t.name,m=Gt(a.country,a.state),g={firstName:d||i[0],lastName:l||i[1],company:"",address1:a.line1,address2:a.line2||"",city:a.city,stateOrProvince:m,stateOrProvinceCode:m,shouldSaveAddress:!0,country:c||a.country,countryCode:a.country,postalCode:a.postal_code,phone:r||"",customFields:[]};p.isComplete||E((e=>!e)),s(g),v(g),e.isNewAddress!==u&&S((e=>!e))}else b()}))),[y,s]),I=(0,a.useCallback)((0,St.memoizeOne)((e=>t=>o(Object.assign(Object.assign({},e),t)))),[]),M=(e,t)=>{const i=document.getElementById(e);if(i)return(0,jt.A)(i,t)},O={stripeupe:{container:"StripeUpeShipping",onChangeShipping:_,availableCountries:f,getStyles:(0,a.useCallback)((()=>{const e="stripe-card-component-field",t=M(`${e}--input`,["color","background-color","border-color","box-shadow"]),i=M(`${e}--label`,["color"]),n=M(`${e}--error`,["color"]);return i&&t&&n?{labelText:i.color,fieldText:t.color,fieldPlaceholderText:t.color,fieldErrorText:n.color,fieldBackground:t["background-color"],fieldInnerShadow:t["box-shadow"],fieldBorder:t["border-color"]}:void 0}),[]),getStripeState:Gt,gatewayId:"stripeupe",methodId:"card"}};return a.createElement(a.Fragment,null,a.createElement(xt,{deinitialize:d,initialize:I(O),methodId:"stripeupe"}),(()=>{const e="stripe-card-component-field";return a.createElement("div",{className:"optimizedCheckout-form-input",id:`${e}--input`},a.createElement("div",{className:"form-field--error"},a.createElement("div",{className:"optimizedCheckout-form-label",id:`${e}--error`})),a.createElement("div",{className:"optimizedCheckout-form-label",id:`${e}--label`}))})())}));class Jt extends a.PureComponent{constructor(){super(...arguments),this.state={isUpdatingShippingData:!1},this.shouldDisableSubmit=()=>{const{isLoading:e,consignments:t,isValid:i}=this.props,{isUpdatingShippingData:n}=this.state;return!!i&&(e||n||!(0,tt.A)(t))},this.handleAddressSelect=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{updateAddress:t,onUnhandledError:i=s.noop,values:n,setValues:a}=this.props;try{yield t(e),a(Object.assign(Object.assign({},n),{shippingAddress:(0,q.A)(this.getFields(e.countryCode),e)}))}catch(e){i(e)}}))}render(){const{cartHasChanged:e,isInitialValueLoaded:t,isLoading:i,countries:n,isStripeLoading:s,shippingAddress:o,consignments:d,shouldShowOrderComments:l,initialize:r,isValid:p,deinitialize:c,onSubmit:m,isStripeAutoStep:g,step:h,isShippingMethodLoading:u}=this.props,{isUpdatingShippingData:S}=this.state;return a.createElement(V.A,{autoComplete:"on"},a.createElement(mt.A,null,a.createElement($t,{consignments:d,countries:n,deinitialize:c,initialize:r,isShippingMethodLoading:u,isStripeAutoStep:g,isStripeLoading:s,onAddressSelect:this.handleAddressSelect,onSubmit:m,shippingAddress:o,shouldDisableSubmit:this.shouldDisableSubmit(),step:h}),a.createElement("div",{className:"form-body"},a.createElement(ht,null))),a.createElement(Dt,{cartHasChanged:e,isInitialValueLoaded:t,isLoading:i||S,isMultiShippingMode:!1,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:l,shouldShowShippingOptions:p}))}getFields(e){const{getFields:t}=this.props;return t(e)}}Jt.contextType=pt.Ay;const Qt=(0,_.A)(w({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,shippingAddress:t,isBillingSameAsShipping:i,customerMessage:n})=>({billingSameAsShipping:i,orderComment:n,shippingAddress:(0,q.A)(e(t&&t.countryCode),t)}),isInitialValid:({shippingAddress:e,getFields:t,language:i})=>!!e&&(0,j.A)({language:i,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:i})=>i?(0,B.Ik)({shippingAddress:(0,B.RZ)((i=>(0,ct.A)({translate:(0,j.X)(e),formFields:t(i&&i.countryCode)})))}):(0,B.Ik)({shippingAddress:(0,B.RZ)((i=>(0,j.A)({language:e,formFields:t(i&&i.countryCode)})))}),enableReinitialize:!1})(Jt));class Yt extends a.Component{constructor(e){super(e),this.stripeLoadedCallback=()=>{this.setState({isStripeLoading:!1})},this.handleIsAutoStep=()=>{this.setState({isStripeAutoStep:!0})},this.state={isStripeLoading:!0,isStripeAutoStep:!1}}render(){const e=this.props,{isBillingSameAsShipping:t,isGuest:i,shouldShowMultiShipping:s,customer:o,updateAddress:d,initialize:l,deinitialize:r,isMultiShippingMode:c,step:m,onSubmit:g,onMultiShippingChange:h,isLoading:u,isShippingMethodLoading:S}=e,A=(0,n.__rest)(e,["isBillingSameAsShipping","isGuest","shouldShowMultiShipping","customer","updateAddress","initialize","deinitialize","isMultiShippingMode","step","onSubmit","onMultiShippingChange","isLoading","isShippingMethodLoading"]),{isStripeLoading:E,isStripeAutoStep:C}=this.state;return a.createElement(a.Fragment,null,a.createElement(p.A,{isLoading:C||E}),a.createElement("div",{className:"checkout-form",style:{display:C||E?"none":void 0}},a.createElement(Ht,{isGuest:i,isMultiShippingMode:c,onMultiShippingChange:h,shouldShowMultiShipping:s}),a.createElement(Qt,Object.assign({},A,{deinitialize:r,initialize:l,isBillingSameAsShipping:t,isLoading:u,isMultiShippingMode:c,isShippingMethodLoading:S,isStripeAutoStep:this.handleIsAutoStep,isStripeLoading:this.stripeLoadedCallback,onSubmit:g,step:m,updateAddress:d}))))}}const Zt=Yt;class Xt extends a.Component{constructor(e){super(e),this.handleMultiShippingModeSwitch=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{consignments:e,isMultiShippingMode:t,onToggleMultiShipping:i=s.noop,onUnhandledError:n=s.noop,updateShippingAddress:a,deleteConsignments:o}=this.props;try{this.setState({isInitializing:!0}),t&&e.length?yield a(e[0].shippingAddress):yield o()}catch(e){n(e)}finally{this.setState({isInitializing:!1})}i()})),this.handleSingleShippingSubmit=e=>(0,n.__awaiter)(this,[e],void 0,(function*({billingSameAsShipping:e,shippingAddress:t,orderComment:i}){const{customerMessage:n,updateCheckout:s,updateShippingAddress:a,updateBillingAddress:o,navigateNextStep:d,onUnhandledError:l,shippingAddress:r,billingAddress:p,methodId:c}=this.props,h=t&&(0,m.A)(t),u=[],S=this.hasRemoteBilling(c);(0,g.A)(h,r)&&(null==r?void 0:r.shouldSaveAddress)===(null==h?void 0:h.shouldSaveAddress)||u.push(a(h||{})),e&&h&&!(0,g.A)(h,p)&&!S&&u.push(o(h)),n!==i&&u.push(s({customerMessage:i}));try{yield Promise.all(u),d(e)}catch(e){e instanceof Error&&l(e)}})),this.hasRemoteBilling=e=>["amazonpay"].some((t=>t===e)),this.handleMultiShippingSubmit=e=>(0,n.__awaiter)(this,[e],void 0,(function*({orderComment:e}){const{customerMessage:t,updateCheckout:i,navigateNextStep:n,onUnhandledError:s}=this.props;try{t!==e&&(yield i({customerMessage:e})),n(!1)}catch(e){e instanceof Error&&s(e)}})),this.state={isInitializing:!0,isMultiShippingUnavailableModalOpen:!1}}componentDidMount(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{loadShippingAddressFields:e,loadBillingAddressFields:t,loadShippingOptions:i,onReady:n=s.noop,onUnhandledError:a=s.noop,cartHasPromotionalItems:o,isMultiShippingMode:d}=this.props;try{yield Promise.all([e(),i(),t()]),o&&d&&this.setState({isMultiShippingUnavailableModalOpen:!0}),n()}catch(e){a(e)}finally{this.setState({isInitializing:!1})}}))}render(){const e=this.props,{isBillingSameAsShipping:t,isGuest:i,shouldShowMultiShipping:s,customer:o,updateShippingAddress:d,initializeShippingMethod:l,deinitializeShippingMethod:m,isMultiShippingMode:g,isGuestMultiShippingEnabled:h,step:u,isFloatingLabelEnabled:S,shouldRenderStripeForm:A,shouldRenderWhileLoading:E,cartHasPromotionalItems:C,extensionState:{shippingFormRenderTimestamp:v}={},setIsMultishippingMode:b}=e,y=(0,n.__rest)(e,["isBillingSameAsShipping","isGuest","shouldShowMultiShipping","customer","updateShippingAddress","initializeShippingMethod","deinitializeShippingMethod","isMultiShippingMode","isGuestMultiShippingEnabled","step","isFloatingLabelEnabled","shouldRenderStripeForm","shouldRenderWhileLoading","cartHasPromotionalItems","extensionState","setIsMultishippingMode"]),{isInitializing:f,isMultiShippingUnavailableModalOpen:_}=this.state;return A&&!o.email&&this.props.countries.length>0?a.createElement(Zt,Object.assign({},y,{customer:o,deinitialize:m,initialize:l,isBillingSameAsShipping:t,isGuest:i,isInitialValueLoaded:!E||!f,isLoading:f,isMultiShippingMode:g,isShippingMethodLoading:this.props.isLoading,onMultiShippingChange:this.handleMultiShippingModeSwitch,onSubmit:this.handleSingleShippingSubmit,shouldShowMultiShipping:s,step:u,updateAddress:d})):a.createElement(p.A,{isLoading:f,renderWhileLoading:E},a.createElement("div",{className:"checkout-form"},a.createElement(c.A,{action:()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){this.setState({isMultiShippingUnavailableModalOpen:!1}),yield this.handleMultiShippingModeSwitch()})),actionButtonLabel:a.createElement(r.A,{id:"common.ok_action"}),headerId:"shipping.multishipping_unavailable_action",isModalOpen:_,messageId:"shipping.checkout_switched_to_single_shipping",shouldShowCloseButton:!1}),a.createElement(Ht,{cartHasPromotionalItems:C,isGuest:i,isMultiShippingMode:g,onMultiShippingChange:this.handleMultiShippingModeSwitch,shouldShowMultiShipping:s}),a.createElement(Wt,Object.assign({},y,{addresses:o.addresses,deinitialize:m,initialize:l,isBillingSameAsShipping:t,isFloatingLabelEnabled:S,isGuest:i,isGuestMultiShippingEnabled:h,isInitialValueLoaded:!E||!f,isMultiShippingMode:g,onMultiShippingSubmit:this.handleMultiShippingSubmit,onSingleShippingSubmit:this.handleSingleShippingSubmit,setIsMultishippingMode:b,shippingFormRenderTimestamp:v,shouldShowSaveAddress:!i,updateAddress:d}))))}}const ei=(0,o.createSelector)((({checkoutService:{deleteConsignment:e}})=>e),(({checkoutState:{data:e}})=>e.getConsignments()),((e,t)=>()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(!t||!t.length)return;const[{data:i}]=yield Promise.all(t.map((({id:t})=>e(t))));return i.getShippingAddress()}))));function ti({checkoutService:e,checkoutState:t}){var i;const{data:{getCart:n,getCheckout:s,getConfig:a,getCustomer:o,getConsignments:d,getShippingAddress:r,getBillingAddress:p,getShippingAddressFields:c,getShippingCountries:m},statuses:{isShippingStepPending:g,isSelectingShippingOption:h,isLoadingShippingOptions:b,isUpdatingConsignment:_,isCreatingConsignments:I,isCreatingCustomerAddress:M,isLoadingShippingCountries:O,isUpdatingBillingAddress:N,isUpdatingCheckout:k,isDeletingConsignment:L,isLoadingCheckout:F}}=t,w=s(),U=a(),P=d()||[],R=o(),z=n();if(!(w&&U&&R&&z))return null;const{checkoutSettings:{enableOrderComments:T,features:B,hasMultiShippingEnabled:D,googleMapsApiKey:V}}=U,K=y(w,U),W=b()||h()||_()||I()||N()||k()||M()||L()||F(),H=(0,v.A)(z),j=D&&!K&&H>1,q=!j&&P.length>1?void 0:r(),x=(0,E.A)(U.checkoutSettings.providerWithCustomCheckout),G=(0,u.A)(null==U?void 0:U.checkoutSettings,"CHECKOUT-9161.enable_storefront_guest_multi_shipping");return{assignItem:e.assignItemsToAddress,billingAddress:p(),cart:z,cartHasPromotionalItems:f(z),consignments:P,countries:m()||S.M,countriesWithAutocomplete:["US","CA","AU","NZ","GB"],customer:R,customerMessage:w.customerMessage,createCustomerAddress:e.createCustomerAddress,deinitializeShippingMethod:e.deinitializeShipping,deleteConsignments:ei({checkoutService:e,checkoutState:t}),getFields:c,googleMapsApiKey:V,initializeShippingMethod:e.initializeShipping,isGuest:R.isGuest,isInitializing:O()||b(),isLoading:W,isShippingStepPending:g(),loadShippingAddressFields:e.loadShippingAddressFields,loadBillingAddressFields:e.loadBillingAddressFields,loadShippingOptions:e.loadShippingOptions,methodId:K,providerWithCustomCheckout:x,shippingAddress:q,shouldRenderWhileLoading:null===(i=B["CHECKOUT-8300.improve_extension_performance"])||void 0===i||i,shouldShowMultiShipping:j,shouldShowOrderComments:T,signOut:e.signOutCustomer,unassignItem:e.unassignItemsToAddress,updateBillingAddress:e.updateBillingAddress,updateCheckout:e.updateCheckout,updateShippingAddress:e.updateShippingAddress,isFloatingLabelEnabled:(0,A.A)(U.checkoutSettings),shouldRenderStripeForm:x===C.A.StripeUPE&&(0,l.A)(z),isGuestMultiShippingEnabled:G}}const ii=(0,d.c)((0,h.A)(ti)(Xt))}}]);
//# sourceMappingURL=shipping-1fb068c5.js.map